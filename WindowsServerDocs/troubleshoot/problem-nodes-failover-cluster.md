---
title: 刪除節點時發生問題
description: 本文說明從主動容錯移轉叢集成員資格中移除節點時所遇到的問題。
ms.date: 05/28/2020
author: Deland-Han
ms.author: delhan
ms.topic: troubleshooting
ms.openlocfilehash: aaecdeca4ec875a86c795438ba0c121932b4123b
ms.sourcegitcommit: 40905b1f9d68f1b7d821e05cab2d35e9b425e38d
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/06/2021
ms.locfileid: "97947214"
---
# <a name="having-a-problem-with-nodes-being-removed-from-active-failover-cluster-membership"></a>從主動容錯移轉叢集成員資格中移除節點時發生問題

本文將介紹如何從主動容錯移轉叢集成員資格中隨機移除節點的問題。

## <a name="symptoms"></a>徵兆

當問題發生時，您會看到事件，例如記錄在系統事件記錄檔中：

![事件1135](media/problem-nodes-failover-cluster/1135-1.png)

此事件將會記錄在叢集中的所有節點上，但已移除的節點除外。 此事件的原因是因為叢集中的其中一個節點將該節點標示為已關閉。 然後，它會通知事件的所有其他節點。 當節點收到通知時，它們會中止，並中斷其對停止節點的信號連接。

## <a name="what-caused-the-node-to-be-marked-down"></a>造成節點標示為已關閉的原因

Windows 2008 或 2008 R2 容錯移轉叢集中的所有節點，會透過設定為允許此網路上叢集網路通訊的網路彼此交談。 節點會將這些網路上的心跳封包傳送到所有其他節點。 這些封包應該會由其他節點接收，然後再送迴響應。 叢集中的每個節點都有自己要監視的心跳，以確保網路已啟動，而其他節點已啟動。 下列範例應可協助您澄清：

![節點](media/problem-nodes-failover-cluster/Node2.png)

如果其中任何一個封包未傳回，則會將特定的信號視為失敗。 例如，W2K8.WIM-R2-節點會傳送要求，並接收來自 W2K8.WIM-R2-節點的回應至信號封包，讓它判斷網路和節點已啟動。  如果 W2K8.WIM-R2-節點將要求傳送至 W2K8.WIM-R2-節點2，而 W2K8.WIM-R2-節點未取得回應，則會將它視為遺失的信號，而 W2K8.WIM-R2 節點節點會持續追蹤它。  這項缺少的回應可以有 W2K8.WIM-R2-節點1顯示網路，直到收到另一個心跳要求為止。

根據預設，在連線標示為關閉之前，叢集節點的5秒內會有5次失敗的限制。 因此，如果 W2K8.WIM-R2-1-1 不會在一段時間內收到回應五次，則會將 W2K8.WIM-R2-節點的特定路由視為關閉。 如果仍將其他路由視為已啟動，則 W2K8.WIM-R2-2-2 會維持為作用中的成員。

如果所有路由都標示為已關閉 W2K8.WIM-R2-節點，則會從作用中的容錯移轉叢集成員資格中移除，並記錄您在第一個區段中看到的事件1135。 在 W2K8.WIM-R2-節點上，叢集服務會終止，然後重新開機，讓它可以嘗試重新加入叢集。

如需如何使用三個或更多節點來處理特定路由的詳細資訊，請參閱 Jeff Hughes 撰寫的「分割」叢集 [網路](/archive/blogs/askcore/partitioned-cluster-networks) 的 blog。

## <a name="now-that-we-know-how-the-heartbeat-process-works-what-are-some-of-the-known-causes-for-the-process-to-fail"></a>現在我們已經知道心跳程式的運作方式，有哪些已知的程式會失敗的原因

1. 實際的網路硬體故障。 如果兩個節點之間的網路上的封包遺失，則這些心跳將會失敗。 涉及的兩個節點的網路追蹤將會顯示這一點。

2. 您網路連線的設定檔可能會再次從網域彈跳到網域，然後再次從網域跳動到網域。 在進行這些變更的轉換期間，可能會封鎖網路 i/o。 您可以藉由查看網路設定檔的作業記錄，查看是否為這種情況。 您可以開啟事件檢視器並流覽至： Logs\Microsoft\Windows\NetworkProfile\Operational. 的應用程式和服務，以找到此記錄檔。 在事件識別碼：1135中提及的節點上查看此記錄檔中的事件，並查看目前的設定檔是否已變更。 如果是，請參閱知識庫文章： [網路位置設定檔在 windows 7 或 Windows Server 2008 R2 中的「網域」變更為「公用](https://support.microsoft.com/help/2524478/the-network-location-profile-changes-from-domain-to-public-in-windows)」。

3. 您已在伺服器上啟用 IPv6，但在 Windows 防火牆中已針對輸入和輸出停用下列兩個規則：

    - 核心網路-鄰近探索通告
    - 核心網路-鄰近探索請求

4. 防毒軟體也可能幹擾此程式。 如果您有疑問，請停用或卸載軟體以進行測試。 請自行承擔風險，因為您此時將不受病毒感染。

5. 您網路上的延遲也可能會導致這種情況發生。 這些封包可能不會在節點之間遺失，但在超時時間期限到期之前，這些封包可能無法迅速達到足夠的速度。

6. IPv6 是容錯移轉叢集將用於其心跳的預設通訊協定。 心跳本身是 UDP 單播網路封包，會透過埠3343進行通訊。 如果有未適當設定的交換器、防火牆或路由器以允許此流量通過，您可能會遇到像這樣的問題。

7. IPsec 安全性原則重新整理也會造成此問題。 具體的問題是，在 IPSec 群組原則更新所有 IPsec 安全性關聯 (SAs) 會由具有 Advanced Security (WFAS) 的 Windows 防火牆進行中斷。 發生這種情況時，所有網路連線都會遭到封鎖。 當重新交涉安全性關聯時，如果使用 Active Directory 執行驗證有延遲，這些延遲 (在所有網路通訊遭到封鎖的情況下，) 也會封鎖叢集的偵測器，並導致叢集健康情況監視在5秒的閾值內未回應時，偵測到節點已關閉。

8. 舊的或過時的網路介面卡驅動程式和（或）固件。  有時，網路卡或交換器的簡單設定不正確，也可能導致遺失心跳。

9. 新式網路卡和虛擬網路卡可能會遇到封包遺失。  您可以開啟效能監視器，並新增「已捨棄的網路 Interface\Packets」計數器來追蹤。  此計數器是累計的，而且只會增加直到伺服器重新開機為止。  如果看到大量的封包，可能是因為網路卡上的接收緩衝區設定過低，或伺服器執行速度很慢，而且無法處理輸入流量。  每張網路卡製造商都選擇是否要在網路卡的屬性中公開這些設定，因此您需要參考製造商的網站，以瞭解如何增加這些值，以及建議的值。  如果您是在 VMware 上執行，下列的 blog 會更詳細地討論這一點，包括如何判斷這是否為問題，以及是否指向 VMWare 文章，以瞭解要變更的設定。

    [從 VMWare ESX 上的容錯移轉叢集成員資格中移除的節點](/archive/blogs/askcore/nodes-being-removed-from-failover-cluster-membership-on-vmware-esx)

這些是記錄這些事件的最常見原因，但也有其他原因。 這段 blog 的重點是要讓您深入瞭解此程式，並提供要尋找之事項的概念。 有些會將下列值提升為其最大值，以嘗試讓此問題停止。

|參數|預設|範圍|
|---|---|---|
|**SameSubnetDelay**|1000毫秒|250-2000 毫秒|
|**CrossSubnetDelay**|1000毫秒|250-4000 毫秒|
|**SameSubnetThreshold**|5|3-10|
|**CrossSubnetThreshold**|5|3-10|
||||

將這些值增加到最大值，可能會讓事件和節點移除消失，只會遮罩問題。 它不會修正任何問題。 最佳的做法是找出發生錯誤的根本原因，並將其修正。 增加這些值的唯一真正需求是在多網站案例中，節點位於不同的位置，而網路延遲無法克服。
