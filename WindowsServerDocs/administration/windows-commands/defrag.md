---
title: defrag
description: 重組命令的參考檔，它會尋找併合並本機磁片區上的分散檔案，以改善系統效能。
ms.topic: reference
ms.assetid: aaf1d1ac-996a-4282-9b4d-1e8245ff162c
ms.author: lizross
author: eross-msft
manager: mtillman
ms.date: 10/16/2017
ms.openlocfilehash: 81f6aba6dce5bce28311a789f803ac2c7117fd0f
ms.sourcegitcommit: db2d46842c68813d043738d6523f13d8454fc972
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/10/2020
ms.locfileid: "89628899"
---
# <a name="defrag"></a>defrag

> 適用于： Windows 10、Windows Server (半年通道) 、Windows Server 2016、Windows Server 2012 R2、Windows Server 2012

尋找併合並本機磁片區上的分散檔案，以改善系統效能。

若要執行此命令，至少需要本機 **Administrators** 群組的成員資格或同等許可權。

## <a name="syntax"></a>語法

```
defrag <volumes> | /c | /e <volumes>    [/h] [/m [n]| [/u] [v]]
defrag <volumes> | /c | /e <volumes> /a [/h] [/m [n]| [/u] [v]]
defrag <volumes> | /c | /e <volumes> /x [/h] [/m [n]| [/u] [v]]
defrag <volume> [<parameters>]
```

### <a name="parameters"></a>參數

| 參數 | 描述 |
| --------- | ----------- |
| `<volume>` | 指定要進行磁碟重組或分析之磁片區的磁碟機號或掛接點路徑。 |
| /a | 在指定的磁片區上執行分析。 |
| /C | 在所有磁片區上執行操作。 |
| /d | 執行傳統磁碟重組 (這是預設) 。 不過，在階層式磁片區上，傳統磁碟重組只會在容量層上執行。 |
| /e | 在所有磁片區上執行此作業，但指定的磁片區除外。 |
| /g | 優化指定磁片區上的儲存層。 |
| /h | 以一般優先權執行操作 (預設為低) 。 |
| /i [n] | 在每個磁片區上最多會在 n 秒執行階層優化。 |
| /k | 在指定的磁片區上執行樓板合併。 |
| /l | 在指定的磁片區上執行 retrim。 |
| /m [n] | 在背景中平行執行每個磁片區上的作業。 最多 n 個執行緒會以平行方式將儲存層優化。 |
| /o | 針對每個媒體類型執行適當的優化。 |
| /t | 追蹤已在指定磁片區上進行的操作。 |
| /U | 在螢幕上列印操作進度。 |
| /v | 列印包含片段統計資料的詳細資訊輸出。 |
| /x | 在指定的磁片區上執行可用空間合併。 |
| /? | 顯示此說明資訊。 |

#### <a name="remarks"></a>備註

- 您無法重組特定檔案系統磁片區或磁片磁碟機，包括：

  - 檔案系統鎖定的磁片區。

  - 檔案系統標記為中途的磁片區，指出可能的損毀。<br>您必須先執行， `chkdsk` 才能重組這個磁片區或磁片磁碟機。 您可以使用命令來判斷磁片區是否已變更 `fsutil dirty` 。

  - 網路磁碟機機。

  - 光碟。

  - 非 **NTFS**、 **ReFS**、 **Fat** 或 **Fat32**的檔案系統磁片區。

- 您無法排程將固態硬碟 (SSD) 或位於 SSD 上的虛擬硬碟 (VHD) 上的磁片區進行磁碟重組。

- 若要執行此程序，您必須是本機電腦上的 Administrators 群組成員或是已經委派您適當的權限。 如果該電腦已加入網域，則 Domain Admins 群組的成員便可以執行這項程序。 為了安全性最佳作法，請考慮使用「執行 **身份** 」來執行此程式。

- 磁片區至少必須有 15 **% 的可用空間，重組** 才能完整且適當地重組。 **磁碟重組** 會使用此空間做為檔案片段的排序區域。 如果磁片區的可用空間少於 15 **%，重組** 只會部分重組。 若要增加磁片區的可用空間，請刪除不必要的檔案，或將它們移至另一個磁片。

- 當重組正在分析和重組磁片區時， **它會顯示** 閃爍的游標。 當重組完成分析和重組磁片區時， **它會顯示** 分析報告、磁碟重組報表或這兩個報表，然後結束到命令提示字元。

- 依預設，如果您未指定 **/a**或 **/v**參數，重組會顯示分析和**磁碟重組報表**的摘要。

- 您可以輸入FileName.txt，將報表傳送至文字檔 **>** <em> </em>，其中*FileName.txt*是您指定的檔案名。 例如： `defrag volume /v > FileName.txt`

- 若要中斷磁碟重組程式，請在命令列中按下 **CTRL + C**。

- 執行 **磁碟重組** 命令和磁碟重組工具是互斥的。 如果您是使用「磁碟重組工具」來重組磁片區，並且在命令列執行「 **碎片** 整理」 **命令，則重組命令會** 失敗。 相反地，如果您執行 **重組命令並開啟 [磁碟重組** 工具]，[磁片磁碟重組工具] 中的磁碟重組選項無法使用。

## <a name="examples"></a>範例

若要在磁片磁碟機 C 上重組磁片區，同時提供進度和詳細資訊輸出，請輸入：

```
defrag c: /u /v
```

若要在背景中以平行方式重組 C 和 D 磁片磁碟機上的磁片區，請輸入：

```
defrag c: d: /m
```

若要對裝載于 C 磁片磁碟機的磁片區執行片段分析，並提供進度，請輸入：

```
defrag c: mountpoint /a /u
```

若要以一般優先順序重組所有磁片區並提供詳細資訊輸出，請輸入：

```
defrag /c /h /v
```

## <a name="scheduled-task"></a>排定的工作

磁碟重組程式會以維護工作的形式執行排程工作，這通常會每週執行一次。 如果您是系統管理員，您可以使用 [ **優化磁片磁碟機** ] 應用程式來變更工作執行的頻率。

- 從排程工作執行 **時，重組** 會針對 ssd 使用下列原則指導方針：

  - **傳統的優化**程式。 包含 **傳統磁碟重組**，例如移動檔案，使其成為合理的連續和 **retrim**。 這會每個月執行一次。 但是，如果略過 **傳統磁碟重組** 和 **retrim** ，則不會執行 **分析** 。

  - 如果您在 SSD 上手動執行 **傳統磁碟重組** ，則在您的一般排程執行之間，下一次排程的工作會執行 **分析** 和 **retrim**，但會略過該 ssd 上的 **傳統磁碟重組** 。

  - 如果您略過**分析**，您將不會在 [**優化磁片磁碟機**] 應用程式中看到更新的**上次運行**時間。 因此， **上一個運行** 時間最多可達一個月。

  - 您可能會發現排定的工作尚未重組所有磁片區。 這通常是因為：

    - 此程式不會喚醒要執行的電腦。

    - 電腦未插入。 如果電腦是以電池電源執行，則不會執行此進程。

    - 電腦已啟動備份 (從閒置) 繼續。

## <a name="additional-references"></a>其他參考資料

- [命令列語法關鍵](command-line-syntax-key.md)

- [chkdsk](chkdsk.md)

- [fsutil](fsutil.md)

- [fsutil dirty](fsutil-dirty.md)

- [優化-磁片區 Powershell](/powershell/module/storage/optimize-volume?view=win10-ps)
