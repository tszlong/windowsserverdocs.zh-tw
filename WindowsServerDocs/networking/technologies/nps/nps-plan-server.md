---
title: 將 NPS 作為 RADIUS 伺服器規劃
description: 本主題提供有關 Windows Server 2016 中的網路原則伺服器 RADIUS 伺服器部署規劃的資訊。
manager: brianlic
ms.topic: article
ms.assetid: 2900dd2c-0f70-4f8d-9650-ed83d51d509a
ms.author: lizross
author: eross-msft
ms.date: 08/07/2020
ms.openlocfilehash: 3c843f4fd5bb7ed88b316fb756534b23af8007c8
ms.sourcegitcommit: 40905b1f9d68f1b7d821e05cab2d35e9b425e38d
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/06/2021
ms.locfileid: "97946664"
---
# <a name="plan-nps-as-a-radius-server"></a>將 NPS 作為 RADIUS 伺服器規劃

>適用於：Windows Server (半年度管道)、Windows Server 2016

當您將網路原則伺服器 \( NPS 部署 \) 為遠端驗證撥入消費者服務 (RADIUS) Server 時，NPS 會針對本機網域以及信任本機網域的網域，執行驗證、授權和帳戶處理的要求。 您可以使用這些規劃指導方針來簡化您的 RADIUS 部署。

這些規劃指導方針不包括您想要將 NPS 部署為 RADIUS proxy 的情況。 當您將 NPS 部署為 RADIUS proxy 時，NPS 會將連線要求轉送到執行 NPS 的伺服器或遠端網域、不受信任的網域或兩者中的其他 RADIUS 伺服器。

在您將 NPS 部署為網路上的 RADIUS 伺服器之前，請使用下列指導方針來規劃您的部署。

- 規劃 NPS 設定。

- 規劃 RADIUS 用戶端。

- 規劃使用驗證方法。

- 規劃網路原則。

- 規劃 NPS 帳戶處理。

## <a name="plan-nps-configuration"></a>規劃 NPS 設定

您必須決定 NPS 隸屬的網域。 針對多網域環境，NPS 可以驗證其所屬網域中的使用者帳號憑證，以及所有信任 NPS 本機網域的網域。 若要允許 NPS 在授權程式期間讀取使用者帳戶的撥入屬性，您必須將 NPS 的電腦帳戶新增至每個網域的 RAS 和 NPSs 群組。

在您決定 NPS 的網域成員資格之後，必須將伺服器設定為使用 RADIUS 通訊協定與 RADIUS 用戶端（也稱為網路存取伺服器）進行通訊。 此外，您可以設定 NPS 記錄在事件記錄檔中的事件種類，而且可以輸入伺服器的描述。

### <a name="key-steps"></a>重要步驟

在規劃 NPS 設定期間，您可以使用下列步驟。

- 判斷 NPS 用來從 RADIUS 用戶端接收 RADIUS 訊息的 RADIUS 埠。 預設埠是 UDP 埠1812和1645，適用于 radius 驗證訊息，而埠1813和1646適用于 RADIUS 帳戶處理訊息。

- 如果 NPS 設定有多張網路介面卡，請判斷您想要允許 RADIUS 流量的介面卡。

- 判斷您希望 NPS 在事件記錄檔中記錄的事件種類。 您可以記錄已拒絕的驗證要求、成功的驗證要求，或這兩種類型的要求。

- 判斷您是否要部署一個以上的 NPS。 若要提供 RADIUS 型驗證和帳戶處理的容錯功能，請至少使用兩個 NPSs。 其中一個 NPS 用來作為主要 RADIUS 伺服器，另一個則用來作為備份。 然後，會在這兩個 NPSs 上設定每個 RADIUS 用戶端。 如果主要 NPS 無法使用，則 RADIUS 用戶端會將 Access-Request 訊息傳送至替代的 NPS。

- 規劃用來將一個 NPS 設定複製到其他 NPSs 的腳本，以節省管理額外負荷，並防止伺服器設定不正確。 NPS 提供 Netsh 命令，可讓您將所有或部分的 NPS 設定複製到其他 NPS。 您可以在 Netsh 提示字元手動執行命令。 但是，如果您將命令順序儲存為腳本，您可以在稍後決定變更伺服器設定時執行腳本。

## <a name="plan-radius-clients"></a>規劃 RADIUS 用戶端

RADIUS 用戶端是網路存取伺服器，例如無線存取點、虛擬私人網路 (VPN) 伺服器、802.1 X 功能交換器，以及撥號伺服器。 將連接要求訊息轉送至 RADIUS 伺服器的 RADIUS proxy 也是 RADIUS 用戶端。 NPS 支援符合 RADIUS 通訊協定的所有網路存取伺服器和 RADIUS proxy，如 RFC 2865 「遠端驗證撥入使用者服務 (RADIUS) 」和 RFC 2866 「RADIUS 帳戶處理」中所述。

>[!IMPORTANT]
>存取用戶端（例如用戶端電腦）不是 RADIUS 用戶端。 只有支援 RADIUS 通訊協定的網路存取伺服器和 proxy 伺服器是 RADIUS 用戶端。

此外，無線存取點和交換器都必須能夠 802.1 X 驗證。 如果您想要部署可延伸的驗證通訊協定 \( EAP \) 或受保護的可延伸驗證通訊協定 \( PEAP \) ，存取點和交換器必須支援使用 EAP。

若要測試無線存取點的 PPP 連線的基本互通性，請將存取點和存取用戶端設定為使用密碼驗證通訊協定 (PAP) 。 使用其他以 PPP 為基礎的驗證通訊協定（例如 PEAP），直到您測試要用於網路存取的通訊協定為止。

### <a name="key-steps"></a>重要步驟

在規劃 RADIUS 用戶端時，您可以使用下列步驟。

- 記錄廠商特定的屬性 (Vsa) 您必須在 NPS 中設定。 如果您的網路存取伺服器需要 Vsa，請記錄 VSA 資訊以供稍後在 NPS 中設定網路原則時使用。

- 記錄 RADIUS 用戶端和 NPS 的 IP 位址，以簡化所有裝置的設定。 當您部署 RADIUS 用戶端時，您必須將其設定為使用 RADIUS 通訊協定，並將 NPS IP 位址輸入為驗證服務器。 當您將 NPS 設定為與您的 RADIUS 用戶端通訊時，您必須在 NPS 嵌入式管理單元中輸入 RADIUS 用戶端 IP 位址。

- 在 RADIUS 用戶端和 NPS 嵌入式管理單元中建立共用密碼以進行設定。 在 NPS 中設定 RADIUS 用戶端時，您必須使用共用密碼或密碼來設定 RADIUS 用戶端，您也會在 NPS 嵌入式管理單元中輸入這些用戶端。

## <a name="plan-the-use-of-authentication-methods"></a>規劃使用驗證方法

NPS 支援密碼型和憑證驗證方法。 不過，並非所有的網路存取伺服器都支援相同的驗證方法。 在某些情況下，您可能會想要根據網路存取的類型來部署不同的驗證方法。

例如，您可能會想要為您的組織部署無線和 VPN 存取，但針對每一種存取類型使用不同的驗證方法：適用于 VPN 連線的 EAP-TLS，原因是 EAP 與傳輸層安全性 (EAP-TLS) 提供的強大安全性，以及 802.1 X 無線連線的 PEAP-ms-chap v2。

PEAP 與 Microsoft 挑戰交握驗證通訊協定第2版 (PEAP-ms-chap v2) 提供名為 [快速重新連線] 的功能，其設計目的是要與可攜式電腦和其他無線裝置搭配使用。 快速重新連線可讓無線用戶端在相同網路上的無線存取點之間移動，而不會在每次與新的存取點產生關聯時進行重新驗證。 這可為無線使用者提供更好的體驗，並可讓他們在存取點之間移動，而不需要重新輸入認證。
由於快速重新連線以及 PEAP-ms-chap v2 提供的安全性，因此，PEAP-ms-chap v2 是一種邏輯選擇，可做為無線連線的驗證方法。

針對 VPN 連線，EAP-TLS 是一種以憑證為基礎的驗證方法，它提供強大的安全性，可保護網路流量，即使是透過網際網路從家用或行動電腦傳輸到您的組織 VPN 伺服器也一樣。

### <a name="certificate-based-authentication-methods"></a>憑證驗證方法

以憑證為基礎的驗證方法具有提供強大安全性的優點;而且它們具有比密碼型驗證方法更難部署的缺點。

PEAP-MS-CHAP v2 和 EAP-TLS 都是以憑證為基礎的驗證方法，但它們之間有許多差異，以及它們的部署方式。

### <a name="eap-tls"></a>EAP-TLS

EAP-TLS 使用憑證來進行用戶端和伺服器驗證，而且需要您在組織中部署 (PKI) 的公開金鑰基礎結構。 部署 PKI 可能很複雜，而且需要規劃階段，而不是規劃使用 NPS 做為 RADIUS 伺服器。

使用 EAP-TLS 時，NPS 會從憑證授權單位單位 CA 註冊伺服器憑證 \( \) ，而憑證會儲存在本機電腦的憑證存放區中。 在驗證過程中，當 NPS 將其伺服器憑證傳送給存取用戶端，以證明其身分識別存取用戶端時，會發生伺服器驗證。 存取用戶端會檢查各種憑證屬性，以判斷憑證是否有效，以及是否適合在伺服器驗證期間使用。 如果伺服器憑證符合最低伺服器憑證需求，而且是由存取用戶端信任的 CA 所發行，則表示 NPS 已成功通過用戶端驗證。

同樣地，用戶端驗證會在用戶端將其用戶端憑證傳送給 NPS 以向 NPS 證明其身分識別時，于驗證過程中進行。 NPS 會檢查憑證，如果用戶端憑證符合最低用戶端憑證需求，而且是由 NPS 信任的 CA 所發出，則 NPS 會成功驗證存取用戶端。

雖然伺服器憑證必須儲存在 NPS 的憑證存放區中，但用戶端或使用者憑證可以儲存在用戶端的憑證存放區或智慧卡上。

為了讓此驗證程式成功，所有電腦都必須在本機電腦和目前使用者的「信任的根憑證授權單位」憑證存放區中，擁有貴組織的 CA 憑證。

### <a name="peap-ms-chap-v2"></a>PEAP-MS-CHAP v2

PEAP-ms-chap v2 會使用憑證來進行伺服器驗證，並使用密碼認證來進行使用者驗證。 由於憑證僅用於伺服器驗證，因此您不需要部署 PKI，就能使用 PEAP-MS-CHAP v2。 當您部署 PEAP-ms-chap v2 時，您可以透過下列兩種方式之一取得 NPS 的伺服器憑證：

- 您可以安裝 Active Directory 憑證服務 (AD CS) ，然後自動註冊憑證以 NPSs。 如果您使用此方法，您也必須將 CA 憑證註冊到連線到網路的用戶端電腦，使其信任對 NPS 發出的憑證。

- 您可以從公用 CA （例如 VeriSign）購買伺服器憑證。 如果您使用此方法，請確定您選取的是用戶端電腦已經信任的 CA。 若要判斷用戶端電腦是否信任 CA，請在用戶端電腦上開啟憑證 Microsoft Management Console (MMC) 嵌入式管理單元，然後查看本機電腦和目前使用者的 [信任的根憑證授權單位] 存放區。 如果憑證存放區中的 CA 有憑證，則用戶端電腦會信任 CA，因而信任 CA 所發行的任何憑證。

在以 PEAP-ms-chap v2 進行驗證的過程中，當 NPS 將其伺服器憑證傳送到用戶端電腦時，就會進行伺服器驗證。 存取用戶端會檢查各種憑證屬性，以判斷憑證是否有效，以及是否適合在伺服器驗證期間使用。 如果伺服器憑證符合最低伺服器憑證需求，而且是由存取用戶端信任的 CA 所發行，則表示 NPS 已成功通過用戶端驗證。

使用者驗證會在使用者嘗試連接到網路類型的密碼型認證並嘗試登入時發生。 NPS 會接收認證並執行驗證和授權。 如果使用者已成功通過驗證並獲得授權，而且用戶端電腦已成功驗證 NPS，則會授與連線要求。

### <a name="key-steps"></a>重要步驟

在規劃使用驗證方法時，您可以使用下列步驟。

- 識別您打算提供的網路存取類型，例如無線、VPN、802.1 X 功能的交換器，以及撥號存取。

- 判斷您想要用於每種存取類型的驗證方法。 建議您使用以憑證為基礎的驗證方法，以提供強大的安全性;不過，部署 PKI 可能並不實用，因此其他驗證方法可能會讓您的網路需要更佳的平衡。

- 如果您要部署 EAP-TLS，請規劃您的 PKI 部署。 這包括規劃您將用於伺服器憑證和用戶端電腦憑證的憑證範本。 它也包括決定如何註冊網域成員和非網域成員電腦的憑證，以及判斷您是否想要使用智慧卡。

- 如果您部署的是 PEAP-ms-chap v2，請判斷您是否要安裝 AD CS 來發出伺服器憑證給 NPSs，或是否要從公用 CA （例如 VeriSign）購買伺服器憑證。

### <a name="plan-network-policies"></a>規劃網路原則

NPS 會使用網路原則來判斷接收自 RADIUS 用戶端的連線要求是否已獲授權。 NPS 也會使用使用者帳戶的撥入屬性來進行授權判斷。

因為網路原則會依照它們出現在 NPS 嵌入式管理單元中的順序進行處理，所以請先規劃將限制最嚴格的原則放在原則清單中。 針對每個連線要求，NPS 會嘗試將原則的條件與連接要求屬性進行比對。 NPS 會依序檢查每個網路原則，直到找到相符的網路原則為止。 如果找不到相符項，則會拒絕連接要求。

### <a name="key-steps"></a>重要步驟

在規劃網路原則時，您可以使用下列步驟。

- 判斷網路原則慣用的 NPS 處理順序，從最嚴格到最不嚴格。

- 判斷原則狀態。 原則狀態的值可以是 [已啟用] 或 [已停用]。 如果啟用此原則，NPS 會在執行授權時評估原則。 如果未啟用此原則，則不會進行評估。

- 判斷原則類型。 您必須判斷原則是否設計為在連線要求符合原則的條件時授與存取權，或原則是否設計為在要求符合原則的條件時，拒絕存取。 例如，如果您想要明確拒絕對 Windows 群組成員的無線存取，您可以建立網路原則來指定群組、無線連接方法，以及具有 [拒絕存取] 原則類型設定的網路原則。

- 判斷您是否希望 NPS 忽略以原則為基礎之群組成員之使用者帳戶的撥入屬性。 如果未啟用此設定，使用者帳戶的撥入屬性會覆寫網路原則中設定的設定。 例如，如果設定的網路原則授與使用者存取權，但該使用者的使用者帳戶的撥入內容設定為 [拒絕存取]，則會拒絕使用者存取。 但是，如果您啟用 [略過使用者帳戶撥入內容] 原則類型設定，則會將網路的存取權授與相同的使用者。

- 判斷原則是否使用原則來源設定。 此設定可讓您輕鬆地指定所有存取要求的來源。 可能的來源為終端機服務閘道 (TS 閘道) 、遠端存取服務器 (VPN 或撥號) 、DHCP 伺服器、無線存取點，以及健康情況登錄授權單位伺服器。 或者，您也可以指定供應商專屬的來源。

- 判斷必須符合才能套用網路原則的條件。

- 判斷當連線要求符合網路原則的條件時，所套用的設定。

- 判斷您想要使用、修改或刪除預設網路原則。

## <a name="plan-nps-accounting"></a>規劃 NPS 帳戶處理

NPS 能以三種格式記錄 RADIUS 帳戶處理資料，例如使用者驗證和帳戶處理要求： IAS 格式、與資料庫相容的格式，以及 Microsoft SQL Server 記錄。

IAS 格式和資料庫相容格式會在本機 NPS 上以文本檔案格式建立記錄檔。

SQL Server 記錄功能可讓您記錄至 SQL Server 2000 或 SQL Server 2005 XML 相容的資料庫，並擴充 RADIUS 帳戶處理以利用記錄至關係資料庫的優點。

### <a name="key-steps"></a>重要步驟

在規劃 NPS 帳戶處理期間，您可以使用下列步驟。

- 判斷您是否要將 NPS 帳戶處理資料儲存在記錄檔或 SQL Server 資料庫中。

### <a name="nps-accounting-using-local-log-files"></a>使用本機記錄檔的 NPS 帳戶處理

記錄檔中的使用者驗證和帳戶處理要求主要用於連線分析和計費，而且也可做為安全性調查工具，提供在攻擊之後追蹤惡意使用者活動的方法。

### <a name="key-steps"></a>重要步驟

使用本機記錄檔規劃 NPS 帳戶處理期間，您可以使用下列步驟。

- 判斷您想要用於 NPS 記錄檔的文本檔案格式。

- 選擇您要記錄的資訊類型。 您可以記錄會計要求、驗證要求和定期狀態。

- 決定您要儲存記錄檔的硬碟位置。

- 設計您的記錄檔案備份解決方案。 儲存記錄檔的硬碟位置應該是可讓您輕鬆備份資料的位置。 此外，您應該藉由設定儲存記錄檔之資料夾 (ACL) 的存取控制清單來保護硬碟位置。

- 決定您想要建立新記錄檔的頻率。 如果您想要根據檔案大小建立記錄檔，請在 NPS 建立新的記錄檔之前，判斷允許的檔案大小上限。

- 判斷是否要在硬碟用盡儲存空間時，讓 NPS 刪除較舊的記錄檔。

- 判斷您想要用來查看帳戶處理資料和產生報告的應用程式。

### <a name="nps-sql-server-logging"></a>NPS SQL Server 記錄

當您需要會話狀態資訊、建立報表和資料分析用途，以及集中化和簡化您的計量資料管理時，會使用 NPS SQL Server 記錄。

NPS 可讓您使用 SQL Server 記錄，將從一或多個網路存取伺服器接收到的使用者驗證和帳戶處理要求，記錄到執行 Microsoft SQL Server 桌面引擎 MSDE 2000 的電腦上的資料來源 \( \) ，或晚于 SQL Server 2000 的任何 SQL Server 版本。

計量資料會以 XML 格式從 NPS 傳遞至資料庫中的預存程式，同時支援結構化查詢語言 \( SQL \) 和 XML \( SQLXML \) 。 在符合 XML 規範的 SQL Server 資料庫中記錄使用者驗證和帳戶處理要求，可讓多個 NPSs 有一個資料來源。

### <a name="key-steps"></a>重要步驟

使用 NPS SQL Server 記錄來規劃 NPS 帳戶處理期間，您可以使用下列步驟。

- 判斷您或組織的其他成員是否有 SQL Server 2000 或 SQL Server 2005 關係資料庫開發經驗，並瞭解如何使用這些產品來建立、修改、管理及管理 SQL Server 資料庫。

- 判斷 SQL Server 是否安裝在 NPS 或遠端電腦上。

- 設計您將在 SQL Server 資料庫中使用的預存程式，以處理包含 NPS 帳戶處理資料的傳入 XML 檔案。

- 設計 SQL Server 資料庫複寫結構和流程。

- 判斷您想要用來查看帳戶處理資料和產生報告的應用程式。

- 規劃使用在所有會計要求中傳送類別屬性的網路存取伺服器。 類別屬性會傳送至 Access-Accept 訊息中的 RADIUS 用戶端，而且適用于將 Accounting-Request 訊息與驗證會話相互關聯。 如果類別屬性是由網路存取伺服器在會計要求訊息中傳送，則可以用來比對帳戶和驗證記錄。 屬性的唯一-序號、服務重新開機時間和 Server-Address 的組合必須是伺服器所接受之每個驗證的唯一識別碼。

- 規劃使用支援暫時帳戶處理的網路存取伺服器。

- 規劃使用會傳送帳戶處理和帳戶處理訊息的網路存取伺服器。

- 規劃使用支援儲存和轉送計量資料的網路存取伺服器。 支援此功能的網路存取伺服器可以在網路存取伺服器無法與 NPS 通訊時儲存帳戶處理資料。 當 NPS 可供使用時，網路存取伺服器會將儲存的記錄轉送到 NPS，藉此在不提供此功能的網路存取伺服器上提供更高的帳戶管理可靠性。

- 規劃一律在網路原則中設定 [帳戶-間歇間隔] 屬性。 [帳戶過渡間隔] 屬性會設定網路存取伺服器傳送的每個暫時更新之間的間隔（以秒為單位） () 。 根據 RFC 2869，[帳戶-過渡間隔] 屬性的值不得小於60秒或一分鐘，且不應小於600秒或10分鐘。 如需詳細資訊，請參閱 RFC 2869 「RADIUS 延伸模組」。

- 確定您的 NPSs 已啟用定期狀態的記錄。

