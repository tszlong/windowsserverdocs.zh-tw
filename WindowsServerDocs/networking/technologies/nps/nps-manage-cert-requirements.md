---
title: 設定 PEAP 與 EAP 需求的憑證範本
description: 本主題提供在 Windows Server 2016 中使用具有網路原則伺服器和遠端存取之憑證的相關資訊。
manager: brianlic
ms.topic: article
ms.assetid: 2af0a1df-5c44-496b-ab11-5bc340dc96f0
ms.author: lizross
author: eross-msft
ms.date: 08/07/2020
ms.openlocfilehash: 4f1680c37510a0a45dfc4ce1ce34ca62859a8f09
ms.sourcegitcommit: 40905b1f9d68f1b7d821e05cab2d35e9b425e38d
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/06/2021
ms.locfileid: "97948984"
---
# <a name="configure-certificate-templates-for-peap-and-eap-requirements"></a>設定 PEAP 與 EAP 需求的憑證範本

>適用於：Windows Server (半年度管道)、Windows Server 2016

使用可延伸的驗證通訊協定 \- 傳輸層安全性 \( EAP \- tls \) 、受保護的可延伸驗證通訊協定 \- 傳輸層安全性 \( PEAP \- Tls \) ，以及 PEAP \- Microsoft 挑戰交握驗證通訊協定第2版 MS CHAP v2 的所有憑證，都 \( \- \) 必須符合 X.509 憑證的需求，並且適用于使用安全通訊端層/傳輸層級安全性 (SSL/TLS) 的連線。 用戶端與伺服器憑證都有其他需求。

>[!IMPORTANT]
>本主題提供設定憑證範本的指示。 若要使用這些指示，您必須 \( \) 使用 Active Directory 憑證服務 AD CS 來部署自己的公開金鑰基礎結構 PKI \( \) 。

## <a name="minimum-server-certificate-requirements"></a>伺服器憑證的最低需求

使用 PEAP \- MS \- CHAP V2、PEAP \- tls 或 EAP \- tls 做為驗證方法時，NPS 必須使用符合最低伺服器憑證需求的伺服器憑證。

用戶端電腦可以設定為使用用戶端電腦或群組原則中的 [ **驗證伺服器憑證** ] 選項來驗證伺服器憑證。

當伺服器憑證符合下列需求時，用戶端電腦會接受伺服器的驗證嘗試：

- 主體名稱包含值。 如果您將憑證發行至執行網路原則伺服器的伺服器 (NPS) 具有空白的主體名稱，則憑證無法用來驗證您的 NPS。 使用主體名稱設定憑證範本：

    1. 開啟 [憑證範本]。
    2. 在詳細資料窗格中，以滑鼠 **按右鍵您** 要變更的憑證範本，然後按一下 [內容]。
    3. 按一下 [ **主體名稱** ] 索引標籤，然後從此 **Active Directory 資訊中** 按一下 [建立]。
    4. 在 [ **主體名稱格式**] 中，選取 [ **無**] 以外的值。

- 伺服器上的電腦憑證會連結至受信任的根憑證授權單位 (CA) 而且不會使 CryptoAPI 執行的任何檢查和遠端存取原則或網路原則中所指定的檢查失敗。

- NPS 或 VPN 伺服器的電腦憑證設定為使用擴充金鑰使用方式的伺服器驗證目的 (EKU) 擴充功能。  (伺服器驗證的物件識別碼為1.3.6.1.5.5.7.3.1。 ) 

- 使用必要的密碼編譯設定來設定伺服器憑證：

    1. 開啟 [憑證範本]。
    2. 在詳細資料窗格中，以滑鼠 **按右鍵您** 要變更的憑證範本，然後按一下 [內容]。
    3. 按一下 [ **密碼** 編譯] 索引標籤，並請務必設定下列各項：
       - **提供者類別：** 金鑰儲存提供者
       - **演算法名稱：** Rsa
       - **提供者：** Microsoft 平臺密碼編譯提供者
       - **最小金鑰大小：** 2048
       - **雜湊演算法：** SHA2
    4. 按一下 [下一步] 。

- 如果使用主體別名 (SubjectAltName) 延伸，必須包含伺服器的 DNS 名稱。 若要使用網域名稱系統設定憑證範本 (註冊伺服器的 DNS) 名稱：

    1. 開啟 [憑證範本]。
    2. 在詳細資料窗格中，以滑鼠 **按右鍵您** 要變更的憑證範本，然後按一下 [內容]。
    3. 按一下 [ **主體名稱** ] 索引標籤，然後從此 **Active Directory 資訊中** 按一下 [建立]。
    4. 在 [在次要 **主體名稱中包含這些資訊**] 中，選取 [ **DNS 名稱**]。

使用 PEAP 和 EAP-TLS 時，NPSs 會顯示電腦憑證存放區中所有已安裝的憑證清單，但有下列例外狀況：

- 不會顯示在 EKU 延伸中不包含伺服器驗證目的之憑證。

- 不會顯示不包含主體名稱的憑證。

- 不會顯示已登錄的憑證以及智慧卡登入憑證。

如需詳細資訊，請參閱 [部署 802.1 x 有線和無線部署的伺服器憑證](../../core-network-guide/cncg/server-certs/deploy-server-certificates-for-802.1x-wired-and-wireless-deployments.md)。

## <a name="minimum-client-certificate-requirements"></a>用戶端憑證的最低需求

透過 EAP-TLS 或 PEAP-TLS，當憑證符合下列需求時，伺服器會接受用戶端驗證嘗試：

- 用戶端憑證是由企業 CA 發出，或對應至 Active Directory Domain Services AD DS 中的使用者或電腦 \( 帳戶 \) 。

- 用戶端上的使用者或電腦憑證會鏈至信任的根 CA，包括 EKU 延伸中的用戶端驗證目的： \( 1.3.6.1.5.5.7.3.2 用戶端驗證的物件識別碼 \) ，而不會使 CryptoAPI 執行的檢查和遠端存取原則或網路原則中所指定的檢查，以及 NPS 網路原則中所指定的憑證物件識別碼檢查失敗。

- 802.1X 用戶端不會使用已登錄的憑證，它們包括智慧卡登入憑證或是受密碼保護的憑證。

- 針對使用者憑證，憑證中的主體別名 \( SubjectAltName \) 延伸包含使用者主體名稱 \( UPN \) 。 在憑證範本中設定 UPN：

    1. 開啟 [憑證範本]。
    2. 在詳細資料窗格中，以滑鼠 **按右鍵您** 要變更的憑證範本，然後按一下 [內容]。
    3. 按一下 [ **主體名稱** ] 索引標籤，然後從此 **Active Directory 資訊中** 按一下 [建立]。
    4. 在 [在次要 **主體名稱中包含這些資訊**] 中，選取 [**使用者主要名稱 \( UPN \)**]。

- 若為電腦憑證，憑證中的主體別名 \( SubjectAltName \) 延伸模組必須包含用戶端的完整功能變數名稱 \( FQDN \) （也稱為 *DNS 名稱*）。 在憑證範本中設定此名稱：

    1. 開啟 [憑證範本]。
    2. 在詳細資料窗格中，以滑鼠 **按右鍵您** 要變更的憑證範本，然後按一下 [內容]。
    3. 按一下 [ **主體名稱** ] 索引標籤，然後從此 **Active Directory 資訊中** 按一下 [建立]。
    4. 在 [在次要 **主體名稱中包含這些資訊**] 中，選取 [ **DNS 名稱**]。

使用 PEAP \- tls 和 EAP \- tls 時，用戶端會在 [憑證] 嵌入式管理單元中顯示所有已安裝憑證的清單，但有下列例外狀況：

- 無線用戶端不會顯示已登錄的憑證以及智慧卡登入憑證。

- 無線用戶端與 VPN 用戶端不會顯示受密碼保護的憑證。

- 不會顯示在 EKU 延伸中不包含用戶端驗證目的之憑證。


如需有關 NPS 的詳細資訊，請參閱 [網路原則伺服器 (nps) ](nps-top.md)。