---
description: 深入了解：Windows 時間服務的運作方式
ms.assetid: d1953097-63ea-4a0e-b860-2f3b7c175c41
title: Windows 時間服務的運作方式
author: dahavey
ms.author: dahavey
ms.date: 05/08/2018
ms.topic: article
ms.openlocfilehash: 66b24e4f1b99ba13e48520743069fc4aff4abf28
ms.sourcegitcommit: 6a62d736e4d9989515c6df85e2577662deb042b6
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/11/2021
ms.locfileid: "98103660"
---
# <a name="how-the-windows-time-service-works"></a>Windows 時間服務的運作方式

>適用於：Windows Server 2016、Windows Server 2012 R2、Windows Server 2012、Windows 10 或更新版本

**本節內容**

-   [Windows Time 服務架構](#windows-time-service-architecture)

-   [Windows Time 服務的時間通訊協定](#windows-time-service-time-protocols)

-   [Windows Time 服務程序與互動](#windows-time-service-processes-and-interactions)

-   [Windows Time 服務所使用的網路連接埠](#network-ports-used-by-windows-time-service)

> [!NOTE]
> 本主題僅說明 Windows Time 服務 (W32Time) 的運作方式。 如需如何設定 Windows Time 服務的相關資訊，請參閱[設定高準確度的系統](configuring-systems-for-high-accuracy.md)。

> [!NOTE]
> 在 Windows Server 2003 和 Microsoft Windows 2000 Server 中，目錄服務稱為 Active Directory 目錄服務。 在 Windows Server 2008 和更新版本中，目錄服務稱為 Active Directory 網域服務 (AD DS)。 本主題的其餘部分請參閱 AD DS，但這項資訊也適用於 Active Directory。

雖然 Windows Time 服務不是網路時間通訊協定 (NTP) 的確切實作，但其會使用在 NTP 規格中定義的複雜演算法套件，確保網路上電腦的時鐘盡可能準確。 在理想情況下，AD DS 網域中的所有電腦時鐘都會與權威性電腦的時間進行同步處理。 許多因素都可能影響網路上的時間同步處理。 下列因素通常會影響 AD DS 中同步處理的準確度：

-   網路條件

-   電腦硬體時鐘的準確度

-   Windows Time 服務可用的 CPU 和網路資源數量

> [!IMPORTANT]
> 在 Windows Server 2016 之前，W32Time 服務並非設計來滿足有時效性應用程式的需求。  但現在，Windows Server 2016 的更新可讓您在網域中實作需要 1 毫秒準確度的解決方案。  如需詳細資訊，請參閱 [Windows 2016 的準確時間](accurate-time.md)和[可為高準確度環境設定 Windows Time 服務的支援界限](support-boundary.md)。

根據預設，較不常同步其時間或未加入網域的電腦會設定為要與 time.windows.com 同步處理。  因此，無法在具有間歇網路連線或沒有網路連線的電腦上保證其時間準確度。

AD DS 樹系具有預先決定的時間同步處理階層。 Windows Time 服務會在階層內的電腦之間同步處理時間，而最準確的參考時鐘位於最上方。 如果電腦上設定了多個時間來源，則 Windows Time 會使用 NTP 演算法，根據電腦與時間來源同步處理的能力，從所設定的來源中選取最佳的時間來源。 Windows Time 服務不支援從廣播或多點傳送對等項目進行網路同步處理。 如需這些 NTP 功能的詳細資訊，請參閱 IETF RFC 資料庫中的 RFC 1305。

每部執行 Windows Time 服務的電腦都會使用此服務來維持最準確的時間。 身為網域成員的電腦預設會當作時間用戶端，因此在大部分情況下，不需要設定 Windows Time 服務。 不過，可以將 Windows Time 服務設定為向指定的參考時間來源要求時間，也可以提供時間給用戶端。

電腦時間的準確程度稱為「層次」。 網路上最準確的時間來源 (例如硬體時鐘) 會佔用最低層次層級，或層次一。 此準確時間來源稱為「參考時鐘」。 從參考時鐘直接取得時間的 NTP 伺服器會佔用高於參考時鐘一層的層次。 從 NTP 伺服器取得時間的資源與參考時鐘相差兩級，因此會佔用高於最準確時間來源兩層的層次，依此類推。 隨著電腦的層次編號增加，其系統時鐘的時間可能會變得比較不準確。 因此，任何電腦的層次層級都是一個指標，指出該電腦與最準確的時間來源同步處理的緊密程度。

當 W32Time 管理員收到時間樣本時，其會使用 NTP 中的特殊演算法來判斷哪個時間樣本最適合使用。 時間服務也會使用另一組演算法來判斷哪些已設定的時間來源最準確。 當時間服務判斷哪個時間樣本最好時，根據上述準則，其會調整本機時脈頻率，使其能夠趨近正確的時間。 如果本機時鐘與所選的準確時間樣本之間的時間差異 (也稱為「時間偏移」) 太大，以致無法藉由調整本機時脈頻率來更正，則時間服務會將本機時鐘設定為正確的時間。 這種時脈頻率或直接時鐘時間變更的調整也稱為「時鐘約束」。

## <a name="windows-time-service-architecture"></a>Windows Time 服務架構
Windows Time 服務包含下列元件：

-   服務控制管理員

-   Windows Time Service Manager

-   時鐘約束

-   時間提供者

下圖顯示 Windows Time 服務的架構。

**Windows Time 服務架構**

![下圖顯示 Windows Time 服務的架構。](../media/Windows-Time-Service/How-the-Windows-Time-Service-Works/trnt_sec_arcc.gif)

服務控制管理員負責啟動和停止 Windows Time 服務。 Windows Time Service Manager 負責起始作業系統所隨附 NTP 時間提供者的動作。 Windows Time Service Manager 會控制 Windows Time 服務的所有功能，以及所有時間樣本的聯合。 除了提供目前系統狀態的相關資訊 (例如目前時間來源或上次更新系統時鐘的時間) 以外，Windows Time Service Manager 也會負責在事件記錄中建立事件。

時間同步處理程序包含下列步驟：

-   輸入提供者會從所設定的 NTP 時間來源要求和接收時間樣本。

-   然後，這些時間樣本會傳遞至 Windows Time Service Manager，其會收集所有樣本並傳遞至時鐘約束子元件。

-   時鐘約束子元件會套用 NTP 演算法，以致能選取最佳的時間樣本。

-   時鐘約束子元件會調整時脈頻率或直接變更時間，以將系統時鐘的時間調整為最準確的時間。

如果電腦已指定為時間伺服器，則可在此程序的任何時間點，將時間傳送到任何要求時間同步處理的電腦。

## <a name="windows-time-service-time-protocols"></a>Windows Time 服務的時間通訊協定

時間通訊協定可決定兩部電腦時鐘的同步處理緊密程度。 時間通訊協定負責判斷最佳的可用時間資訊並使時鐘趨近，以確保在不同的系統上維護一致的時間。

Windows Time 服務會使用網路時間通訊協定 (NTP) 來協助跨網路同步處理時間。 NTP 是一種網際網路時間通訊協定，其中包含同步時鐘所需的約束演算法。 相較於在某些 Windows 版本中使用的簡易網路時間通訊協定 (SNTP)，NTP 是更準確的時間通訊協定。不過，W32Time 會繼續支援 SNTP，以提供與執行 SNTP 型時間服務的電腦 (例如 Windows 2000) 的回溯相容性。

### <a name="network-time-protocol"></a>網路時間通訊協定
網路時間通訊協定 (NTP) 是作業系統中 Windows Time 服務所使用的預設時間同步通訊協定。 NTP 是容錯、可高度擴充的時間通訊協定，而且是使用指定的時間參考來同步處理電腦時鐘時最常使用的通訊協定。

NTP 時間同步處理會在一段時間內進行，並涉及透過網路傳送 NTP 封包。 NTP 封包包含時間戳記，其中包含來自參與時間同步處理的用戶端與伺服器的時間樣本。

NTP 依賴參考時鐘來定義所要使用的最準確時間，並將網路上的所有時鐘同步處理至該參考時鐘。 NTP 使用國際標準時間 (UTC) 作為目前時間的通用標準。 UTC 與時區無關，可讓您在世界各地使用 NTP，而不管時區設定為何。

#### <a name="ntp-algorithms"></a>NTP 演算法
NTP 包含兩個演算法 (時鐘篩選演算法和時鐘選取演算法)，可協助 Windows Time 服務判斷最佳的時間樣本。 時鐘篩選演算法的設計訴求是要透過從查詢的時間來源接收的時間樣本進行篩選，並判斷每個來源的最佳時間樣本。 然後，時鐘選取演算法會判斷網路上最準確的時間伺服器。 此資訊會接著傳遞至時鐘約束演算法，其使用所收集的資訊來更正電腦的本機時鐘，同時補償因網路延遲和電腦時鐘不準確而造成的錯誤。

在輕至中度的網路和伺服器負載情況下，NTP 演算法最準確。 如同任何將網路傳輸時間納入考量的演算法，在極端網路擁塞的狀況下，NTP 演算法的執行狀況可能不佳。 如需 NTP 演算法的詳細資訊，請參閱 IETF RFC 資料庫中的 RFC 1305。

#### <a name="ntp-time-provider"></a>NTP 時間提供者
Windows Time 服務是完整的時間同步處理套件，可支援各種硬體裝置和時間通訊協定。 為了啟用這項支援，服務會使用可插入的時間提供者。 時間提供者負責取得準確的時間戳記 (從網路或硬體)，或透過網路將這些時間戳記提供給其他電腦。

NTP 提供者是作業系統隨附的標準時間提供者。 NTP 提供者會遵循 NTP 第 3 版針對用戶端和伺服器指定的標準，而且可與 SNTP 用戶端和伺服器互動，以提供與 Windows 2000 和其他 SNTP 用戶端的回溯相容性。 Windows Time 服務中的 NTP 提供者包含下列兩個部分：

-   **NtpServer 輸出提供者。** 這是可回應網路上用戶端時間要求的時間伺服器。

-   **NtpClient 輸入提供者。** 這是從其他來源 (硬體裝置或 NTP 伺服器) 取得時間資訊的時間用戶端，其可傳回適合用於同步處理本機時鐘的時間樣本。

雖然這兩個提供者的實際作業密切相關，但是與時間服務無關。 從 Windows 2000 Server 開始，當 Windows 電腦連線到網路時，其會設定為 NTP 用戶端。 此外，執行 Windows Time 服務的電腦只會嘗試與網域控制站或依預設手動指定的時間來源同步處理時間。 這些都是慣用的時間提供者，因為其是自動提供且安全的時間來源。

#### <a name="ntp-security"></a>NTP 安全性

在 AD DS 樹系中，Windows Time 服務會依賴標準網域安全性功能來強制執行時間資料的驗證。 在網域成員電腦與當作時間伺服器的區域網域控制站之間傳送的 NTP 封包，其安全性是以共用金鑰驗證為基礎。 Windows Time 服務會使用電腦的 Kerberos 工作階段金鑰，在透過網路傳送的 NTP 封包上建立已驗證的簽章。 NTP 封包不會在 Net Logon 安全通道內傳輸。 然而，當電腦向網域階層中的網域控制站要求時間時，Windows Time 服務會要求驗證時間。 接著，網域控制站會以 64 位元值的形式傳回所需的資訊，而該資訊已經過 Net Logon 服務的工作階段金鑰驗證。 如果傳回的 NTP 封包並未以電腦的工作階段金鑰簽署，或未正確地簽署，時間則會遭到拒絕。 所有這類驗證失敗都會記錄在事件記錄中。 如此一來，Windows Time 服務就會為 AD DS 樹系中的 NTP 資料提供安全性。

一般來說，Windows 時間用戶端會自動取得準確的時間，以便從相同網域中的網域控制站進行同步處理。 在樹系中，子網域的網域控制站會與其父系網域中的網域控制站同步處理時間。 當時間伺服器將已驗證的 NTP 封包傳回給要求時間的用戶端時，此封包會經由網域間信任帳戶所定義的 Kerberos 工作階段金鑰簽署。 當新的 AD DS 網域加入樹系，且 Net Logon 服務管理工作階段金鑰時，就會建立網域間信任帳戶。 如此一來，在樹系根網域中設為可靠的網域控制站，就會成為父系網域和子系網域中所有網域控制站的已驗證時間來源，且間接適用於網域樹系中的所有電腦。

您可將 Windows Time 服務設定為在樹系之間運作，但務必注意，此設定並不安全。 例如，NTP 伺服器可能適用於不同的樹系。 不過，因為該電腦位於不同的樹系，所以沒有任何 Kerberos 工作階段金鑰可用來簽署和驗證 NTP 封包。 若要從不同樹系中的電腦取得準確的時間同步處理，用戶端需要該電腦的網路存取權，而時間服務必須設定為使用位於其他樹系的特定時間來源。 如果手動將用戶端設定為從其網域階層外的 NTP 伺服器存取時間，則在用戶端與時間伺服器之間傳送的 NTP 封包不會經過驗證，因此不安全。 即使是實作樹系信任，Windows Time 服務也不是跨樹系安全的。 雖然 Net Logon 安全通道是 Windows Time 服務的驗證機制，但不支援跨樹系驗證。

#### <a name="hardware-devices-that-are-supported-by-the-windows-time-service"></a>Windows Time 服務所支援的硬體裝置
硬體型時鐘 (例如 GPS 或無線電時鐘) 通常用來作為高度準確的參考時鐘裝置。 雖然有可能建立可支援這類連線的軟體型獨立時間提供者，但根據預設，Windows Time 服務 NTP 時間提供者不支援將硬體裝置直接連線到電腦。 這類提供者結合 Windows Time 服務，可提供可靠且穩定的時間參考。

硬體裝置 (例如銫鐘或全球定位系統 (GPS) 接收器) 會遵循標準來取得準確的時間定義，以提供準確的目前時間。 銫鐘極度穩定，不會受到溫度、壓力或濕度等因素影響，但也非常昂貴。 GPS 接收器的運作成本較低，也是準確的參考時鐘。 GPS 接收器會從衛星取得其時間，而衛星則是從銫鐘取得其時間。 若未使用獨立的時間提供者，Windows Time 伺服器可連線到外部 NTP 伺服器 (其透過電話或網際網路連線到硬體裝置)，以取得其時間。 美國海軍天文台等組織會提供已連線到極度可靠參考時鐘的 NTP 伺服器。

許多 GPS 接收器和其他時間裝置都可以當作網路上的 NTP 伺服器。 您可以設定 AD DS 樹系，使其只有在同時當作網路上的 NTP 伺服器時，才能從這些外部硬體裝置同步處理時間。 若要這麼做，請將您的樹系根網域中當作主網域控制站 (PDC) 模擬器的網域控制站，設定為要與 GPS 裝置所提供的 NTP 伺服器同步處理。 若要這麼做，請參閱[在樹系根網域中的 PDC 模擬器上設定 Windows Time 服務](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc731191%28v=ws.10%29)。

### <a name="simple-network-time-protocol"></a>簡易網路時間通訊協定
簡易網路時間通訊協定 (SNTP) 是一種簡化的時間通訊協定，適用於不需要 NTP 所提供準確度的伺服器和用戶端。 SNTP (更基本的 NTP 版本) 是 Windows 2000 中使用的主要時間通訊協定。 由於 SNTP 和 NTP 的網路封包格式完全相同，因此這兩種通訊協定是互通的。 兩者的主要差異在於，SNTP 沒有 NTP 所提供的錯誤管理和複雜篩選系統。 如需簡易網路時間通訊協定的詳細資訊，請參閱 IETF RFC 資料庫中的 RFC 1769。

### <a name="time-protocol-interoperability"></a>時間通訊協定互通性
Windows Time 服務可以在執行 Windows 2000、Windows XP 和 Windows Server 2003 的電腦混合環境中運作，因為 Windows 2000 中使用的 SNTP 通訊協定可與 Windows XP 和 Windows Server 2003 中的 NTP 通訊協定互通。

Windows NT Server 4.0 中的時間服務 (稱為 TimeServ) 會跨 Windows NT 4.0 網路同步處理時間。 TimeServ 是 Microsoft Windows NT 4.0 Resource Kit  隨附的附加元件功能，並不提供 Windows Server 2003 所需的時間同步處理可靠度。

Windows Time 服務可與執行 Windows NT 4.0 的電腦互通，因為這些電腦可與執行 Windows 2000 或 Windows Server 2003 的電腦同步處理時間。不過，執行 Windows 2000 或 Windows Server 2003 的電腦不會自動探索 Windows NT 4.0 時間伺服器。 例如，如果您的網域已設為使用以網域階層為基礎的同步處理方法來同步處理時間，而您想要讓網域階層中的電腦與 Windows NT 4.0 網域控制站同步處理時間，則必須手動設定這些電腦，使其與 Windows NT 4.0 網域控制站同步處理。

Windows NT 4.0 使用的時間同步處理機制比 Windows Time 服務所所用的還簡單。 因此，為了確保準確的跨網路時間同步處理，建議您將 Windows NT 4.0 網域控制站升級為 Windows 2000 或 Windows Server 2003。

## <a name="windows-time-service-processes-and-interactions"></a>Windows Time 服務程序與互動

Windows Time 服務的設計訴求是要同步處理網路上的電腦時鐘。 當每部電腦從更準確的時間伺服器存取時間時，網路時間同步處理程序 (也稱為時間聚合) 會發生於整個網路。 時間聚合涉及一個程序，而權威性伺服器會藉此程序，將目前的時間以 NTP 封包形式提供給用戶端電腦。 封包中提供的資訊指出是否需要對電腦的目前時鐘時間進行調整，以便與更準確的伺服器同步處理。

在時間聚合程序中，網域成員會嘗試與相同網域中的任何網域控制站同步處理時間。 如果電腦是網域控制站，則會嘗試與更具權威性的網域控制站進行同步處理。

執行 Windows XP Home Edition 的電腦或未加入網域的電腦不會嘗試與網域階層進行同步處理，但預設會設定為從 time.windows.com 取得時間。

若要將執行 Windows Server 2003 的電腦建立為權威性電腦，該電腦必須設為可靠的時間來源。 根據預設，安裝在 Windows Server 2003 網域上的第一個網域控制站會自動設為可靠的時間來源。 因為其是網域的權威性電腦，所以必須設定為要與外部時間來源 (而不是網域階層) 同步處理。 此外，根據預設，所有其他 Windows Server 2003 網域成員都會設定為要與網域階層進行同步處理。

建立 Windows Server 2003 網路之後，您可以將 Windows Time 服務設定為使用下列其中一個選項進行同步處理：

-   以網域階層為基礎的同步處理

-   手動指定的同步處理來源

-   所有可用的同步處理機制

-   無同步處理。

下一節會討論各種同步處理類型。

### <a name="domain-hierarchy-based-synchronization"></a>以網域階層為基礎的同步處理

以網域階層為基礎的同步處理會使用 AD DS 網域階層，尋找用來同步處理時間的可靠來源。 Windows Time 服務會根據網域階層，判斷每個時間伺服器的準確度。 在 Windows Server 2003 樹系中，持有網域主控站 (PDC) 模擬器作業主要角色的電腦 (位於樹系根網域中) 會保有最佳時間來源的地位，除非已設定另一個可靠的時間來源。 下圖說明網域階層中電腦之間的時間同步處理路徑。

**AD DS 階層中的時間同步處理**
![Windows 時間](../media/Windows-Time-Service/How-the-Windows-Time-Service-Works/trnt_ntw_adhc.gif)

#### <a name="reliable-time-source-configuration"></a>可靠的時間來源設定
設為可靠時間來源的電腦會被視為時間服務的根目錄。 時間服務的根目錄是網域的權威性伺服器，通常會設為從外部 NTP 伺服器或硬體裝置擷取時間。 您可將時間伺服器設定為可靠的時間來源，以將在網域階層內傳送時間的方式最佳化。 如果網域控制站設為可靠的時間來源，Net Logon 服務會在登入網路時，將此網域控制站宣佈為可靠的時間來源。 當其他網域控制站尋找要與其同步處理的時間來源時，會先選擇可靠的來源 (如果有的話)。

#### <a name="time-source-selection"></a>資料來源選取
時間來源選取程序可能會在網路上產生兩個問題：

-   其他同步處理週期。

-   增加網路流量。

當網域控制站群組之間的時間保持一致，且相同的時間持續在其間共用，而不需與其他可靠的時間來源重新同步處理時，同步處理網路中的週期就會發生。 Windows Time 服務的時間來源選取演算法的設計訴求是要保護這些類型的問題。

電腦會使用下列其中一種方法來識別要與其同步處理的時間來源：

-   如果電腦不是網域成員，則必須將其設為要與指定的時間來源同步處理。

-   如果電腦是網域內的成員伺服器或工作站，則根據預設，其會遵循 AD DS 階層，並將其時間與目前執行 Windows Time 服務的區域網域中的網域控制站同步處理。

如果電腦是網域控制站，則最多可進行六次查詢，以找出要與其同步處理的另一個網域控制站。 每次查詢的設計訴求都是要識別出具有特定屬性的時間來源，例如某個類型的網域控制站、特定位置，以及是否為可靠的時間來源。 時間來源也必須遵守下列條件約束：

-   可靠的時間來源只能與父系網域中的網域控制站進行同步處理。

-   PDC 模擬器可與在其網域中的可靠時間來源或或父系網域中的任何網域控制站進行同步處理。

如果網域控制站無法與正在查詢的網域控制站類型同步處理，就不會進行查詢。 網域控制站知道在進行查詢之前，可以從哪種類型的電腦取得時間。 例如，本機 PDC 模擬器不會嘗試查詢數字 3 或 6，因為網域控制站不會嘗試與其本身進行同步處理。

下表列出網域控制站用來尋找時間來源的查詢，以及查詢的執行順序。

**網域控制站時間來源查詢**

|查詢編號|網域控制站|位置|時間來源的可靠性|
|----------------|---------------------|------------|------------------------------|
|1|父系網域控制站|網站內|偏好可靠的時間來源，但其可與不可靠的時間來源 (如果這是僅有的可用來源) 進行同步處理。|
|2|區域網域控制站|網站內|只會與可靠的時間來源進行同步處理。|
|3|本機 PDC 模擬器|網站內|不適用。<p>網域控制站不會嘗試與其本身進行同步處理。|
|4|父系網域控制站|網站外|偏好可靠的時間來源，但其可與不可靠的時間來源 (如果這是僅有的可用來源) 進行同步處理。|
|5|區域網域控制站|網站外|只會與可靠的時間來源進行同步處理。|
|6|本機 PDC 模擬器|網站外|不適用。<p>網域控制站不會嘗試與其本身進行同步處理。|

**注意**

-   電腦永遠不會與其本身進行同步處理。 如果嘗試同步處理的電腦是本機 PDC 模擬器，則不會嘗試查詢 3 或 6。

每個查詢都會傳回可作為時間來源的網域控制站清單。 Windows Time 會根據網域控制站的可靠性和位置，指派可查詢分數的每個網域控制站。 下表列出 Windows Time 指派給每種網域控制站類型的分數。

**分數判定**

|網域控制站狀態|分數|
|----------------------------|---------|
|位於相同網站的網域控制站|8|
|已標示為可靠時間來源的網域控制站|4|
|位於父系網域的網域控制站|2|
|作為 PDC 模擬器的網域控制站|1|

當 Windows Time 服務判定其已識別出具有最佳可能分數的網域控制站時，就不會再進行任何查詢。 時間服務所指派的分數是累計的，這表示位於相同網站的 PDC 模擬器得到的分數為九分。

如果時間服務的根目錄並未設為要與外部來源進行同步處理，則電腦的內部硬體時鐘會控管時間。

### <a name="manually-specified-synchronization"></a>手動指定的同步處理
手動指定的同步處理可讓您指定電腦從中取得時間的單一對等項目或對等項目清單。 如果電腦不是網域成員，則必須手動將其設為要與指定的時間來源同步處理。 預設會將屬於網域成員的電腦設定為從網域階層進行同步處理，而對於網域的樹系根目錄或未加入網域的電腦而言，手動指定的同步處理最為有用。 手動指定外部 NTP 伺服器來與網域的權威性電腦同步處理，可提供可靠的時間。 不過，將您網域的權威性電腦設為要與硬體時鐘進行同步處理，其實是更好的解決方案，可為您的網域提供最準確、安全的時間。

除非為手動指定的時間來源寫入特定的時間提供者，否則其不會經過驗證，因此很容易遭受攻擊者攻擊。 此外，如果電腦與手動指定的來源 (而非其驗證網域控制站) 進行同步處理，這兩部電腦可能會不同步，因而導致 Kerberos 驗證失敗。 這可能會導致其他需要網路驗證的動作失敗，例如列印或檔案共用。 如果只有樹系根目錄設為要與外部來源進行同步處理，則樹系中的所有其他電腦都會彼此保持同步，使重新執行攻擊變得窒礙難行。

### <a name="all-available-synchronization-mechanisms"></a>所有可用的同步處理機制

「所有可用的同步處理機制」選項是網路上使用者最珍貴的同步處理方法。 此方法允許與網域階層進行同步處理，而且如果網域階層變得無法使用，也可能會提供替代時間來源 (視設定而定)。 如果用戶端無法與網域階層同步處理時間，則時間來源會自動回到 **NtpServer** 設定所指定的時間來源。 此同步處理方法最可能將準確的時間提供給用戶端。

### <a name="stopping-time-synchronization"></a>停止時間同步處理
在某些情況下，您會想要阻止電腦同步處理其時間。 例如，如果電腦嘗試透過撥號連線，從網際網路上的時間來源或透過 WAN 的另一個網站進行同步處理，則可能會產生昂貴的電話費用。 當您在該電腦上停用同步處理時，就是阻止電腦嘗試透過撥號連線來存取時間來源。

您也可以停用同步處理，以避免在事件記錄中產生錯誤。 每次電腦嘗試與無法使用的時間來源進行同步處理時，就會在事件記錄中產生錯誤。 如果從網路取出時間來源進行排定維護，且不想要將用戶端重新設定為從其他來源進行同步處理，您可以在用戶端上停用同步處理，以防止其在時間伺服器無法使用時嘗試進行同步處理。

在指定為同步處理網路根目錄的電腦上，停用同步處理很有用。 這表示根電腦會信任其本機時鐘。 如果同步處理階層的根目錄並未設為 **NoSync**，而且無法與其他時間來源同步處理，用戶端就不會接受這部電腦所送出的封包，因為無法信任其時間。

用戶端唯一信任的時間伺服器 (即使尚未與其他時間來源同步處理) 就是用戶端已識別為可靠的時間伺服器。

### <a name="disabling-the-windows-time-service"></a>停用 Windows Time 服務
Windows Time 服務 (W32Time) 可以完全停用。 如果您選擇實作使用 NTP 的第三方時間同步處理產品，則必須停用 Windows Time 服務。 這是因為所有 NTP 伺服器都需要存取使用者資料包通訊協定 (UDP) 連接埠 123，而且只要 Windows Time 服務正在 Windows Server 2003 作業系統上執行，連接埠 123 仍是由 Windows Time 保留。

## <a name="network-ports-used-by-windows-time-service"></a>Windows Time 服務所使用的網路連接埠
Windows Time 服務會在網路上進行通訊，以識別可靠的時間來源、取得時間資訊，並將時間資訊提供給其他電腦。 其會依照 NTP 和 SNTP RFC 的定義來執行此通訊。

**Windows Time 服務的通訊埠指派**

|服務名稱|UDP|TCP|
|----------------|-------|-------|
|NTP|123|不適用|
|SNTP|123|不適用|

## <a name="see-also"></a>另請參閱
[Windows Time 服務技術參考](windows-time-service-tech-ref.md)
[Windows Time 服務工具和設定](Windows-Time-Service-Tools-and-Settings.md)
[Microsoft 知識庫文章 902229](https://go.microsoft.com/fwlink/?LinkId=186066)
