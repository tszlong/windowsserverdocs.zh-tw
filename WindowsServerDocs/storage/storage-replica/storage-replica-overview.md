---
description: 深入瞭解：儲存體複本總覽
title: 儲存體複本概觀
manager: siroy
ms.author: nedpyle
ms.topic: how-to
author: nedpyle
ms.date: 4/26/2019
ms.assetid: e9b18e14-e692-458a-a39f-d5b569ae76c5
ms.openlocfilehash: cd516e6d762df920c7f43843240ea2045a67753b
ms.sourcegitcommit: 40905b1f9d68f1b7d821e05cab2d35e9b425e38d
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/06/2021
ms.locfileid: "97948594"
---
# <a name="storage-replica-overview"></a>儲存體複本概觀

>適用於：Windows Server 2019、Windows Server 2016、Windows Server (半年通道)

「儲存體複本」是一種 Windows Server 技術，可在伺服器或叢集之間啟用磁碟區複寫來進行災害復原。 它也可讓您建立跨兩個網站的延展式容錯移轉叢集，並且保持所有節點同步。

儲存體複本支援同步和非同步複寫︰

* **同步複寫** 會以當機時保持一致的磁碟區鏡像低延遲網站內的資料，確保檔案系統層級在失敗期間零資料遺失。
* **非同步複寫** 會透過延遲較高的網路連結來鏡像跨非都會範圍之網站的資料，但不保證兩個網站在失敗時具有相同的資料複本。

## <a name="why-use-storage-replica"></a>為什麼要使用儲存體複本？

儲存體複本在 Windows Server 中提供嚴重損壞修復和準備功能。 Windows Server 讓您安心地避免遺失資料，並能夠以同步的方式保護不同機架、樓層、大樓、校園、縣市和城市的資料。 發生嚴重損壞之後，所有資料都會存在於其他位置，而不會遺失任何可能性。 這同樣適用於發生災害事件「之前」的情況。儲存體複本可讓您在災害發生之前接獲警告，並將工作負載切換到安全的位置，而避免遺失任何資料。

儲存體複本允許更有效率地使用多個資料中心。 藉由延伸叢集或複寫叢集，便可以在多個資料中心執行工作負載，使當地鄰近的使用者和應用程式能夠更快速地存取資料，以及更妥善地分散負載並使用運算資源。 如果發生的災害使得其中一個資料中心離線，您可以將它的一般工作負載暫時移到其他站台。

儲存體複本可讓您將被迫充當低階災害復原解決方案的現有檔案複寫系統 (例如 DFS 複寫) 進行解除委任。 雖然 DFS 複寫在極低頻寬網路上的運作良好，但其延遲非常高，通常長達數小時或數天。 這是由 DFSR 要求將檔案關閉所造成，而它人為節流的目的則是為了防止網路壅塞。 由於那些特性，DFS 複寫複本中最新且最熱門的檔案，是最不可能被複寫的。 儲存體複本是在檔案層級之下運作，而且沒有這些限制。

儲存體複本也針對範圍較遠及延遲較高的網路支援非同步複寫。 因為它不是以檢查點為基礎，而是持續複寫，所以變更的差異通常遠低於以快照集為基礎的產品。 此外，儲存體複本是在資料分割層運作，因此會複寫 Windows Server 或備份軟體所建立的所有 VSS 快照；這將允許針對時間點復原使用應用程式一致的資料快照，特別是以非同步方式複寫的非結構化使用者資料。

## <a name="supported-configurations"></a><a name="BKMK_SRSupportedScenarios"></a>支援的設定

您可以在延展叢集中、叢集對叢集之間，以及在伺服器對伺服器設定中部署儲存體複本 (請參閱圖 1-3) 。

「延展式叢集」允許在單一叢集中設定電腦與儲存體，其中某些節點會共用一組非對稱式儲存體，而其他節點則會共用另一組非對稱式儲存體，並會以同步或非同步的方式搭配網站感知進行複寫。 此案例可以運用具有共用 SAS 儲存體、SAN 和連接 iSCSI 的 LUN 的儲存空間。 它是以 PowerShell 和容錯移轉叢集管理員圖形工具進行管理，而且允許自動化的工作負載容錯移轉。

![這個圖表顯示紐約州兩個使用儲存體複本的叢集節點如何與紐澤西州的兩個節點複寫儲存體](./media/Storage-Replica-Overview/Storage_SR_StretchCluster.png)

**圖 1︰使用儲存體複本在延展式叢集中進行儲存體複寫**

「叢集對叢集」允許在兩個不同的叢集之間複寫，其中某個叢集會以同步或非同步的方式與另一個叢集進行複寫。 此案例可以運用具有共用 SAS 儲存體、SAN 和連接 iSCSI 的 LUN 的儲存空間直接存取和儲存空間。 它是使用 Windows Admin Center 和 PowerShell 來管理，且需要手動介入以進行容錯移轉。

![這個圖表顯示洛杉磯使用儲存體複本的叢集如何與拉斯維加斯的不同叢複寫其儲存體](./media/Storage-Replica-Overview/Storage_SR_ClustertoCluster.png)

**圖 2︰使用儲存體複本進行叢集對叢集儲存體複寫**

**伺服器對伺服器** 允許在兩個獨立伺服器之間，使用具有共用 SAS 儲存體、SAN 和連接 iSCSI 的 LUN 的儲存空間以及本機磁碟機，進行同步和非同步複寫。 它是使用 Windows Admin Center 和 PowerShell 來管理，且需要手動介入以進行容錯移轉。

![這個圖表顯示與建築物 9 的伺服器進行複寫之建築物 5 的伺服器](./media/Storage-Replica-Overview/Storage_SR_ServertoServer.png)

**圖 3︰使用儲存體複本進行伺服器對伺服器儲存體複寫**

> [!NOTE]
> 您也可以在一部電腦上使用四個不同的磁碟區，設定伺服器對自我複寫。 不過，本指南並未涵蓋此案例。

## <a name="storage-replica-features"></a><a name="BKMK_SR2"></a>儲存體複本功能

* **零資料遺失、區塊層級的複寫**： 使用同步複寫時，不可能會發生資料遺失。 使用區塊層級的複寫時，不可能會發生檔案鎖定。

* **簡單的部署和管理**： 儲存體複本具有容易使用的設計。 在兩部伺服器之間建立複寫合作關係可以利用 Windows Admin Center。 部署延展式叢集時，會使用熟悉的容錯移轉叢集管理員工具中的直覺式精靈。

* **客體和主機**： 儲存體複本的所有功能都會向虛擬化客體和主機型部署公開。 這表示即使是在非 Windows 虛擬化平臺或公用雲端中執行，來賓還是可以複寫其資料磁片區，只要在來賓中使用 Windows Server 即可。

* **以 SMB3 為基礎**： 儲存體複本會使用經過實證且成熟的 SMB 3 技術，此技術首次是在 Windows Server 2012 中發佈。 這表示所有 SMB 的進階特性 (例如 RoCE、iWARP 及 InfiniBand RDMA 網路卡上的多重通道和 SMB 直接傳輸支援) 都可用於儲存體複本。

* **安全性**。 與許多廠商的產品不同，儲存體複本具備領先業界的安全性技術。 這包括封包簽署、AES-128-GCM 完整資料加密、Intel AES NI 加密加速的支援，以及預先驗證完整性攔截式攻擊預防。 儲存體複本在節點之間利用 Kerberos AES256 進行所有驗證。

* **高效能的初始同步**。儲存體複本支援已植入的初始同步，其中資料的子集已經存在於舊版複本、備份，或隨附磁碟機的目標上。 初始複寫只會複製不同的區塊，可能會縮短初始同步處理時間，並防止資料使用有限的頻寬。 儲存體複本會封鎖總和檢查碼計算和彙總，也就是說，初始同步效能只會受到儲存體和網路速度的限制。

* **一致性群組**： 寫入順序可確保應用程式（例如 Microsoft SQL Server）可以寫入多個複寫的磁片區，並知道資料是依序寫入至目的地伺服器。

* **使用者委派**： 不是區域複寫節點上內建系統管理員群組成員的使用者，可以取得委派權限以管理複寫，這將能限制該使用者對於不相關區域的存取。

* **網路限制**： 儲存體複本可依伺服器和複寫的磁碟區，限制為個別的網路，以提供應用程式、備份和管理軟體頻寬。

* **精簡** 布建。 支援儲存空間和 SAN 裝置的精簡佈建，以在許多情況下提供接近即時的初始複寫時間。

儲存體複本包含下列功能：

| 功能 | 詳細資料 |
| ----------- | ----------- |
| 類型 | 主機型 |
| 同步 | 是 |
| 非同步 | 是 |
| 儲存硬體無關 | 是 |
| 複寫單位 | 磁碟區 (磁碟分割) |
| Windows Server stretch cluster 建立 | 是 |
| 伺服器對伺服器複寫 | 是 |
| 叢集對叢集複寫 | 是 |
| 傳輸 | SMB3 |
| 網路 | TCP/IP 或 RDMA |
| 網路限制支援 | 是 |
| RDMA* | iWARP、InfiniBand、RoCE v2 |
| 複寫網路連接埠防火牆需求 | 單一 IANA 連接埠 (TCP 445 或 5445) |
| 多重路徑/多重通道 | 是 (SMB3) |
| Kerberos 支援 | 是 (SMB3) |
| 透過連線加密和簽署|是 (SMB3) |
| 允許個別磁碟區容錯移轉 | 是 |
| 精簡佈建的儲存體支援 | 是 |
| 隨附管理 UI | PowerShell、容錯移轉叢集管理員 |

*可能需要更長的運輸設備及纜線。

## <a name="storage-replica-prerequisites"></a><a name="BKMK_SR3"></a> 儲存體複本必要條件

* Active Directory 網域服務樹系。
* 具有 SAS JBOD、儲存空間直接存取、光纖通道 SAN、共用 VHDX、iSCSI 目標或本機 SAS/SCSI/SATA 儲存體的儲存空間。 針對複寫記錄檔磁碟機，建議使用 SSD 或更快的裝置。 Microsoft 建議記錄檔儲存體應該要比資料儲存體更快。 記錄檔磁碟區不得用於其他工作負載。
* 每部伺服器上至少要有一個乙太網路/TCP 連線，以進行同步複寫，但最好是 RDMA。
* 每部伺服器至少要有 2 GB 的 RAM 和兩個核心。
* 針對同步複寫，伺服器間的網路頻寬必須足以容納您的 IO 寫入工作負載，以及平均 5 毫秒以下的來回延遲。 非同步複寫沒有建議的延遲值。
* Windows Server、Datacenter Edition 或 Windows Server Standard Edition。 在 Windows Server Standard Edition 上執行的儲存體複本有下列限制：

  * 您必須使用 Windows Server 2019 或更新版本
  * 儲存體複本會複寫單一磁片區，而不是不限數量的磁片區。
  * 磁片區的大小最多可達 2 TB，而不是無限制大小。

##  <a name="background"></a><a name="BKMK_SR4"></a>背景

本節包含高階業界術語、同步和非同步複寫和重要行為的相關資訊。

### <a name="high-level-industry-terms"></a>高層級產業條款

災害復原 (DR) 指的是從網站災害中復原，使企業能夠繼續運作的緊急應變計畫。 資料 DR 表示位於不同實體位置中的多個生產資料複本。 其中一個例子為延展式叢集，其半數的節點位於一個站台，而另一半則位於另一個站台。 災害準備 (DP) 指的是在災害 (例如颶風) 即將到來之前，先將工作負載移到不同位置的緊急應變計畫。

服務等級協定 (SLA) 定義企業應用程式在已計畫和未計畫中斷期間的可用性，以及對於停機時間和資料遺失的容忍度。 復原時間目標 (RTO) 定義企業可以容忍完全無法存取資料的時間長度。 復原點目標 (RPO) 定義企業可以容忍遺失的資料量。

### <a name="synchronous-replication"></a>同步複寫

同步複寫可保證應用程式在完成 IO 前，將資料同時寫入至兩個位置。 此複寫更適合任務關鍵資料，因為它需要對網路和儲存體做出投資，也會有應用程式效能降低的風險。

當應用程式寫入在來源資料複本上發生時，原始儲存體將不會立即確認 IO。 相反地，那些資料變更會複寫到遠端目的地複本並傳回確認。 只有在那時，應用程式才會接收到 IO 確認。 這可確保遠端站台與來源站台持續同步處理，因而將儲存體 IO 延伸到整個網路。 如果來源站台失敗，應用程式可以容錯移轉至遠端站台，並繼續執行其作業並保證零資料遺失。

| [模式] | 圖表 | 步驟 |
| -------- | ----------- | --------- |
| **同步**<p>零資料遺失<p>復原點目標 (RPO) | ![這個圖表顯示儲存體複本如何在同步複寫中寫入資料](./media/Storage-Replica-Overview/Storage_SR_SynchronousV2.png) | 1.應用程式寫入資料<br />2.記錄檔資料已寫入，且資料已複寫至遠端站台<br />3.記錄檔資料已在遠端站台寫入<br />4.遠端站台做出確認<br />5.應用程式寫入已確認<p>t & t1：資料排清到磁碟區，記錄一律直接寫入 |

### <a name="asynchronous-replication"></a>非同步複寫

相反地，非同步複寫表示當應用程式寫入資料時，該資料會複寫至遠端站台，且不保證會立即做出確認。 此模式允許應用程式更快的回應時間，以及能夠跨地理位置運作的 DR 解決方案。

當應用程式寫入資料時，複寫引擎會擷取寫入，並立即向應用程式確認。 接著，擷取的資料會複寫至遠端位置。 遠端節點會處理資料的複本，並延遲向來源複本做出確認。 由於複寫效能已不再位於應用程式 IO 路徑中，因此遠端站台的回應速度和距離等因素將變得較不重要。 這在來源資料遺失，而該資料的目的地複本仍在緩衝區且尚未離開來源時，將會有資料遺失的風險。

由於非同步複寫具有高於零的 RPO，因此比較不適合做為容錯移轉叢集之類的 HA 解決方案，因為它們是針對具有備援能力且不會遺失資料的連續作業而設計。

| [模式] | 圖表 | 步驟 |
| -------- | ----------- | --------- |
| **非同步**<p>接近零的資料遺失<p>(取決於多個因素)<p>復原點目標 (RPO) | ![這個圖表顯示儲存體複本如何在非同步複寫中寫入資料](./media/Storage-Replica-Overview/Storage_SR_AsynchronousV2.png)|1.應用程式寫入資料<br />2.記錄檔資料已寫入<br />3.應用程式寫入已確認<br />4.資料複寫到遠端站台<br />5.記錄檔資料已在遠端站台寫入<br />6.遠端站台做出確認<p>t & t1：資料排清到磁碟區，記錄一律直接寫入 |

### <a name="key-evaluation-points-and-behaviors"></a>重要的評估點和行為

-   使用最快儲存體的網路頻寬和延遲： 同步複寫有一些相關的實體限制。 由於儲存體複本會使用記錄檔實作 IO 篩選機制，並需要進行網路往返，因此同步複寫可能會讓應用程式寫入更慢。 藉由針對記錄使用低延遲、高頻寬的網路以及高輸送量的磁片子系統，可將效能額外負荷降至最低。

-   在 Windows Server 2016 中複寫時，將無法存取目的地磁碟區。 當您設定複寫時，目的地磁碟區將會卸載，進而讓使用者無法進行任何讀取或寫入。 其磁碟機代號可能會顯示在一般介面上，例如檔案總管，但應用程式無法存取磁碟區本身。 區塊層級的複寫技術不相容於允許對目的地目標位於磁碟區中已掛接的檔案系統進行存取；NTFS 和 ReFS 不支援使用者在區塊變更期間將資料寫入至磁碟區。

Windows Server 1709 版中的 **測試容錯移轉** Cmdlet 推出，也包含在 windows server 2019 中。 這現在支援針對備份、測試等，暫時掛接目的地磁片區的讀寫快照集。如需詳細資訊，請參閱 https://aka.ms/srfaq 。

-   Microsoft 非同步複寫的實作與大多數實作不同： 業界大部分的非同步複寫實作依賴以快照為基礎的複寫，其中定期的差異傳輸會移到其他節點並合併。 儲存體複本的非同步複寫的運作方式和同步複寫相同，唯一不同之處在於它移除了目的地進行序列化同步通知的需求。 也就是說，儲存體複本的 RPO 在理論上會比較低，因為它會連續複寫。 不過，這也表示它會依賴內部應用程式的一致性保證，而不是使用快照在應用程式檔案中強制執行一致性。 儲存體複本可以在所有複寫模式中保證絕對一致性

-   許多客戶使用 DFS 複寫作為災害復原解決方案，雖然 DFSR 對於該案例通常並不實用，因為 DFS 複寫無法複寫已開啟的檔案，且其設計是犧牲效能來將頻寬使用量降至最低，進而導致大量的復原點差異。 儲存體複本可讓您將 DFS 複寫從上述部分類型的災害復原責任中淘汰。

-   儲存體複本不是備份解決方案。 相較於每日備份，某些 IT 環境基於複寫系統的零資料遺失選項，會將複寫系統部署為備份解決方案。 儲存體複本會將所有資料區塊的變更複寫到磁碟區上，無論該變更的類型為何。 如果使用者刪除磁片區中的所有資料，儲存體複本會立即將刪除複寫到另一個磁片區，無法挽回從這兩部伺服器中移除資料。 請不要使用儲存體複本作為時間點備份解決方案的替代方案。

-   儲存體複本不是 Hyper-V 複本或 Microsoft SQL AlwaysOn 可用性群組： 儲存體複本是一個一般用途，且與儲存體無關的引擎。 根據定義，它無法將其行為量身打造為應用程式層級的複寫。 這可能會導致特定功能差距，這些差距會讓您想要部署或繼續使用特定應用程式複寫技術。

> [!NOTE]
> 本文件包含[已知問題](storage-replica-known-issues.md)和預期行為的清單，以及[常見問題集](storage-replica-frequently-asked-questions.md)小節。

### <a name="storage-replica-terminology"></a>儲存體複本術語
本指南會經常使用下列術語︰

-   「來源」是允許本機寫入，且會向外複寫的電腦磁碟區。 也稱為「主要」。

-   「目的地」是不允許本機寫入，且會向內複寫的電腦磁碟區。 也稱為「次要」。

-   「複寫合作關係」是來源電腦和目的地電腦之間，針對一或多個磁碟區的同步處理關係，並會運用單一記錄檔。

-   「複寫群組」是以個別伺服器為基礎，於相同合作關係內的磁碟區及其複寫設定的組織。 「群組」可能包含一或多個磁碟區。

### <a name="whats-new-for-storage-replica"></a>儲存體複本的新功能

如需 Windows Server 2019 中儲存體複本的新功能清單，請參閱[儲存體的新](../whats-new-in-storage.md#storage-replica2019)功能

## <a name="additional-references"></a>其他參考資料

- [使用共用儲存體延展叢集複寫](stretch-cluster-replication-using-shared-storage.md)
- [伺服器對伺服器儲存體複寫](server-to-server-storage-replication.md)
- [叢集至叢集儲存體複寫](cluster-to-cluster-storage-replication.md)
- [儲存體複本：已知問題](storage-replica-known-issues.md)
- [儲存體複本：常見問題集](storage-replica-frequently-asked-questions.md)
- [Windows Server 2016 中的儲存空間直接存取](../storage-spaces/storage-spaces-direct-overview.md)
- [Windows IT 專業人員支援](https://www.microsoft.com/itpro/windows/support)
