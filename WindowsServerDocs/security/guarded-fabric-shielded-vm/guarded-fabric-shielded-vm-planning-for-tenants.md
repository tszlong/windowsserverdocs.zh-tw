---
description: 深入瞭解：租使用者的受防護網狀架構與受防護 VM 規劃指南
title: 租使用者的受防護網狀架構與受防護 VM 規劃指南
ms.topic: article
ms.assetid: 392af37f-a02d-4d40-a25d-384211cbbfdd
manager: dongill
author: nirb-ms
ms.author: nirb
ms.date: 12/10/2020
ms.openlocfilehash: bd56d41b4e940691de30cfb69f119041ef5cc5d7
ms.sourcegitcommit: 40905b1f9d68f1b7d821e05cab2d35e9b425e38d
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/06/2021
ms.locfileid: "97944464"
---
# <a name="guarded-fabric-and-shielded-vm-planning-guide-for-tenants"></a>租使用者的受防護網狀架構與受防護 VM 規劃指南

>適用于： Windows Server 2019、Windows Server (半年通道) 、Windows Server 2016

本主題著重于想要保護虛擬機器 (Vm) 合規性和安全性目的的 VM 擁有者。 無論 Vm 是在主機服務提供者的受防護網狀架構或私用受防護網狀架構上執行，VM 擁有者都必須控制其受防護 Vm 的安全性層級，其中包括維持在需要時將其解密的能力。

使用受防護的 Vm 時，有三個要考慮的區域：

- Vm 的安全性層級
- 用來保護它們的密碼編譯金鑰
- 防護資料—用來建立受防護 Vm 的機密資訊

## <a name="security-level-for-the-vms"></a>Vm 的安全性層級

部署受防護的 Vm 時，必須選取兩個安全性層級的其中一個：

- 受防護
- 支援加密

受防護和加密支援的 Vm 都有附加的虛擬 TPM，而執行 Windows 的 Vm 則會受到 BitLocker 保護。 主要差異在於受防護的 Vm 會封鎖網狀架構系統管理員的存取，而支援加密的 Vm 則會允許網狀架構系統管理員與一般 VM 相同層級的存取權。 如需有關這些差異的詳細資訊，請參閱 [受防護網狀架構與受防護的 vm 總覽](guarded-fabric-and-shielded-vms.md)。

如果您想要從遭入侵的網狀架構保護 VM (包括遭盜用的系統管理員) ，請選擇 **受防護的 vm** 。 它們應該在網狀架構系統管理員和網狀架構本身不受信任的環境中使用。 如果您想要符合符合性的要求，請選擇 **加密支援的 vm** ，這可能需要在網路上同時進行加密和加密 (例如，即時移轉) 。

加密支援的 Vm 很適合在網狀架構系統管理員完全受信任的環境中，但仍需要加密。

您可以混合執行受防護網狀架構上的一般 Vm、受防護 Vm 和加密支援的 Vm，甚至是在相同的 Hyper-v 主機上。

VM 是否受到防護或加密支援是由建立 VM 時選取的防護資料所決定。 建立防護資料時，VM 擁有者會設定安全性層級 (請參閱 [防護資料](#shielding-data) 區段) 。
請注意，一旦進行此選擇之後，當 VM 保留在虛擬化網狀架構上時，就無法變更它。

## <a name="cryptographic-keys-used-for-shielded-vms"></a>用於受防護 Vm 的密碼編譯金鑰

受防護的 Vm 會受到保護，防止使用加密磁片的虛擬化網狀架構攻擊媒介，以及只能透過下列方式解密的各種其他加密元素：

- 擁有者金鑰–這是 VM 擁有者所維護的密碼編譯金鑰，通常用於最後手段的復原或疑難排解。 VM 擁有者負責維護安全位置中的擁有者金鑰。
- 一或多個監護人 (主機守護者金鑰) –每個守護者都代表一個虛擬化網狀架構，其中的擁有者會授權受防護的 Vm 執行。 企業通常都有主要和嚴重損壞修復 (DR) 虛擬化網狀架構，而且通常會授權其受防護的 Vm 在兩者上執行。 在某些情況下，次要 (DR) 網狀架構可能會由公用雲端提供者所主控。 任何受防護網狀架構的私密金鑰只會在虛擬化網狀架構上進行維護，而其公開金鑰則可以下載並包含在其守護者內。

**如何? 建立擁有者金鑰？** 擁有者金鑰是以兩個憑證表示。 用於加密的憑證和用於簽署的憑證。 您可以使用自己的 PKI 基礎結構來建立這兩個憑證，或從公開憑證授權單位單位 (CA) 取得 SSL 憑證。 基於測試目的，您也可以在開頭為 Windows 10 或 Windows Server 2016 的任何電腦上建立自我簽署憑證。

**您應該擁有多少擁有者金鑰？** 您可以使用單一擁有者金鑰或多個擁有者金鑰。 最佳做法建議一組共用相同安全性、信任或風險層級的 Vm，以及系統管理控制的單一擁有者金鑰。 您可以為所有已加入網域的受防護 Vm 共用單一擁有者金鑰，並將該擁有者金鑰視為由網域系統管理員管理。

**我可以將自己的金鑰用於主機守護者嗎？** 是的，您可以將自己的金鑰「自備」至主機服務提供者，並將該金鑰用於受防護的 Vm。 這可讓您使用您的特定金鑰 (與使用主機服務提供者金鑰) ，而且可以在有需要遵守的特定安全性或法規時使用。 為了達到金鑰的目的，主機守護者金鑰應該與擁有者金鑰不同。

## <a name="shielding-data"></a>防護資料

防護資料包含部署受防護或加密支援的 Vm 所需的秘密。 將一般 Vm 轉換成受防護的 Vm 時也會使用它。

防護資料是使用 [防護資料檔案] 建立的，並儲存在 VM 擁有者上傳至受防護網狀架構的 PDK 檔案中。

受防護的 Vm 有助於抵禦遭入侵之虛擬化網狀架構的攻擊，因此我們需要安全的機制來傳遞機密的初始資料（例如系統管理員密碼、網域加入認證或 RDP 憑證），而不會將這些資料洩漏給虛擬化網狀架構本身或其系統管理員。 此外，防護資料包含下列各項：

1. 安全性等級-受防護或加密支援
2. 可執行 VM 的受信任主機守護者的擁有者和清單
3. 虛擬機器初始化資料 ( # A0、RDP 憑證) 
4. 在虛擬化環境中建立 VM 之受信任的已簽署範本磁片清單

建立受防護或加密支援的 VM 或轉換現有的 VM 時，系統會要求您選取防護資料，而不會提示您提供機密資訊。

**我需要多少防護資料檔案？** 您可以使用單一防護資料檔案來建立每個受防護的 VM。 但是，如果指定受防護的 VM 需要四個專案中的任一個不同，則需要額外的防護資料檔案。 例如，您可能會有一個 IT 部門的防護資料檔案，以及 HR 部門的不同防護資料檔案，因為它們的初始系統管理員密碼和 RDP 憑證不相同。

雖然可能會針對每個受防護的 VM 使用不同的防護資料檔案，但這並不一定是最佳選擇，而且應該基於正確的原因進行。 例如，如果每個受防護的 VM 都需要不同的系統管理員密碼，請考慮改用密碼管理服務或工具，例如 [Microsoft 的區域系統管理員密碼解決方案 (LAPS) ](https://www.microsoft.com/download/details.aspx?id=46899)。

## <a name="creating-a-shielded-vm-on-a-virtualization-fabric"></a>在虛擬化網狀架構上建立受防護的 VM

有幾個選項可在虛擬化網狀架構上建立受防護的 VM (以下是受防護和加密支援的 Vm) 的相關資訊：

1. 在您的環境中建立受防護的 VM，並將它上傳至虛擬化網狀架構
2. 從虛擬化網狀架構上的已簽署範本建立新的受防護 VM
3. 防護現有的 VM (現有的 VM 必須是第2代，而且必須執行 Windows Server 2012 或更新版本) 

從範本建立新的 Vm 是正常的做法。 不過，由於用來建立新受防護 VM 的範本磁片位於虛擬化網狀架構上，因此需要額外的量值，以確保它未被惡意網狀架構系統管理員或在網狀架構上執行的惡意程式碼所篡改。 您可以使用已簽署的範本磁片來解決此問題：已簽署的範本磁片及其磁片簽章是由受信任的系統管理員或 VM 擁有者所建立。 建立受防護的 VM 時，會將範本磁片的簽章與所指定防護資料檔案中包含的簽章進行比較。 如果任何防護資料檔案的簽章符合範本磁片的簽章，部署程式就會繼續進行。 如果找不到相符項，則會中止部署程式，確保 VM 密碼不會因為不信任的範本磁片而遭到入侵。

使用已簽署的範本磁片來建立受防護的 Vm 時，有兩個可用的選項：

1. 使用虛擬化提供者所提供的現有已簽署範本磁片。 在此情況下，虛擬化提供者會維護已簽署的範本磁片。
2. 將已簽署的範本磁片上傳至虛擬化網狀架構。 VM 擁有者負責維護已簽署的範本磁片。


