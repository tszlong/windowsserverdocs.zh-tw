---
description: 深入瞭解：何時使用 Pass 或篩選宣告規則
ms.assetid: 606df285-259c-4c6b-8583-9aca1d614c43
title: 使用傳遞或篩選宣告規則的時機
author: billmath
ms.author: billmath
manager: femila
ms.date: 05/31/2017
ms.topic: article
ms.openlocfilehash: f7b33c485e4bf640dbf2f158ee25f54ddc62dbb9
ms.sourcegitcommit: 65b6de6b44d41f1180c45db11cdd60cb2a093b46
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 12/10/2020
ms.locfileid: "97050446"
---
# <a name="when-to-use-a-pass-through-or-filter-claim-rule"></a>使用傳遞或篩選宣告規則的時機
\( \) 當您需要採用特定的傳入宣告類型，然後套用可根據傳入宣告中的值來決定應發生輸出的動作時，可以在 Active Directory 同盟服務 AD FS 中使用此規則。 當您使用此規則時，您會根據您在規則中設定的選項之一，傳遞或篩選任何與下表中的規則邏輯相符的宣告。

|規則選項|規則邏輯|
|---------------|--------------|
|傳遞所有宣告值|如果傳入宣告類型等於 *指定的宣告類型*，且值等於 *任何值*，則會傳遞該宣告|
|僅傳遞特定宣告值|如果傳入宣告類型等於 *指定的宣告類型*，且值等於 *指定的宣告值*，則會傳遞該宣告|
|只傳遞符合特定電子 \- 郵件尾碼值的宣告值|如果傳入宣告類型等於 *指定的宣告類型*，且值等於 *指定的尾碼值*，則會傳遞該宣告|
|僅傳遞以特定值開頭的宣告值|如果傳入宣告類型等於 *指定的宣告類型*，且值以 *指定的宣告值* 開頭，則會傳遞該宣告|

下列章節提供宣告規則的基本介紹，並進一步提供如何使用此規則的詳細資訊。

## <a name="about-claim-rules"></a>關於宣告規則
宣告規則代表將採用傳入宣告之商務邏輯的實例，如果 x then y 則將條件套用至該實例， \( \) 並根據條件參數產生外送宣告。 在您進一步閱讀本主題之前，請先閱讀下列清單，其中會概述關於宣告規則您應該知道的重要秘訣：

-   在 AD FS 管理嵌入式管理單元 \- 中，只能使用宣告規則範本來建立宣告規則

-   宣告規則會直接從宣告提供者 \( （例如 Active Directory 或其他同盟服務， \) 或從宣告提供者信任的接受轉換規則輸出中處理傳入宣告。

-   宣告規則的處理方式，是由宣告發行引擎依時間先後順序按照指定的規則集處理。 藉由設定規則優先順序，您可以進一步精簡或篩選由特定規則集內的上一個規則所產生的宣告。

-   宣告規則範本一律會要求您指定傳入宣告類型。 不過，您可以使用單一規則和同一宣告類型處理多個宣告值。

如需宣告規則和宣告規則集的詳細資訊，請參閱宣告 [規則的角色](The-Role-of-Claim-Rules.md)。 如需有關如何處理規則的詳細資訊，請參閱 [宣告引擎的角色](The-Role-of-the-Claims-Engine.md)。 如需如何處理宣告規則集的詳細資訊，請參閱 [宣告管線的角色](The-Role-of-the-Claims-Pipeline.md)。

## <a name="pass-through-all-claim-values"></a>傳遞所有宣告值
使用此動作時，將會以傳出宣告的形式傳遞指定宣告類型的所有傳入宣告值。 例如，當傳入宣告類型指定為角色宣告類型時，所有的傳入宣告值會個別複製到新的傳出宣告，且傳出宣告的類型為「角色」。

## <a name="filtering-a-claim"></a>篩選宣告
在 AD FS 中， *宣告篩選* 條件表示篩選或限制傳入的宣告值，因此只會以傳出宣告的形式傳遞或傳送特定的值。 此功能的運作有賴 [傳遞或篩選傳入宣告] 規則範本。 在此規則的屬性內，您可以設定篩選傳入值的條件，而只讓與您指定的條件相符的值傳遞。

例如，您可以使用此規則，在傳入宣告類型符合「角色」宣告類型時僅傳遞符合宣告值「購買者」的宣告，或者您可以僅發出關於使用者名稱的宣告，而不是包含使用者身分證號碼的宣告。

當您使用具有此規則的篩選條件時，所有的傳入宣告都會受到檢查，以判斷哪些宣告符合規則所設定的條件。 所有其他宣告都會被忽略，如此只有符合所選宣告類型的指定宣告值會傳遞。

例如，如下圖所示，當規則設定為僅篩選以 UPN 宣告類型組成的傳入宣告，而且結尾為時 @fabrikam.com ，除非符合此準則，否則會忽略所有其他的傳入宣告。 這包括具有電子郵件地址宣告類型的連入宣告， \- 即使其宣告值結尾為 @fabrikam.com 。 在此情況下，只有包含值的宣告 Nick@fabrikam.com 會傳送至信賴憑證者。

![使用 pass 的時機](media/adfs2_filter.gif)

## <a name="configuring-this-rule-on-a-claims-provider-trust"></a>在宣告提供者信任上設定此規則
當您使用宣告提供者信任時，可將此規則設定為只會傳遞符合特定條件約束的宣告提供者所傳入的宣告。 例如，您可能只想接受 \- 來自宣告提供者的電子郵件宣告，因此，您可以使用此規則範本接受以 \- 宣告提供者的網域名稱系統 DNS 名稱結尾的電子郵件宣告類型 \( \) 。

## <a name="configuring-this-rule-on-a-relying-party-trust"></a>在信賴憑證者信任上設定此規則
當您使用信賴憑證者信任時，可將此規則設定為會傳遞或篩選將傳送給信賴憑證者的傳出宣告。 有些信賴憑證者可能不了解特定的宣告類型，或是某些宣告可能包含不應傳送給特定信賴憑證者的敏感性資訊。 此規則範本可協助您針對特定的信賴憑證者信任強制執行這些原則。

## <a name="how-to-create-this-rule"></a>如何建立此規則
您可以使用宣告規則語言來建立此規則，或在 AD FS 管理] 嵌入式管理單元中使用 [傳遞或篩選傳入宣告規則] 範本 \- 。 此規則範本提供以下設定選項：

-   指定宣告規則名稱

-   指定傳入宣告類型

-   傳遞所有宣告值

-   僅傳遞特定宣告值

-   只傳遞符合特定電子 \- 郵件尾碼值的宣告值

-   僅傳遞以特定值開頭的宣告值

如需有關如何建立此範本的詳細指示，請參閱 AD FS 部署指南中的 [建立規則，以通過或篩選傳入](/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/dd807060(v=ws.11)) 宣告。

## <a name="using-the-claim-rule-language"></a>使用宣告規則語言
如果只有在宣告值符合自訂模式時才應傳送宣告，您必須使用自訂規則。 如需詳細資訊，請參閱「使用自訂規則的時機」。

### <a name="examples-of-how-to-construct-a-pass-through-or-filter-rule-syntax"></a>說明如何建構傳遞或篩選規則語法的範例
一個簡單的篩選規則會篩選根據前述其中一個屬性來篩選宣告。 例如，下列規則會通過所有的電子 \- 郵件宣告：

```
c:[type == "http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress"]  => issue(claim  = c);
```

篩選準則可以邏輯和 \- ed 在一起。 例如，下列規則會接受所有 \- 具有值的電子郵件宣告 johndoe@fabrikam.com:

```
c:[type == "http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress", value == "johndoe@fabrikam.com "]  => issue(claim  = c);
```

在上述範例中，篩選器一律使用等號比較運算子。 宣告規則語言支援下列運算子：

-   \=\=\-等於區分 \( 大小寫 \-\)

-   \!\=\-不等於區分 \( 大小寫 \-\)

-   \=~\- 正則運算式相符

-   \!~ \- 正則運算式不 \- 相符

例如，下列規則將會接受 \- 本機同盟伺服器未發出 boeing.com 尾碼的所有電子郵件宣告：

```
c:[type == "http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress", value =~ "^.*@boeing\.com$" , issuer != "LOCAL AUTHORITY"]  => issue(claim  = c);
```

### <a name="best-practices-for-creating-custom-rules"></a>建立自訂規則的最佳做法
篩選可以套用到每個宣告的一或多個屬性，如下表所說明。


| 宣告屬性 |                                                                                                                                                                                                                                                                                                                                                  描述                                                                                                                                                                                                                                                                                                                                                  |
|----------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|      類型      |                                                                                                                                                                                        宣告類型 \( 通常表示為 Uri， \) 反映出同盟中夥伴之間的隱含協定，與宣告中傳達的資訊類型有關。 例如，HTTP： \/ \/schemas.xmlsoap.org \/ ws \/ 2005 \/ 05 \/ identity 宣告 emailaddress 類型的 \/ 宣告 \/ 會包含使用者的電子 \- 郵寄地址。                                                                                                                                                                                         |
|     值      |                                                                                                                                                                                                                                                                   宣告的值。 例如，HTTP： \/ \/schemas.xmlsoap.org \/ ws \/ 2005 \/ 05 \/ identity 宣告 emailaddress 類型的宣告，其 \/ \/ 值可能為johndoe@fabrikam.com                                                                                                                                                                                                                                                                    |
|   ValueType    |                                                                                                                                                                                                  ValueType 表示要解讀宣告值中包含的資訊的方式。 ValueType 通常會設定為 HTTP： \/ \/ Www.w3.org \/ 2001 \/ XMLSchema \# 字串，但宣告值可能包含 Base64Binary 編碼的資料， \( 例如影像 \) 或日期、布林值等等。                                                                                                                                                                                                  |
|     Issuer     | 簽發者代表上次發出使用者相關宣告的一方。 如果宣告是在宣告提供者同盟伺服器上取得，則所有宣告的簽發者將會設定為「本機授權單位」。 如果事由同盟提供者同盟伺服器接收宣告，則宣告的簽發者會設定為簽署權杖之宣告提供者的宣告提供者識別碼。 因此，在對接收自宣告提供者的宣告處理規則時，所有宣告的簽發者都會設為相同的值。 當撰寫信賴憑證者的規則時，可使用簽發者屬性來區分來自不同宣告提供者的宣告。 |
| OriginalIssuer |                                                                                                   此宣告屬性可用來傳達原本發出宣告的的同盟伺服器。 由於宣告的簽發者屬性是設定為簽署權杖的最後一部同盟伺服器，因此在宣告流經多部同盟伺服器的情況下，原始簽發者會很有用 \( ，例如，從同盟提供者同盟伺服器接收權杖的信賴憑證者，可能會想要哪些特定的宣告提供者同盟伺服器驗證使用者\)                                                                                                   |
|   屬性   |                                                                                                                             除了上述的五個屬性外，每個宣告也都有可儲存具名屬性的屬性包。 這些屬性不會序列化到權杖中，且只能在單一同盟伺服器的範圍內，用來傳遞宣告發行管線元件之間的資訊。 例如，在宣告提供者規則處理期間設定屬性，然後在信賴憑證者規則中加以參照。                                                                                                                              |
