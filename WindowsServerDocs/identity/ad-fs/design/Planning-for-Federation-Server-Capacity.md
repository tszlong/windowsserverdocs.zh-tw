---
description: 深入瞭解：規劃同盟伺服器容量
ms.assetid: 7013fc21-9ced-4f9d-9588-cb04d6d60924
title: 規劃同盟伺服器容量
author: billmath
ms.author: billmath
manager: femila
ms.date: 05/31/2017
ms.topic: article
ms.openlocfilehash: c81c589feb940fb686aa865c8368f126ab20562d
ms.sourcegitcommit: 65b6de6b44d41f1180c45db11cdd60cb2a093b46
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 12/10/2020
ms.locfileid: "97044636"
---
# <a name="planning-for-federation-server-capacity"></a>規劃同盟伺服器容量

同盟伺服器的容量規劃可協助您預估：

-   哪些因素會成長 AD FS 設定資料庫的大小。

-   每部同盟伺服器的適當硬體需求。

-   要在每個組織中放置的同盟伺服器數目。

同盟伺服器會向使用者發出安全性權杖。 這些權杖會呈現給信賴憑證者以供取用。 同盟伺服器會在驗證使用者之後，或在接收到先前由夥伴同盟服務發行的安全性權杖之後，發出安全性權杖。 當使用者一開始登入同盟應用程式時，或當他們的安全性權杖在存取同盟應用程式時過期時，就會向同盟服務要求安全性權杖。

同盟伺服器是設計來配合 \- 使用 Microsoft 網路負載平衡 NLB 技術的高可用性伺服器陣列設定 \( \) 。 伺服陣列設定中的同盟伺服器可以獨立服務要求，而不需要存取每個要求的任何一般伺服器陣列元件。 因此，在擴充同盟伺服器部署時，不會有很大的負擔。

**建議：**

-   針對任務 \- 關鍵性或高 \- 可用性部署，建議您在每個夥伴組織中建立一個小型同盟伺服器陣列，並在每個伺服器陣列中建立至少兩部同盟伺服器，以提供容錯功能。

-   由於需要高可用性和擴充同盟伺服器的便利性，相應放大是針對特定同盟服務處理每秒大量要求的建議方法。 本指南中的擴充功能超過基礎設定，不太可能產生大幅的容量處理。

## <a name="ad-fs-configuration-database-size-and-growth"></a>AD FS 設定資料庫大小與成長
AD FS 設定資料庫的大小通常會被視為較小，而且資料庫大小不太可能是 AD FS 部署的主要考慮。  AD FS 設定資料庫的精確大小可能主要取決於信任關係的數目，以及相關聯的信任 \- 相關中繼資料，例如針對每個信任設定的宣告、宣告規則和監視設定。 當設定資料庫中的信任專案數目增加時，就需要更多磁碟空間。

如需 AD FS 設定資料庫的其他部署資訊，請參閱 [AD FS 部署拓撲的考慮](AD-FS-Deployment-Topology-Considerations.md)。

## <a name="memory-cpu-and-disk-space-requirements"></a>記憶體、CPU 和磁碟空間需求
幸運的是，同盟伺服器的記憶體、CPU 和磁碟空間需求很適中，而且不可能是硬體決策的驅動因素。 如需硬體需求的詳細資訊，請參閱 [附錄 A：審核 AD FS 需求](Appendix-A--Reviewing-AD-FS-Requirements.md)。

> [!NOTE]
> 在 AD FS 產品小組所執行的測試中，使用以專用 SQL Server 設定的同盟伺服器陣列來儲存 AD FS 設定資料庫，SQL Server 比起的整體負載將會降低。 在使用 \- 已設定為使用單一 SQL Server 之四部同盟伺服器陣列的單一測試中 \- ，即使將同盟伺服器帶到目標使用率的測試，CPU 使用率也不會超過10%。

## <a name="estimate-the-number-of-federation-servers-for-your-organization"></a><a name="bk_estimatefs"></a>估計適合組織的同盟伺服器數目
為了簡化同盟伺服器的硬體規劃程式，AD FS 產品小組開發了 AD FS 容量規劃大小的試算表。 這份 Excel 試算表包含 \- 像功能一樣的計算機，可採用您為組織中的使用者所提供的預期使用資料，並為您的 AD FS 生產環境傳回建議的最佳同盟伺服器數目。

> [!NOTE]
> 此試算表建議的同盟伺服器數目是根據 AD FS 產品小組在測試期間所使用的硬體和網路規格。 因此，您必須在此內容中瞭解試算表將建議的同盟伺服器數目。  如需測試期間所使用之規格的詳細資訊，請參閱標題 [為規劃 AD FS 伺服器容量](Planning-for-AD-FS-Server-Capacity.md)的主題。

### <a name="using-the-ad-fs-capacity-planning-sizing-spreadsheet"></a>使用 AD FS 容量規劃調整大小試算表
當您使用此試算表時，您需要選取 \( **40%**、 **60%** 或 **80%** 的值，其 \) 最能代表您預期在尖峰使用期間將驗證要求傳送到同盟伺服器的使用者總數百分比。

然後，您必須選取 \( **1 分鐘**、 **15 分鐘** 或 **1 小時** 的值，此值 \) 最能代表您最後預期尖峰使用期間的時間長度。 例如，您可能會將40% 評估為將在15分鐘內登入之使用者總數的值，或是60% 的使用者將在1小時的期間內登入。 這些值會一起定義將用來計算大小調整建議的尖峰負載設定檔。

接下來，您將需要根據使用者是否為下列各項，指定將需要對 \- 目標宣告 \- 感知應用程式進行單一登入存取的使用者總數：

-   從 \( 透過 Windows 整合式驗證實際連接到公司網路的本機電腦登入 Active Directory\)

-   \(透過 Windows 整合式驗證或使用者名稱和密碼，從未實際連線至公司網路的電腦登入 Active Directory\)

-   從另一個組織，並嘗試從信任的夥伴存取目標宣告 \- 感知應用程式

-   從 SAML 2.0 身分識別提供者，並嘗試存取目標宣告 \- 感知應用程式

#### <a name="how-to-use-this-spreadsheet"></a>如何使用此試算表
您可以針對您打算部署的每個同盟伺服器陣列實例，使用下列步驟來判斷建議的同盟伺服器數目。

1.  下載並開啟 Windows server [2012 R2 的 AD FS 容量規劃調整大小試算表](https://adfsdocs.blob.core.windows.net/adfs/ADFSCapacityPlanning.xlsx) ，或 [windows server 2016 的 AD FS 容量規劃調整大小試算表](https://adfsdocs.blob.core.windows.net/adfs/ADFSCapacity2016.xlsx)。

2.  在 **尖峰系統使用期間內的儲存格中，我預期此百分比的使用者會驗證** 儲存格，按一下資料格，然後使用下拉式箭號 \- 來選取您估計的系統使用率層級，也就是 **40%**、 **60%** 或 **80%** 的部署。

3.  在 [ **下列時間範圍內** ] 儲存格右邊的儲存格中，按一下資料格，然後使用下拉式 \- 箭號來選取 **1 分鐘**、 **15 分鐘** 或 **1 小時** ，以選取尖峰負載的持續時間。

4.  在 [**輸入所估計的內部應用程式數目 \( （例如 SharePoint \( 2007 或 2010 \) 或宣告感知 web 應用程式 \)** ] 資料格）右邊的儲存格中，輸入您將在組織中使用的內部應用程式數目。

5.  在 **輸入所估計的線上應用程式數目 \( （例如 Office 365 Exchange Online、SharePoint Online 或 Lync online \)** 資料格）右邊的儲存格中，輸入您將在組織中使用的線上應用程式或服務數目。

6.  在標題為 [ **使用者數目**] 的資料格下，于套用至範例應用程式案例的每個資料列上輸入一個數位，讓您的使用者需要單一登入 \- 存取權。 此資料行應該包含已定義的使用者數目，而不是每秒的尖峰使用者數目。 如果對應用程式的存取嘗試必須先通過 [主領域探索] 頁面，請輸入 **Y**。如果您不確定此選取專案，請輸入 **Y**。

7.  請參閱下列建議的值：

    1.  如需建議的同盟伺服器總數，請參閱以灰色反白顯示的右下角資料格。

    2.  針對每個範例應用程式案例建議的伺服器數目，請參閱以灰色醒目提示的資料列上的儲存格。

> [!NOTE]
> 將會自動在試算表底部的 [ **建議同盟伺服器總數** ] 資料格右邊的儲存格中，自動計算的值包含公式，該公式會在其前面的每個個別資料列中，將額外的20% 緩衝區加總。 新增到 **同盟伺服器之總數量** 的公式會將此緩衝區中的建議資料格建立到您所部署的總同盟伺服器數目，使伺服器陣列的整體負載不太可能達到其飽和點。

## <a name="see-also"></a>另請參閱
[Windows Server 2012 中的 AD FS 設計指南](AD-FS-Design-Guide-in-Windows-Server-2012.md)
