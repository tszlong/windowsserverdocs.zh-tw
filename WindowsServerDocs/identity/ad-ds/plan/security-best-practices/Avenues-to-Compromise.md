---
ms.assetid: d7a4d2e1-217d-4ffc-93f0-817149bd9e7f
title: 危及系統安全的途徑
author: iainfoulds
ms.author: daveba
manager: daveba
ms.date: 05/31/2017
ms.topic: article
ms.openlocfilehash: 58578d96f3a66177f858f78861cb93be51df3a1e
ms.sourcegitcommit: b115e5edc545571b6ff4f42082cc3ed965815ea4
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/30/2020
ms.locfileid: "93069680"
---
# <a name="avenues-to-compromise"></a>危及系統安全的途徑

>適用於：Windows Server 2016、Windows Server 2012 R2、Windows Server 2012

*第七個定律：最安全的網路是妥善管理的網路。* - [安全性管理的10個不可變法則](/previous-versions/cc722488(v=technet.10))

在發生嚴重入侵事件的組織中，評量通常會顯示組織對其 IT 基礎結構的實際狀態有很大的可見度，而這可能會與「已記載」的狀態有很大的差異。 這些差異引進了弱點來公開環境以犧牲風險，通常會有很少的探索風險，直到入侵攻擊者有效「擁有」環境為止。

這些組織 AD DS 設定、公開金鑰基礎結構 (Pki) 、伺服器、工作站、應用程式、存取控制清單 (Acl) 和其他技術的詳細評量會顯示錯誤設定和弱點，如果補救的話，可能會妨礙初始入侵。

IT 檔、程式和程式的分析會識別系統管理實務中的缺口所引進的弱點，而攻擊者最終會取得用來完全入侵 Active Directory 樹系的許可權。 完全遭盜用的樹系是攻擊者不只會危害個別系統、應用程式或使用者帳戶，而會提升其存取權以取得許可權層級，讓使用者可以修改或終結樹系的所有層面。 當 Active Directory 安裝遭到洩漏時，攻擊者可以進行變更，讓他們能夠維持整個環境的狀態（或更糟的狀態），以摧毀目錄以及它所管理的系統和帳戶。

雖然下列描述中常見的一些弱點並不是針對 Active Directory 的攻擊，但它們可讓攻擊者在環境中建立據點，以用來執行許可權提升 (也稱為提高許可權) 攻擊，最後會將 AD DS 設為目標和入侵。

本檔的這一節著重于說明攻擊者通常用來取得基礎結構存取權的機制，最後會啟動權限提高攻擊。 另請參閱下列各節：

-   [減少 Active Directory 攻擊面](../../../ad-ds/plan/security-best-practices/../../../ad-ds/plan/security-best-practices/../../../ad-ds/plan/security-best-practices/Reducing-the-Active-Directory-Attack-Surface.md) Active Directory 的安全設定詳細建議。

-   [監視入侵徵兆 Active Directory](../../../ad-ds/plan/security-best-practices/Monitoring-Active-Directory-for-Signs-of-Compromise.md) 協助偵測入侵的建議

-   [規劃入侵](../../../ad-ds/plan/security-best-practices/../../../ad-ds/plan/security-best-practices/Planning-for-Compromise.md) 協助針對 IT 和商務觀點的基礎結構進行攻擊的高階方法

> [!NOTE]
> 雖然本檔著重于屬於 AD DS 領域的 Active Directory 和 Windows 系統，但攻擊者很少只著重在 Active Directory 和 Windows 上。 在混合作業系統、目錄、應用程式和資料存放庫的環境中，通常會發現非 Windows 系統也遭到入侵。 如果系統在 Windows 和非 Windows 環境之間提供「橋接器」，例如 Windows 和 UNIX 或 Linux 用戶端所存取的檔案伺服器、提供驗證服務給多個作業系統的目錄，或跨不同目錄同步處理資料的 metadirectories，則尤其如此。
>
> AD DS 的目標是因為集中存取和設定管理功能不僅提供給 Windows 系統，也提供給其他用戶端。 任何其他提供驗證和設定管理服務的目錄或應用程式都可以，並以判斷攻擊者為目標。 雖然本檔的重點在於可以降低 Active Directory 安裝遭到入侵的可能性，但包含非 Windows 電腦、目錄、應用程式或資料存放庫的每個組織也應該針對這些系統進行攻擊。

## <a name="initial-breach-targets"></a>初始缺口目標
沒有人刻意建立一個 IT 基礎結構，讓組織暴露于入侵。 第一次建立 Active Directory 樹系時，通常是初始化且最新的。 當年通過和新的作業系統和應用程式時，就會新增至樹系。 由於 Active Directory 提供的管理能力優點可辨識、更多內容新增至目錄、讓更多人將其電腦或應用程式與 AD DS 整合，以及升級網域，以支援最新版本的 Windows 作業系統所提供的新功能。 但一段時間也會發生這種情況，也就是在新增基礎結構時，基礎結構的其他部分可能不會在一開始就進行維護，而系統和應用程式也會正常運作，因此不會收到任何問題，而組織也會開始忘記他們未刪除其舊版基礎結構。 根據我們在評估遭盜用的基礎結構、較舊、更大且更複雜的環境中所看到的內容，最有可能是經常被惡意探索的弱點有許多實例。

無論攻擊者的動機為何，大部分的資訊安全性漏洞一次都是從一或兩個系統的入侵。 這些初始事件或進入網路的進入點，通常會利用可能已修正但未解決的弱點。 [2012 資料缺口調查報告 (DBIR) ](http://www.verizonbusiness.com/resources/reports/rp_data-breach-investigations-report-2012_en_xg.pdf)，這是由 Verizon 風險小組與許多國家安全機關和其他公司合作所產生的年度研究，指出96% 的攻擊是「不太困難」，而「97% 的缺口是透過簡單或中繼的控制項肇因的。」 這些發現可能是常見的惡意探索弱點的直接結果。

### <a name="gaps-in-antivirus-and-antimalware-deployments"></a>防毒軟體和反惡意程式碼部署的間距
*定律號碼八：過期的惡意程式碼掃描程式，只比掃描器來得好。* - [安全性 (2.0 版的十大不可變法則) ](https://www.microsoft.com/en-us/msrc?rtc=1)

分析組織的防毒軟體和反惡意程式碼部署通常會顯示環境，其中大部分工作站都是使用已啟用且最新的防毒軟體和反惡意程式碼軟體進行設定。 例外狀況通常是不常連線到公司環境或員工裝置的工作站，防毒軟體和反惡意程式碼軟體可能很難部署、設定和更新。

不過，伺服器人口通常會在許多遭入侵的環境中受到較不一致的保護。 如同 [2012 資料缺口調查](http://www.verizonbusiness.com/resources/reports/rp_data-breach-investigations-report-2012_en_xg.pdf)中所報告的，所有資料的94% 都會受到影響，而這些伺服器代表去年的成長18%，以及惡意軟體的惡意攻擊69%。 在伺服器擴展中，發現防毒軟體和反惡意程式碼安裝的設定不一致、過期、設定不正確或甚至停用的情況並不常見。 在某些情況下，系統管理人員會停用防毒軟體和反惡意程式碼軟體，但在其他情況下，攻擊者會在透過其他弱點危害伺服器之後停用軟體。 當防毒軟體和反惡意程式碼軟體停用時，攻擊者接著會在伺服器上植入惡意程式碼，並專注于在伺服器人口間傳播入侵。

這並不只是為了確保您的系統受到最新的全面惡意程式碼防護的保護，同時也可監視系統以停用或移除防毒軟體和反惡意程式碼軟體，並在手動停用時自動重新開機保護。 雖然沒有防毒軟體和反惡意程式碼軟體可保證預防和偵測所有感染，但已正確設定和部署的防毒軟體和反惡意程式碼的執行可能會降低感染的可能性。

### <a name="incomplete-patching"></a>未完成修補
*定律3：如果您不跟上安全性修正程式，您的網路不會太久。* - [安全性管理的10個不可變法則](/previous-versions/cc722488(v=technet.10))

Microsoft 會在每個月的第二個星期二釋出安全性佈告欄，雖然在罕見的情況下，安全性更新 (這些更新，這些更新也稱為「頻外」更新，) 當弱點判斷為客戶系統帶來緊急風險時。 無論小型企業是否將其 Windows 電腦設定為使用 Windows Update 管理系統和應用程式修補，或大型組織使用如 Microsoft Endpoint Configuration Manager 的管理軟體，根據詳細的階層式方案來部署修補程式，許多客戶都能以相當及時的方式修補其 Windows 基礎結構。

不過，少數的基礎結構只包含 Windows 電腦和 Microsoft 應用程式，而在遭入侵的環境中，通常會發現組織的修補程式管理原則包含了一些差距。 這些環境中的 Windows 系統會以不一致的方式修補。 非 Windows 作業系統會偶爾修補（如果有的話）。 商用現成的 (COTS) 應用程式包含修補程式存在但尚未套用的弱點。 網路裝置通常會使用原廠預設認證來設定，且在安裝後不會有任何固件更新年份。 其廠商不再支援的應用程式和作業系統通常會保持執行狀態，儘管它們無法再針對弱點進行修補。 這些未修補的系統都代表攻擊者的另一個可能進入點。

IT 消費化帶來了額外的挑戰，那就是員工所擁有的裝置會用來存取公司擁有的資料，而組織可能幾乎無法控制員工個人裝置的修補和設定。 企業級硬體通常會隨附符合企業需求的設定選項和管理功能，代價是在個別自訂和裝置選擇中較少選擇。 以員工為焦點的硬體提供更廣泛的製造商、廠商、硬體安全性功能、軟體安全性功能、管理功能和設定選項，以及許多企業功能可能完全不存在。

#### <a name="patch-and-vulnerability-management-software"></a>修補程式和弱點管理軟體
如果有適用于 Windows 系統和 Microsoft 應用程式的有效修補管理系統，就會解決未修補弱點建立的攻擊面。 不過，除非非 Windows 系統、非 Microsoft 應用程式、網路基礎結構和員工裝置也會在修補程式和其他修正程式中保持最新狀態，否則基礎結構會保持易受攻擊。 在某些情況下，應用程式的廠商可能會提供自動更新功能;在其他情況下，可能需要設計一種方法來定期取出並套用修補程式和其他修正程式。

### <a name="outdated-applications-and-operating-systems"></a>過期的應用程式和作業系統
*「您不能預期有六年期的作業系統，可以保護您免于遇到六個月的攻擊。」* -資訊安全專業人員10年來保護企業安裝的經驗

雖然「取得最新的，保持最新」聽起來可能像是行銷片語，過時的作業系統和應用程式會在許多組織的 IT 基礎結構中建立風險。 廠商仍會支援在2003中發行的作業系統，並提供解決弱點的更新，但該作業系統可能不包含較新版本作業系統中新增的安全性功能。 過期的系統甚至可能需要減弱某些 AD DS 安全性設定，以支援這些電腦的較小功能。

使用舊版驗證通訊協定的應用程式，因為不再支援該應用程式的廠商所撰寫的應用程式，通常無法改良以支援更強的驗證機制。 不過，組織的 Active Directory 網域仍可能設定為儲存 LAN Manager 雜湊或可反向加密的密碼，以支援這類應用程式。 在引進較新的作業系統之前所撰寫的應用程式，在目前的作業系統上可能無法正常運作或完全無法運作，因此需要組織維護較舊和較舊的系統，而在某些情況下，則是完全不受支援的硬體和軟體。

即使組織已經將網域控制站更新至 Windows Server 2012、Windows Server 2008 R2 或 Windows Server 2008，通常還是會發現要執行 Windows Server 2003、Windows 2000 Server 或 Windows NT Server 4.0 (（完全不支援) ）的成員伺服器擴展的重要部分。 組織越久維護過時系統，功能集之間的差異會增加，而且可能會導致生產系統不受支援。 此外，維護 Active Directory 樹系的時間愈久，我們會發現升級計畫中遺漏了舊版系統和應用程式。 這可能表示執行單一應用程式的單一電腦可能引進網域或全樹系弱點，因為 Active Directory 設定為支援其舊版通訊協定和驗證機制。

若要排除舊版系統和應用程式，您應該先專注于識別並編目它們，然後再決定要升級或取代應用程式或主機。 雖然找不到任何支援或升級路徑的高度特製化應用程式可能會很難找到替代項，但您可以利用稱為「創意損毀」的概念，以提供必要功能的新應用程式取代繼承應用程式。 本檔稍後的「如何進行入侵規劃」會更深入地說明[危害的規劃](../../../ad-ds/plan/security-best-practices/../../../ad-ds/plan/security-best-practices/Planning-for-Compromise.md)。

### <a name="misconfiguration"></a>設定錯誤
*定律4：在從未安全的電腦上安裝安全性修正程式，並不是很好的作法。* - [安全性管理的10個不可變法則](/previous-versions/cc722488(v=technet.10))

即使在系統通常保持最新狀態和修補的環境中，我們通常會識別作業系統、電腦上執行的應用程式，以及 Active Directory 的間隙或錯誤配置。 某些錯誤配置只會公開本機電腦，但在電腦「擁有」之後，攻擊者通常會著重于進一步將折衷傳播到其他系統，最後是 Active Directory。 以下是一些常見的部分，我們會在這些區域中識別引進風險的設定。

#### <a name="in-active-directory"></a>在 Active Directory
在 Active Directory 中，攻擊者最常鎖定的帳戶是最高許可權群組的成員，例如 Domain Admins 的成員 (DA) 、Enterprise Admins (EA) ，或 (中的內建系統管理員) BA Active Directory 群組。 這些群組的成員資格應縮減為最小的帳戶數目，如此一來，這些群組的受攻擊面就會受到限制。 您甚至可以消除這些特殊許可權群組中的「永久」成員資格;也就是說，您可以執行設定，讓您只在需要網域和全樹系的許可權時，暫時填入這些群組。 使用高許可權帳戶時，應該只在指定的安全系統（例如網域控制站或安全的系統管理主機）上使用。 [減少 Active Directory 攻擊面](../../../ad-ds/plan/security-best-practices/../../../ad-ds/plan/security-best-practices/../../../ad-ds/plan/security-best-practices/Reducing-the-Active-Directory-Attack-Surface.md)時，會提供協助執行這些設定的詳細資訊。

當我們評估 Active Directory 中最高許可權群組的成員資格時，通常會在所有三個最具許可權的群組中找到過度的成員資格。 在某些情況下，組織在 DA 群組中有數十個以上的帳戶。 在其他情況下，組織會將帳戶直接放入內建的系統管理員群組中，以為群組的許可權比 DAs 群組低。 這不是。 在樹系根域中，我們通常會發現 EA 群組的一些永久成員，儘管 EA 許可權很少且暫時需要。 在這三個群組中尋找 IT 使用者的日常系統管理帳戶也是很常見的，雖然這是有效的重複設定。 如 [減少 Active Directory 攻擊面](../../../ad-ds/plan/security-best-practices/../../../ad-ds/plan/security-best-practices/../../../ad-ds/plan/security-best-practices/Reducing-the-Active-Directory-Attack-Surface.md)的說明，帳戶是否為其中一個群組或所有群組的永久成員，也可以使用此帳戶來危害，甚至終結 AD DS 的環境以及受 it 管理的系統與帳戶。 在 Active Directory 中，提供安全設定和使用特殊許可權帳戶的建議，以 [減少 Active Directory 攻擊面](../../../ad-ds/plan/security-best-practices/../../../ad-ds/plan/security-best-practices/../../../ad-ds/plan/security-best-practices/Reducing-the-Active-Directory-Attack-Surface.md)。

#### <a name="on-domain-controllers"></a>在網域控制站上
當我們評估網域控制站時，通常會發現它們的設定與管理方式與成員伺服器沒有任何不同。 網域控制站有時候會執行安裝在成員伺服器上的相同應用程式和公用程式，而不是因為網域控制站需要它們，但應用程式是標準組建的一部分。 這些應用程式可能會在網域控制站上提供最少的功能，但藉由要求設定以開啟埠、建立高度特殊許可權的服務帳戶，或將存取權授與不應針對驗證和群組原則應用程式以外的任何目的而連接至網域控制站的使用者，授與系統的存取權。 在某些缺口中，攻擊者使用的工具已安裝在網域控制站上，不僅能取得網域控制站的存取權，還可以修改或損毀 AD DS 資料庫。

當我們將網域控制站上的 Internet Explorer 設定設定解壓縮時，我們發現使用者已登入 Active Directory 中具有高許可權等級的帳戶，且已使用帳戶從網域控制站存取網際網路和內部網路。 在某些情況下，帳戶已在網域控制站上設定 Internet Explorer 設定以允許下載網際網路內容，並已從網際網路網站下載並安裝在網域控制站上的免費軟體公用程式。 預設會為使用者和系統管理員啟用 Internet Explorer 增強式安全性設定，但我們通常會發現系統管理員已停用此功能。 當高度特殊許可權的帳戶存取網際網路，並將內容下載到任何電腦時，該電腦會面臨嚴重的風險。 當電腦是網域控制站時，系統會將整個 AD DS 安裝放在風險中。

##### <a name="protecting-domain-controllers"></a>保護網域控制站
網域控制站應該被視為重要的基礎結構元件，安全地 stringently，並設定比檔案、列印和應用程式伺服器更嚴格。 網域控制站不應該執行網域控制站不需要的任何軟體，也不能防止網域控制站遭受攻擊。 網域控制站不應該被允許存取網際網路，而且應由群組原則 (Gpo) 的物件來設定和強制執行安全性設定。 安全地安裝、設定和管理網域控制站的詳細建議，是為了 [保護網域控制站免于遭受攻擊](../../../ad-ds/plan/security-best-practices/Securing-Domain-Controllers-Against-Attack.md)。

#### <a name="within-the-operating-system"></a>在作業系統中
*定律二：如果不良的人可以改變電腦上的作業系統，則不是您的電腦。* - [安全性 (2.0 版的十大不可變法則) ](https://www.microsoft.com/en-us/msrc?rtc=1)

雖然某些組織會針對不同類型的伺服器建立基準設定，並允許在安裝後進行有限的作業系統自訂，但遭入侵環境的分析通常會以臨機操作方式來暴露大量部署的伺服器，並以手動方式和個別方式進行設定。 兩部執行相同功能的伺服器之間的設定可能完全不同，因為這兩部伺服器都沒有安全地設定。 相反地，伺服器設定基準可能會一致地強制執行，但也會持續設定錯誤。也就是說，伺服器的設定方式是在指定類型的所有伺服器上建立相同的弱點。 設定不正確的方式包括停用安全性功能、將過多的許可權授與帳戶 (特別是服務帳戶) 、跨系統使用相同的本機認證，以及允許安裝未經授權的應用程式和公用程式，以建立自己的弱點。

##### <a name="disabling-security-features"></a>停用安全性功能
組織有時會停用具有 Advanced Security (WFAS 的 Windows 防火牆) 不確定 WFAS 很難設定或需要大量工作的設定。 不過，從 Windows Server 2008 開始，在伺服器上安裝任何角色或功能時，預設會使用角色或功能運作所需的最低許可權來設定，而且 Windows 防火牆會自動設定為支援角色或功能。 藉由停用 WFAS (而不是在其位置) 使用另一個主機型防火牆，組織會增加整個 Windows 環境的受攻擊面。 周邊防火牆提供一些保護，以防止直接以網際網路為目標的攻擊，但不能防範惡意探索其他攻擊媒介的攻擊，例如 [磁片磁碟機的下載](https://www.microsoft.com/security/sir/glossary/drive-by-download-sites.aspx) 攻擊，或是源自內部網路上其他遭入侵系統的攻擊。

使用者帳戶控制 (UAC) 設定在伺服器上會被停用，因為系統管理人員會發現入侵的提示。 雖然 [Microsoft 支援服務文章 2526083](https://support.microsoft.com/kb/2526083) 描述 uac 可能在 Windows Server 上停用的案例，除非您執行的是 Server core 安裝， (在設計) 停用 uac 的情況下，您不應在伺服器上停用 uac，而不需要仔細考慮和研究。

在其他情況下，伺服器設定會設定為較不安全的值，因為組織會將過期的伺服器設定設定套用至新的作業系統，例如將 Windows Server 2003 基準套用至執行 Windows Server 2012、Windows Server 2008 R2 或 Windows Server 2008 的電腦，而不需變更基準以反映作業系統中的變更。 您可以在部署新的作業系統時，檢查安全性變更和設定，以確保所實行的設定適用且適用于新的作業系統，而不會將舊的伺服器基準帶到新的作業系統。

##### <a name="granting-excessive-privilege"></a>授與過多許可權
在幾乎每個已評估的環境中，會將過多的許可權授與 Windows 系統上的本機網域和網域型帳戶。 使用者會被授與他們工作站上的本機系統管理員許可權、成員伺服器執行的服務設定許可權超出所需功能的許可權，而伺服器擴展的本機系統管理員群組則包含數十個或甚至數百個本機和網域帳戶。 只有一部電腦上的特殊許可權帳戶遭到入侵，可讓攻擊者危害登入電腦的每個使用者和服務的帳戶，以及搜集和利用認證將危害傳播到其他系統。

雖然傳遞雜湊 (PTH) 和其他認證竊取攻擊現在都很普遍，但這是因為在攻擊者取得電腦的系統管理員或系統層級存取權時，有自由的工具可讓您輕鬆且輕鬆地解壓縮其他特殊許可權帳戶的認證。 即使沒有可讓您從登入會話取得認證的工具，具有電腦存取權的攻擊者也可以輕鬆地安裝按鍵記錄器，以捕捉擊鍵、螢幕擷取畫面和剪貼簿內容。 具有電腦之特殊存取權限的攻擊者可以停用反惡意程式碼軟體、安裝 rootkit、修改受保護的檔案，或是在電腦上安裝惡意程式碼，以將攻擊自動化，或將伺服器變成 [磁片磁碟機（依下載主機）](https://www.microsoft.com/security/sir/glossary/drive-by-download-sites.aspx) 。

用來將缺口延伸到單一電腦以外的策略會有所不同，但傳播入侵的關鍵是取得額外系統的高特殊許可權存取權。 藉由減少具有任何系統特殊存取權限的帳戶數目，您不但可以減少該電腦的受攻擊面，還可以降低攻擊者從電腦收集寶貴認證的可能性。

##### <a name="standardizing-local-administrator-credentials"></a>標準化本機系統管理員認證
安全性專家在 Windows 電腦上重新命名本機系統管理員帳戶的價值，是很長的爭論。 本機系統管理員帳戶的重要事項是，是否在多部電腦上設定相同的使用者名稱和密碼。

如果本機系統管理員帳戶在伺服器上命名為相同的值，而且指派給帳戶的密碼也設定為相同的值，攻擊者可以在已取得系統管理員或系統層級存取權的一部電腦上解壓縮帳戶的認證。 攻擊者一開始不需要危及系統管理員帳戶，他們只需要洩漏屬於本機 Administrators 群組成員的使用者帳戶，或是已設定為以 LocalSystem 或具有系統管理員許可權執行的服務帳戶。 攻擊者接著可以解壓縮系統管理員帳戶的認證，並將網路登入中的認證重新執行到網路上的其他電腦。

只要另一部電腦的本機帳戶具有相同的使用者名稱和密碼 (或密碼雜湊) 作為所呈現的帳號憑證，登入嘗試就會成功，而攻擊者會取得目的電腦的特殊許可權存取權。 在目前的 Windows 版本中， [預設會停用](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc753450(v=ws.11))內建的系統管理員帳戶，但在舊版作業系統中，預設會啟用此帳戶。

> [!NOTE]
> 某些組織已刻意設定要啟用的本機系統管理員帳戶，在此情況下，如果所有其他特殊許可權的帳戶遭到鎖定，系統便會提供「安全」。 但是，即使本機系統管理員帳戶已停用，而且沒有其他可用來啟用帳戶或以系統管理員許可權登入系統的帳戶，系統仍可開機進入安全模式，並且可以重新啟用內建的本機系統管理員帳戶，如 [Microsoft 支援服務文章 814777](https://support.microsoft.com/kb/814777)所述。 此外，如果系統仍然成功套用 Gpo，則可以將 GPO 修改為暫時 () 重新啟用系統管理員帳戶，或設定限制群組以將網域型帳戶新增至本機系統管理員群組。 您可以執行修復，並再次停用系統管理員帳戶。 若要有效防止使用內建本機系統管理員帳號憑證的橫向入侵，必須為本機系統管理員帳戶設定唯一的使用者名稱和密碼。 若要透過 GPO 部署本機系統管理員帳戶的唯一密碼，請參閱 technet 上的透過 [gpo 管理內建系統管理員帳戶密碼的解決方案](/previous-versions/mt227395(v=msdn.10)) 。  

##### <a name="permitting-installation-of-unauthorized-applications"></a>允許安裝未經授權的應用程式
*定律1：如果不良的人可以說服您在您的電腦上執行程式，則不是您的電腦。* - [安全性 (2.0 版的十大不可變法則) ](https://www.microsoft.com/en-us/msrc?rtc=1)

無論組織是否在伺服器上部署一致的基準設定，都不應該允許安裝不屬於伺服器定義角色的應用程式。 藉由允許安裝的軟體不是伺服器指定功能的一部分，伺服器會暴露于不慎或惡意的軟體安裝，以增加伺服器的攻擊面、引進應用程式弱點，或造成系統不穩定。

#### <a name="applications"></a>應用程式
如先前所述，應用程式通常會安裝並設定為使用授與的帳戶比應用程式實際需要的更多許可權。 在某些情況下，應用程式的檔會指定服務帳戶必須是伺服器本機系統管理員群組的成員，或者必須設定為在 LocalSystem 的內容中執行。 這通常不是因為應用程式需要這些許可權，但因為決定應用程式服務帳戶所需的許可權和許可權，需要投資額外的時間和精力。 如果應用程式未安裝應用程式所需的最低許可權，以及其所設定功能的功能，系統就會暴露于利用應用程式許可權的攻擊，而不會受到作業系統本身的任何攻擊。

### <a name="lack-of-secure-application-development-practices"></a>缺乏安全的應用程式開發實務
有基礎結構可支援商務工作負載。 在自訂應用程式中執行這些工作負載時，請務必確保應用程式是使用安全的最佳作法所開發。 企業級事件的根本原因分析，通常會顯示透過自訂應用程式（尤其是網際網路面向的應用程式）會影響初始的危害。 大部分的危害都是透過危及知名攻擊的方式來完成，例如 SQL 插入式攻擊 (SQLi) 和跨網站腳本 (XSS) 攻擊。

SQL 插入式攻擊是一種應用程式弱點，可讓使用者定義的輸入修改傳遞至資料庫以執行的 SQL 語句。 您可以透過應用程式中的欄位、參數 (（例如查詢字串或 cookie) 或其他方法）來提供此輸入。 這項插入的結果就是提供給資料庫的 SQL 語句基本上與開發人員所預期的不同。 例如，在評估使用者名稱/密碼組合時使用的一般查詢如下：

`SELECT userID FROM users WHERE username = 'sUserName' AND password = 'sPassword'`

當資料庫伺服器收到這種情況時，它會指示伺服器查看 [使用者] 資料表，並傳回任何 userID 記錄，其中使用者名稱和密碼符合使用者所提供的使用者名稱和密碼 (希望透過某種形式的登入表單) 。 在這種情況下，開發人員的目的是要在使用者可以提供正確的使用者名稱和密碼時，才會傳回有效的記錄。 如果其中一項不正確，資料庫伺服器將找不到相符的記錄並傳回空的結果。

當攻擊者執行非預期的情況時，就會發生此問題，例如提供自己的 SQL 來取代有效的資料。 由於 SQL 是由資料庫伺服器即時轉譯，因此插入的程式碼會像開發人員將它放在自己的程式碼一樣處理。 例如，如果攻擊者輸入使用者識別碼的 **系統管理員** 、 **xyz** 或 **1 = 1** 做為密碼，則資料庫所處理的結果語句會是：

`SELECT userID FROM users WHERE username = 'administrator' AND password = 'xyz' OR 1=1`

當資料庫伺服器處理此查詢時，會在查詢中傳回資料表中的所有資料列，因為 1 = 1 永遠會評估為 True，因此，如果已知或提供正確的使用者名稱和密碼，就不會有任何影響。 在大多數情況下，最後的結果是使用者將以使用者資料庫中的第一位使用者身分登入。在大部分的情況下，這會是系統管理使用者。

除了只要登入，格式不正確的 SQL 語句也可以用來加入、刪除或變更資料，甚至從資料庫卸載 (刪除) 整份資料表。 在 SQLi 與過多許可權結合的最極端情況下，可以執行作業系統命令以建立新使用者、下載攻擊工具，或採取任何其他攻擊者選擇的動作。

在跨網站腳本中，會在應用程式的輸出中引進此弱點。 攻擊是從提供格式不正確的資料給應用程式的攻擊者開始，但在此情況下，格式不正確的資料會以腳本撰寫程式碼的形式 (例如，將由犧牲者的瀏覽器執行的 JavaScript) 。 惡意探索 XSS 弱點可讓攻擊者在啟動瀏覽器之使用者的環境中，執行目標應用程式的任何功能。 XSS 攻擊通常是由網路釣魚電子郵件所起始，鼓勵使用者按一下連結至應用程式的連結，然後執行攻擊程式碼。

XSS 通常會在線上銀行和電子商務案例中受到攻擊，攻擊者可以在惡意探索的使用者環境中，進行購買或轉移。 如果是以自訂 web 身分識別管理應用程式為目標的攻擊，它可以讓攻擊者建立自己的身分識別、修改許可權和許可權，並導致系統洩漏。

雖然跨網站腳本和 SQL 插入的完整討論不在本檔的討論範圍內，但 [開放式 Web 應用程式安全性專案 (OWASP) ](https://www.owasp.org/index.php/Main_Page) 發佈前10份清單，其中包含弱點和對策的深入討論。

無論在基礎結構安全性方面的投資，如果在該基礎結構內部署了設計不佳且撰寫的應用程式，則環境會容易受到攻擊。 即使是安全安全的基礎結構，通常也無法為這些應用程式攻擊提供有效的對策。 複合問題，設計不良的應用程式可能需要授與服務帳戶過多的許可權，應用程式才能運作。

Microsoft 安全性開發週期 (SDL) 是一組結構化的流程式控制制，可在應用程式的生命週期內，在應用程式的生命週期內淘汰之前，先改進在需求收集和擴充的早期安全性。 從安全性的角度來看，這項有效的安全性控制措施並不重要，因此確保應用程式安全性的成本和排程有效，是很重要的。 當應用程式有效完成程式碼時，評估應用程式的安全性問題，需要組織在部署應用程式之前或甚至之後，進行應用程式安全性的決策。 組織可以選擇在生產環境中部署應用程式之前，先解決應用程式的瑕疵問題、產生成本和延遲，或是將應用程式部署到具有已知安全性瑕疵的生產環境中，進而使組織遭受危害。

某些組織會將修正每個問題的實際執行程式 $10000 代碼中的安全性問題的完整成本降低，而在沒有有效 SDL 的情況下開發的應用程式，可以平均每100000行程式碼有10個以上的高嚴重性問題。 在大型應用程式中，成本很快就會提升。 相較之下，許多公司在 SDL 的最後程式碼審查階段，為每100000行程式碼設定一個不只一個問題的基準測試，並以生產環境中高風險應用程式的零個問題為目標。

藉由在應用程式的需求收集與設計方面納入安全性需求，以提供高風險應用程式的威脅分析模型，來實行 SDL 改善安全性;需要開發人員的有效訓練和監視;而且需要清楚、一致的程式碼標準和作法。 SDL 的淨影響是應用程式安全性大幅改進，同時降低開發、部署、維護和解除委任應用程式的成本。 雖然 SDL 的設計和實行詳細討論已超出本檔的範圍，但請參閱 [Microsoft 安全性開發生命週期](https://www.microsoft.com/security/sdl/default.aspx) ，以取得詳細的指引和資訊。

