---
description: 深入瞭解：實施 Least-Privilege 系統管理模型
ms.assetid: 7a7ab95c-9cb3-4a7b-985a-3fc08334cf4f
title: 實作最低權限管理模型
ms.author: daveba
author: iainfoulds
manager: daveba
ms.date: 08/09/2018
ms.topic: article
ms.openlocfilehash: ca8d073eff673697a65fd1266cf7de19ccd90c97
ms.sourcegitcommit: e2dadc9b0c227a489a945bbc531aca5e101f18cd
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 12/29/2020
ms.locfileid: "97801752"
---
# <a name="implementing-least-privilege-administrative-models"></a>實作最低權限管理模型

>適用於：Windows Server 2016、Windows Server 2012 R2、Windows Server 2012

下列摘要取自 [系統管理員帳戶安全性規劃指南](/previous-versions/tn-archive/cc162797(v=technet.10))，第一次在1999年4月1日發佈：

> 「大部分與安全性相關的訓練課程和檔會討論最低許可權原則的實施，但是組織很少會遵循此原則。 原則很簡單，而套用它的影響會大幅提高安全性並降低您的風險。 原則會指出所有使用者都應該使用具有完成目前工作所需之絕對最低許可權的使用者帳戶登入，而不需要進行任何其他動作。 這麼做可針對惡意程式碼提供防護，以及其他攻擊。 此原則適用于電腦以及這些電腦的使用者。
> 「這個原則的運作原因之一，就是它會強制您進行一些內部研究。 例如，您必須判斷電腦或使用者真正需要的存取權限，然後加以執行。 對於許多組織來說，這項工作一開始可能就像是很棒的工作;不過，這是成功保護網路環境的必要步驟。
> 「您應以最低許可權的概念，授與所有網域系統管理員使用者的網域許可權。 例如，如果系統管理員以特殊許可權帳戶登入，並不慎執行病毒程式，則病毒具有本機電腦和整個網域的系統管理存取權。 如果系統管理員以未具許可權的身分登入， (非系統管理的) 帳戶，病毒的損害範圍只是本機電腦，因為它是以本機電腦使用者的身分執行。
> 在另一個範例中，即使樹系之間有信任關係，您授與網域層級系統管理員許可權的帳戶在另一個樹系中必須沒有較高的許可權。 如果攻擊者設法入侵一個受管理的樹系，此技巧可協助防止發生嚴重損壞。 組織應定期審核其網路，以防止未經授權的許可權提升。」

下列摘錄取自 [Microsoft Windows 安全性資源套件](https://www.microsoftpressstore.com/store/microsoft-windows-security-resource-kit-9780735621749)，第一次在2005中發佈：

> 「在授與執行工作所需的最少許可權時，一定要考慮安全性。 如果有太多許可權的應用程式應該會遭到入侵，攻擊者可能會將攻擊擴大到超過應用程式的最少許可權。 例如，檢查網路系統管理員意外開啟啟動病毒的電子郵件附件的後果。 如果系統管理員是使用網域系統管理員帳戶登入，則病毒將擁有網域中所有電腦的系統管理員許可權，因此不受限制地存取網路上幾乎所有的資料。 如果系統管理員是使用本機系統管理員帳戶登入，則病毒將擁有本機電腦的系統管理員許可權，因此能夠存取電腦上的任何資料，並在電腦上安裝重要的軟體，例如金鑰筆觸記錄軟體。 如果系統管理員是使用一般使用者帳戶登入，則病毒將只能存取系統管理員的資料，而且將無法安裝惡意軟體。 藉由使用讀取電子郵件所需的最低許可權，在此範例中，可能會大幅降低入侵的潛在範圍。」

## <a name="the-privilege-problem"></a>許可權問題

上述摘錄中所述的原則並未變更，但在評估 Active Directory 安裝時，我們會發現有過多的帳戶已獲得超過執行日常工作所需的許可權和許可權。 環境的大小會影響過高許可權的帳戶未經處理的數目，但不是依中型的目錄，在最高許可權的群組中可能會有數十個帳戶，而大型安裝可能有數百個或甚至數千個。 有幾個例外狀況，無論攻擊者的技能和利器的複雜度為何，攻擊者通常都遵循最不受阻力的路徑。 它們會提高其工具和方法的複雜度，只有在和較簡單的機制失敗或由防禦者阻撓時才會這麼做。

可惜的是，許多環境中最小的阻力路徑已證明是過度使用具有廣泛和深層許可權的帳戶。 廣泛許可權是許可權和許可權，可讓帳戶在大部分的環境中執行特定的活動，例如，技術支援人員可能會被授與許可權，讓他們能夠在許多使用者帳戶上重設密碼。

深層許可權是功能強大的許可權，適用于人口的窄區段，例如在伺服器上提供工程師的系統管理員許可權，讓他們可以執行修復。 廣泛的許可權和深層許可權都不一定是危險的，但如果網域中有許多帳戶被永久授與更廣泛和深層許可權，則可以快速地將環境重新設定為攻擊者的用途，甚至是損毀基礎結構的大型區段。

傳遞雜湊攻擊是一種認證遭竊攻擊，因為執行這些攻擊的工具可自由使用且容易使用，而且許多環境很容易受到攻擊。 不過，傳遞雜湊攻擊並不是真正的問題。 問題的關鍵在於是雙重的：

1. 攻擊者通常很容易取得單一電腦上的深層許可權，然後將該許可權廣泛傳播到其他電腦。
2. 在計算環境中，通常會有太多具有高階許可權的永久帳戶。

即使消除了傳遞雜湊攻擊，攻擊者還是只會使用不同的策略，而不是不同的策略。 他們可能會植入可記錄按鍵的惡意程式碼，或利用任何其他方法來捕捉在環境中功能強大的認證，而不是使用包含認證竊取工具的惡意程式碼。 無論策略為何，目標都會維持不變：具有廣泛和深層許可權的帳戶。

授與過多許可權並不只是在遭盜用的環境中 Active Directory。 當組織開發出授與比所需更多許可權的習慣時，通常會在整個基礎結構中找到，如下列各節所述。

## <a name="in-active-directory"></a>在 Active Directory

在 Active Directory 中，通常會發現 EA、DA 和 BA 群組包含的帳戶數量過多。 最常見的情況是，組織的 EA 群組包含最少的成員，而 DA 群組通常會包含 EA 群組中使用者數目的乘數，而系統管理員群組通常會包含比其他群組的人口合併更多的成員。 這通常是因為系統管理員以非 DAs 或 EAs 的「許可權較低」。 雖然授與的每個群組的權利和許可權各有不同，但它們應該有效地視為相同的強大群組，因為其中一個成員可以讓自己或自己成為其他兩個群組的成員。

## <a name="on-member-servers"></a>在成員伺服器上

當我們在許多環境中取得成員伺服器上本機系統管理員群組的成員資格時，我們會發現成員資格範圍從數個本機和網域帳戶，到數十個嵌套群組，在擴充時，會在伺服器上以本機系統管理員許可權來顯示數百甚至數千個帳戶。 在許多情況下，具有大型成員資格的網域群組會嵌套在成員伺服器的本機系統管理員群組中，而不會考慮任何可以修改網域中這些群組成員資格的使用者，可以針對群組已嵌套在本機 Administrators 群組中的所有系統，獲得系統管理控制。

## <a name="on-workstations"></a>在工作站上

雖然工作站的本機系統管理員群組中通常會有比成員伺服器更少的成員，但是在許多環境中，使用者會被授與其個人電腦上本機系統管理員群組的成員資格。 發生這種情況時，即使已啟用 UAC，那些使用者也會對工作站的完整性帶來更高的風險。

> [!IMPORTANT]
> 您應該仔細考慮使用者是否需要工作站上的系統管理許可權，如果有的話，更好的方法可能是在屬於 Administrators 群組成員的電腦上建立個別的本機帳戶。 當使用者需要提高許可權時，他們可以出示該本機帳戶的認證來提高許可權，但因為帳戶是本機帳戶，所以無法用來危害其他電腦或存取網域資源。 不過，就像使用任何本機帳戶一樣，本機特殊許可權帳戶的認證應該是唯一的;如果您在多個工作站上使用相同的認證來建立本機帳戶，則會公開電腦以傳遞雜湊的攻擊。

## <a name="in-applications"></a>在應用程式中

如果攻擊的目標是組織的智慧財產，則在應用程式內被授與強大許可權的帳戶，可以設定為允許遭到外泄資料。 雖然可存取敏感性資料的帳戶可能被授與網域或作業系統中沒有較高許可權的帳戶，但可以操作應用程式設定或存取應用程式提供之資訊的帳戶可能會有風險。

## <a name="in-data-repositories"></a>在資料存放庫中

如同其他目標的情況一樣，試圖以檔和其他檔案形式存取智慧財產的攻擊者，可以將控制檔案存放區存取權的帳戶、可直接存取檔案的帳戶，或甚至可存取檔案的群組或角色鎖定。 例如，如果用來儲存合約檔的檔案伺服器，以及藉由使用 Active Directory 群組來授與存取權，則可以修改群組成員資格的攻擊者可以將遭盜用的帳戶新增至群組，並存取合約檔。 當應用程式（例如 SharePoint）提供檔的存取權時，攻擊者可以如先前所述，將應用程式設為目標。

## <a name="reducing-privilege"></a>降低許可權

更大且更複雜的環境，是管理和保護的困難。 在小型組織中，檢查和降低許可權可能是相當簡單的主張，但在組織中使用的每個額外伺服器、工作站、使用者帳戶和應用程式會新增另一個必須受到保護的物件。 因為妥善保護組織 IT 基礎結構的每個層面可能會很困難或甚至不可能，所以您應該先專注于許可權建立最大風險的帳戶，這通常是 Active Directory 中內建的特殊許可權帳戶和群組，以及工作站和成員伺服器上的特殊許可權本機帳戶。

### <a name="securing-local-administrator-accounts-on-workstations-and-member-servers"></a>保護工作站和成員伺服器上的本機系統管理員帳戶

雖然本檔著重于保護 Active Directory （如先前所述），但對目錄的大部分攻擊都是針對個別主機進行攻擊。 無法提供保護成員系統上本機群組的完整指導方針，但您可以使用下列建議來協助保護工作站和成員伺服器上的本機系統管理員帳戶。

#### <a name="securing-local-administrator-accounts"></a>保護本機系統管理員帳戶

在所有目前的 Windows 版本上，預設會停用本機系統管理員帳戶，讓帳戶無法用於傳遞雜湊和其他認證竊取攻擊。 不過，在包含舊版作業系統或已啟用本機系統管理員帳戶的網域中，這些帳戶可以如先前所述，在成員伺服器和工作站之間傳播折衷。 基於這個理由，建議將下列控制項用於已加入網域之系統上的所有本機系統管理員帳戶。

[附錄 H：保護本機系統管理員帳戶和群組的安全](../../../ad-ds/plan/security-best-practices/Appendix-H--Securing-Local-Administrator-Accounts-and-Groups.md)，提供執行這些控制項的詳細指示。 不過，在執行這些設定之前，請先確定環境中目前未使用本機系統管理員帳戶來執行電腦上的服務，或執行不應使用這些帳戶的其他活動。 在生產環境中執行這些設定之前，請先進行徹底的測試。

#### <a name="controls-for-local-administrator-accounts"></a>本機系統管理員帳戶的控制項

內建的系統管理員帳戶絕不能用來做為成員伺服器上的服務帳戶，也不應該用來登入本機電腦 (但在安全模式下，即使帳戶已停用) 也是如此。 執行此處所述設定的目標是要防止每台電腦的本機系統管理員帳戶可供使用，除非先反轉保護控制項。 藉由執行這些控制項並監視系統管理員帳戶的變更，您可以大幅降低以本機系統管理員帳戶為目標的攻擊成功的可能性。

##### <a name="configuring-gpos-to-restrict-administrator-accounts-on-domain-joined-systems"></a>設定 Gpo 以限制 Domain-Joined 系統上的系統管理員帳戶

在您建立並連結到每個網域中的工作站和成員伺服器 Ou 的一或多個 Gpo 中，將系統管理員帳戶新增至 **電腦設定 \windows 設定** 設定 \ 使用者權限 \ 使用者權限指派中的下列使用者權限：

- 拒絕從網路存取這部電腦
- 拒絕以批次工作登入
- 拒絕以服務方式登入
- 拒絕透過遠端桌面服務登入

當您將系統管理員帳戶新增至這些使用者權限時，請指定您要以標籤帳戶的方式新增本機系統管理員帳戶或網域的系統管理員帳戶。 例如，若要將 NWTRADERS 網域的系統管理員帳戶新增到這些拒絕許可權，您可以將帳戶輸入為 **NWTRADERS\Administrator**，或流覽至 NWTRADERS 網域的系統管理員帳戶。 為確保您限制本機系統管理員帳戶，請在群組原則物件編輯器的這些使用者權限設定中輸入 **系統管理員** 。

> [!NOTE]
> 即使已重新命名本機系統管理員帳戶，仍會套用原則。

這些設定可確保電腦的系統管理員帳戶無法用來連線到其他電腦，即使該電腦不慎或惡意啟用也是如此。 使用本機系統管理員帳戶的本機登入不能完全停用，也不應該嘗試這麼做，因為電腦的本機系統管理員帳戶是設計用於嚴重損壞修復案例中。

如果成員伺服器或工作站從網域脫離，而沒有其他本機帳戶授與系統管理許可權，則可以將電腦開機進入安全模式、啟用系統管理員帳戶，然後使用該帳戶來影響電腦上的修復。 當修復完成時，應該再次停用系統管理員帳戶。

### <a name="securing-local-privileged-accounts-and-groups-in-active-directory"></a>保護 Active Directory 中的本機特殊許可權帳戶和群組

*定律6：電腦的安全，只有系統管理員值得信賴。* - [安全性 (2.0 版的十大不可變法則) ](https://www.microsoft.com/en-us/msrc?rtc=1)

此處提供的資訊旨在提供一般指導方針來保護 Active Directory 中的最高許可權內建帳戶和群組。 如需詳細的逐步指示，請參閱 [下列附錄 D：保護 Built-In 系統管理員帳戶 Active Directory](../../../ad-ds/plan/security-best-practices/Appendix-D--Securing-Built-In-Administrator-Accounts-in-Active-Directory.md)、 [附錄 E：保護 Active Directory 的 Enterprise admins 群組](../../../ad-ds/plan/security-best-practices/Appendix-E--Securing-Enterprise-Admins-Groups-in-Active-Directory.md)、 [附錄 F：保護 Active Directory 中的 Domain Admins](../../../ad-ds/plan/security-best-practices/Appendix-F--Securing-Domain-Admins-Groups-in-Active-Directory.md)群組，以及 [附錄 G：保護 Active Directory 中的系統管理員群組](../../../ad-ds/plan/security-best-practices/Appendix-G--Securing-Administrators-Groups-in-Active-Directory.md)。

在您執行這些設定中的任何一項之前，您也應該徹底測試所有的設定，以判斷它們是否適用于您的環境。 並非所有組織都能執行這些設定。

#### <a name="securing-built-in-administrator-accounts-in-active-directory"></a>在 Active Directory 中保護內建的系統管理員帳戶

在 Active Directory 的每個網域中，系統會在建立網域的過程中建立系統管理員帳戶。 此帳戶預設為網域中 Domain Admins 和 Administrator 群組的成員，如果網域是樹系根域，則帳戶也是 Enterprise Admins 群組的成員。 使用網域的本機系統管理員帳戶應該僅保留給初始的組建活動，以及可能的嚴重損壞修復案例。 若要確保內建的系統管理員帳戶可以在沒有其他帳戶可用的情況下用來生效修復，您不應該在樹系中的任何網域變更系統管理員帳戶的預設成員資格。 相反地，您應該遵循下列指導方針，以協助保護樹系中每個網域的系統管理員帳戶。 如需如何執行這些控制項的詳細指示，請見 [附錄 D：保護 Active Directory 中的 Built-In 系統管理員帳戶](../../../ad-ds/plan/security-best-practices/Appendix-D--Securing-Built-In-Administrator-Accounts-in-Active-Directory.md)。

#### <a name="controls-for-built-in-administrator-accounts"></a>內建系統管理員帳戶的控制項

執行此處所述設定的目標是要避免每個網域的系統管理員帳戶 (不是群組) 無法使用，除非有一些控制項反向。 藉由執行這些控制項並監視系統管理員帳戶的變更，您可以利用網域的系統管理員帳戶，大幅降低成功攻擊的可能性。 針對樹系中每個網域的系統管理員帳戶，您應該設定下列設定。

##### <a name="enable-the-account-is-sensitive-and-cannot-be-delegated-flag-on-the-account"></a>啟用帳戶上的「帳戶為機密，無法委派」旗標

根據預設，Active Directory 中的所有帳戶都可以委派。 委派可讓電腦或服務將已向電腦或服務驗證的帳號憑證，出示給其他電腦，以代表帳戶取得服務。 當您啟用 **帳戶為機密，而且無法** 在網域型帳戶上委派屬性時，該帳戶的認證將無法呈現給網路上的其他電腦或服務，這會限制利用委派在其他系統上使用帳號憑證的攻擊。

##### <a name="enable-the-smart-card-is-required-for-interactive-logon-flag-on-the-account"></a>啟用帳戶上的 [互動式登入需要智慧卡] 旗標

當您在帳戶上啟用 **互動式登入屬性所需的智慧卡** 時，Windows 會將帳戶的密碼重設為120個字元的隨機值。 藉由在內建的系統管理員帳戶上設定此旗標，您可以確保帳戶的密碼不只是長期且複雜，而且不知道任何使用者。 在技術上，您在啟用此屬性之前，不需要為帳戶建立智慧卡，但可能的話，您應該在設定帳戶限制之前為每個系統管理員帳戶建立智慧卡，而智慧卡應儲存在安全的位置。

雖然 **互動式登入旗標需要設定智慧卡** ，才能重設帳戶的密碼，但不會阻止具有重設帳戶密碼許可權的使用者將帳戶設定為已知的值，以及使用帳戶的名稱和新密碼來存取網路上的資源。 因此，您應該在帳戶上執行下列其他控制項。

##### <a name="configuring-gpos-to-restrict-domains-administrator-accounts-on-domain-joined-systems"></a>設定 Gpo 以限制 Domain-Joined 系統上的網域系統管理員帳戶

雖然停用網域中的系統管理員帳戶會使帳戶有效無法使用，但您應該在帳戶不小心或惡意啟用時，對帳戶執行其他限制。 雖然系統管理員帳戶最終可以反轉這些控制項，但目標是要建立讓攻擊者的進度變慢的控制項，並限制帳戶可能會造成的損害。

在您建立並連結到每個網域中的工作站和成員伺服器 Ou 的一或多個 Gpo 中，將每個網域的系統管理員帳戶新增至電腦設定 \windows 設定設定 \ 使用者權限 \ 使用者 **權力指派** 中的下列使用者權限：

- 拒絕從網路存取這部電腦
- 拒絕以批次工作登入
- 拒絕以服務方式登入
- 拒絕透過遠端桌面服務登入

> [!NOTE]
> 當您將本機系統管理員帳戶加入此設定時，您必須指定是否要設定本機系統管理員帳戶或網域系統管理員帳戶。 例如，若要將 NWTRADERS 網域的本機系統管理員帳戶新增到這些拒絕許可權，您必須將帳戶輸入為 **NWTRADERS\Administrator**，或流覽至 NWTRADERS 網域的本機系統管理員帳戶。 如果您在群組原則物件編輯器的這些使用者權限設定中輸入 **系統管理員** ，您將會限制套用 GPO 之每部電腦上的本機系統管理員帳戶。
>
> 建議您以網域系統管理員帳戶的相同方式，限制成員伺服器和工作站上的本機系統管理員帳戶。 因此，您通常應該將樹系中每個網域的系統管理員帳戶，以及本機電腦的系統管理員帳戶新增至這些使用者權限設定。

##### <a name="configuring-gpos-to-restrict-administrator-accounts-on-domain-controllers"></a>設定 Gpo 以限制網域控制站上的系統管理員帳戶

在樹系中的每個網域中，您應該修改預設網域控制站原則或連結至網域控制站 OU 的原則，以將每個網域的系統管理員帳戶新增至 **電腦設定 \windows 設定** 設定 \ 使用者設定 \ 使用者 \ 使用者權限指派中的下列使用者權限：

- 拒絕從網路存取這部電腦
- 拒絕以批次工作登入
- 拒絕以服務方式登入
- 拒絕透過遠端桌面服務登入

> [!NOTE]
> 這些設定可確保本機系統管理員帳戶無法用來連線到網域控制站，雖然帳戶（如果啟用的話）可以在本機登入網域控制站。 因為此帳戶應該只在嚴重損壞修復的情況下啟用及使用，所以會預期至少有一個網域控制站的實體存取可供使用，或者可以使用具有遠端存取網域控制站許可權的其他帳戶。

##### <a name="configure-auditing-of-built-in-administrator-accounts"></a>設定內建系統管理員帳戶的審核

當您保護每個網域的系統管理員帳戶並停用它時，您應該設定審核來監視帳戶的變更。 如果帳戶已啟用，則會重設其密碼，或對帳戶進行任何其他修改，警示應傳送給負責管理 AD DS 的使用者或小組，以及組織中的事件回應小組。

### <a name="securing-administrators-domain-admins-and-enterprise-admins-groups"></a>保護系統管理員、網域系統管理員和企業系統管理員群組

#### <a name="securing-enterprise-admin-groups"></a>保護企業系統管理員群組

位於樹系根域中的 Enterprise Admins 群組不應每天包含任何使用者，但網域的本機系統管理員帳戶如先前所述受到保護，如先前所述，以及 [附錄 D：保護 Active Directory 中的 Built-In 系統管理員](../../../ad-ds/plan/security-best-practices/Appendix-D--Securing-Built-In-Administrator-Accounts-in-Active-Directory.md)帳戶。

需要 EA 存取時，必須暫時將帳戶需要 EA 許可權和許可權的使用者放入 Enterprise Admins 群組中。 雖然使用者使用高度特殊許可權的帳戶，但他們的活動應該經過審核，而且最好是由一位使用者執行變更，而另一位使用者觀察變更，將不當誤用或設定錯誤的可能性降至最低。 當活動完成時，應該將帳戶從 EA 群組中移除。 這可以透過手動程式和記載的程式、協力廠商的特殊許可權身分識別/存取管理 (PIM/PAM) 軟體，或兩者的組合來達成。 建立可用來控制 Active Directory 中特殊許可權群組成員資格之帳戶的指導方針，會提供給 [認證遭竊的具吸引力帳戶](../../../ad-ds/plan/security-best-practices/Attractive-Accounts-for-Credential-Theft.md) ，以及 [附錄 I：為 Active Directory 中的受保護帳戶和群組建立管理帳戶](../../../ad-ds/manage/component-updates/Appendix-I--Creating-Management-Accounts-for-Protected-Accounts-and-Groups-in-Active-Directory.md)中提供詳細指示。

依預設，Enterprise Admins 是樹系中每個網域內內建 Administrators 群組的成員。 從每個網域中的系統管理員群組移除 Enterprise Admins 群組是不適當的修改，因為在發生樹系災難復原案例的情況下，可能會需要 EA 許可權。 如果已從樹系中的系統管理員群組移除 Enterprise Admins 群組，則應該將它新增至每個網域中的 Administrators 群組，並執行下列其他控制項：

- 如先前所述，Enterprise Admins 群組不應每天包含任何使用者，但樹系根域的系統管理員帳戶可能例外，應依照 [附錄 D：保護 Active Directory 中的 Built-In 系統管理員帳戶](../../../ad-ds/plan/security-best-practices/Appendix-D--Securing-Built-In-Administrator-Accounts-in-Active-Directory.md)所述加以保護。
- 在連結到包含成員伺服器和每個網域中工作站之 Ou 的 Gpo 中，應將 EA 群組新增至下列使用者權限：
   - 拒絕從網路存取這部電腦
   - 拒絕以批次工作登入
   - 拒絕以服務方式登入
   - 拒絕本機登入
   - 拒絕透過遠端桌面服務登入。

這可防止 EA 群組的成員登入成員伺服器和工作站。 如果使用跳躍伺服器來管理網域控制站和 Active Directory，請確定「跳躍伺服器」位於未連結限制 Gpo 的 OU 中。

- 如果對 EA 群組的屬性或成員資格進行任何修改，則應該將審核設定為傳送警示。 這些警示至少應該傳送給負責 Active Directory 管理和事件回應的使用者或小組。 您也應該定義暫時填入 EA 群組的程式和程式，包括執行群組合法擴展時的通知程式。

#### <a name="securing-domain-admins-groups"></a>保護 Domain Admins 群組

就像 Enterprise Admins 群組一樣，Domain Admins 群組中的成員資格只在建立或災難復原案例中才需要。 如果網域中的本機系統管理員帳戶受到保護，則 DA 群組中應該沒有任何日常的使用者帳戶（網域的本機系統管理員帳戶除外），如 [附錄 D：保護 Built-In 系統管理員帳戶 Active Directory 中](../../../ad-ds/plan/security-best-practices/Appendix-D--Securing-Built-In-Administrator-Accounts-in-Active-Directory.md)所述。

需要 DA 存取時，必須暫時將需要此存取層級的帳戶放到有問題之網域的 DA 群組中。 雖然使用者使用高度特殊許可權的帳戶，但活動應該經過審核，而且最好是由一位使用者執行變更，而另一位使用者觀察變更，將不當誤用或不當設定的可能性降至最低。 當活動完成時，應該從 Domain Admins 群組移除這些帳戶。 這可以透過手動程式和記載的程式，透過協力廠商的特殊許可權身分識別/存取管理 (PIM/PAM) 軟體，或兩者的組合來達成。 [附錄 I：在 Active Directory 中為受保護的帳戶和群組建立管理帳戶](../../../ad-ds/manage/component-updates/../../../ad-ds/manage/component-updates/Appendix-I--Creating-Management-Accounts-for-Protected-Accounts-and-Groups-in-Active-Directory.md)，可用於建立可用來控制 Active Directory 中特殊許可權群組成員資格之帳戶的指導方針。

根據預設，網域系統管理員會在其個別網域中的所有成員伺服器和工作站上，擁有本機系統管理員群組的成員。 此預設的嵌套不應該修改，因為它會影響可支援性和嚴重損壞修復選項。 如果已從成員伺服器上的本機系統管理員群組中移除 Domain Admins 群組，則應該透過連結 Gpo 中受限制的群組設定，將這些群組新增至每個成員伺服器和網域中的工作站上的 [Administrators] 群組。 下列一般控制項（如 [附錄 F：保護 Active Directory 中的 Domain Admins 群組](../../../ad-ds/plan/security-best-practices/Appendix-F--Securing-Domain-Admins-Groups-in-Active-Directory.md) ）也應該執行。

針對樹系中每個網域的 Domain Admins 群組：

1. 移除 DA 群組中的所有成員，但網域的內建系統管理員帳戶可能除外，但前提是已依照 [附錄 D：保護 Built-In 系統管理員帳戶 Active Directory 中](../../../ad-ds/plan/security-best-practices/Appendix-D--Securing-Built-In-Administrator-Accounts-in-Active-Directory.md)所述的方式加以保護。
2. 在連結到包含成員伺服器和每個網域中工作站之 Ou 的 Gpo 中，應將 DA 群組新增至下列使用者權限：
   - 拒絕從網路存取這部電腦
   - 拒絕以批次工作登入
   - 拒絕以服務方式登入
   - 拒絕本機登入
   - 拒絕透過遠端桌面服務登入

   這會讓 DA 群組的成員無法登入成員伺服器和工作站。 如果使用跳躍伺服器來管理網域控制站和 Active Directory，請確定「跳躍伺服器」位於未連結限制 Gpo 的 OU 中。

3. 如果對 DA 群組的屬性或成員資格進行任何修改，則應該將審核設定為傳送警示。 這些警示至少應該傳送給負責 AD DS 管理和事件回應的使用者或小組。 您也應該定義暫時填入 DA 群組的程式和程式，包括執行群組合法擴展時的通知程式。

#### <a name="securing-administrators-groups-in-active-directory"></a>保護 Active Directory 中的 Administrators 群組

就像 EA 和 DA 群組一樣，系統管理員 (BA) 群組中的成員資格，只有在建立或嚴重損壞修復案例中才需要用到。 除了網域的本機系統管理員帳戶（如 [附錄 D：保護 Active Directory 中的 Built-In 系統管理員](../../../ad-ds/plan/security-best-practices/Appendix-D--Securing-Built-In-Administrator-Accounts-in-Active-Directory.md)帳戶）所述，系統管理員群組中應該沒有任何日常使用者帳戶，但網域的本機系統管理員帳戶除外。

需要系統管理員存取權時，必須暫時將需要此存取層級的帳戶放到有問題之網域的 Administrators 群組中。 雖然使用者使用高度特殊許可權的帳戶，但活動應該經過審核，而且最好是透過執行變更的使用者，以及另一位觀察變更的使用者來執行，以將不當誤用或設定錯誤的可能性降至最低。 當活動完成時，應該立即從 Administrators 群組中移除帳戶。 這可以透過手動程式和記載的程式，透過協力廠商的特殊許可權身分識別/存取管理 (PIM/PAM) 軟體，或兩者的組合來達成。

依預設，系統管理員會在其各自的網域中擁有大多數 AD DS 物件的擁有者。 需要擁有權或取得物件擁有權之能力的組建和嚴重損壞修復案例中，可能需要此群組的成員資格。 此外，DAs 和 EAs 透過其 Administrators 群組中的預設成員資格，繼承了許多權利和許可權。 Active Directory 中的特殊許可權群組的預設群組嵌套不應該修改，而且每個網域的系統管理員群組都應受到保護，如 [附錄 G：保護系統管理員群組中的 Active Directory](../../../ad-ds/plan/security-best-practices/Appendix-G--Securing-Administrators-Groups-in-Active-Directory.md)，以及下列一般指示中所述。

1. 移除 Administrators 群組中的所有成員，但不包括網域的本機系統管理員帳戶，但前提是已依照 [附錄 D：保護 Built-In 系統管理員帳戶 Active Directory 中](../../../ad-ds/plan/security-best-practices/Appendix-D--Securing-Built-In-Administrator-Accounts-in-Active-Directory.md)所述的方式進行保護。
2. 網域的 Administrators 群組成員永遠不需要登入成員伺服器或工作站。 在每個網域中連結至工作站和成員伺服器 Ou 的一或多個 Gpo 中，系統管理員群組應新增至下列使用者權限：
   - 拒絕從網路存取這部電腦
   - 拒絕以批次工作登入，
   - 拒絕以服務方式登入
   - 這會讓系統管理員群組的成員無法用來登入或連接到成員伺服器或工作站 (除非第一次) 違反了多個控制，否則他們的認證可能會被快取並因而遭入侵。 您絕對不能使用特殊許可權帳戶來登入較不具許可權的系統，並強制執行這些控制項來防範一些攻擊。

3. 在樹系中每個網域的網域控制站 OU 上，系統管理員群組應獲得下列使用者權限 (如果他們還沒有) 這些許可權，這將可讓 Administrators 群組的成員執行整個樹系嚴重損壞修復案例所需的功能：
   - 從網路存取這台電腦
   - 允許本機登入
   - 允許透過遠端桌面服務登入

4. 如果對系統管理員群組的屬性或成員資格進行任何修改，則應該將審核設定為傳送警示。 這些警示至少應該傳送給負責 AD DS 管理的團隊成員。 警示也應該傳送給安全性小組的成員，而且應該定義這些程式來修改系統管理員群組的成員資格。 具體來說，這些程式應該包含安全性小組在系統管理員群組即將進行修改時通知的程式，以便在傳送警示時收到警示，而不會引發警示。 此外，當已完成使用 Administrators 群組，且已從群組中移除使用的帳戶時，也會通知安全性小組的程式。

> [!NOTE]
> 當您在 Gpo 的 Administrators 群組上執行限制時，除了網域的 Administrators 群組之外，Windows 也會將設定套用至電腦本機系統管理員群組的成員。 因此，在系統管理員群組上執行限制時，應謹慎使用。 雖然允許系統管理員群組成員的批次和服務登入可以在任何地方執行，但請不要透過遠端桌面服務限制本機登入或登入。 封鎖這些登入類型可能會封鎖本機系統管理員群組成員的電腦合法管理。 下列螢幕擷取畫面顯示的設定會封鎖內建本機和網域系統管理員帳戶的誤用，以及誤用內建的本機或網域系統管理員群組。 請注意，[ **拒絕登入遠端桌面服務** ] 使用者權限不包含 [系統管理員] 群組，因為在這項設定中包含此群組，也會針對屬於本機電腦的 Administrators 群組成員的帳戶封鎖這些登入。 如果電腦上的服務設定為在本節所述的任何特殊許可權群組內容中執行，則執行這些設定可能會導致服務和應用程式失敗。 因此，與本節中的所有建議相同，您應該在您的環境中徹底測試適用性的設定。
>
> ![最低版權管理模型](media/Implementing-Least-Privilege-Administrative-Models/SAD_3.gif)

### <a name="role-based-access-controls-rbac-for-active-directory"></a>Role-Based 存取控制 (RBAC) 以進行 Active Directory

一般來說，以角色為基礎的存取控制 (RBAC) 是一種機制，可將使用者分組，並根據商務規則來提供資源的存取權。 在 Active Directory 的情況下，執行 AD DS 的 RBAC 是建立角色的程式，以委派許可權，讓角色的成員可以執行日常的系統管理工作，而不需授與許可權過高的許可權。 您可以透過原生工具和介面來設計和實行 Active Directory 的 RBAC，方法是利用您可能已擁有的軟體、購買協力廠商產品，或這些方法的任何組合。 本節不提供針對 Active Directory 執行 RBAC 的逐步指示，而是會討論在您的 AD DS 安裝中選擇執行 RBAC 的方法時，應考慮的因素。

#### <a name="native-approaches-to-rbac-for-active-directory"></a>Active Directory 的 RBAC 原生方法

在最簡單的 RBAC 執行中，您可以將角色作為 AD DS 群組來執行，並將許可權和許可權委派給群組，讓他們能夠在指定的角色範圍內執行每日管理。

在某些情況下，Active Directory 中的現有安全性群組可以用來授與適合工作函式的許可權和許可權。 例如，如果您的 IT 組織中的特定員工負責管理和維護 DNS 區域和記錄，委派這些責任就像為每個 DNS 系統管理員建立帳戶，然後將它新增至 Active Directory 的 DNS Admins 群組一樣簡單。 與更高許可權的群組不同的 DNS Admins 群組，在 Active Directory 之間有幾項強大的許可權，雖然此群組的成員已委派許可權，可讓他們管理 DNS，但仍有可能遭到入侵，而濫用可能會導致權限提高。

在其他情況下，您可能需要建立安全性群組和委派許可權，以 Active Directory 物件、檔案系統物件和登錄物件，讓群組的成員可以執行指定的系統管理工作。 例如，如果您的服務台操作員負責重設遺忘的密碼、協助使用者有連線問題，以及疑難排解應用程式設定，您可能需要將 Active Directory 中的使用者物件委派設定，與可讓服務台使用者遠端連線到使用者電腦的許可權，以查看或修改使用者的設定。 針對您定義的每個角色，您應該識別：

1. 角色成員每天會執行哪些工作，以及較不常執行的工作。
2. 在哪些系統和角色的應用程式成員應被授與許可權。
3. 哪些使用者應被授與角色的成員資格。
4. 將如何執行角色成員資格的管理。

在許多環境中，手動建立以角色為基礎的存取控制來管理 Active Directory 環境，可能是執行和維護的挑戰。 如果您明確定義了管理 IT 基礎結構的角色和責任，您可能會想要利用其他工具來協助您建立可管理的原生 RBAC 部署。 例如，如果您的環境中正在使用 Forefront Identity Manager (FIM) ，您可以使用 FIM 將系統管理角色的建立和擴展自動化，進而簡化進行中的系統管理。 如果您使用 Microsoft Endpoint Configuration Manager 並 System Center Operations Manager (SCOM) ，您可以使用應用程式專屬角色來委派管理和監視功能，同時在網域中跨系統強制執行一致的設定和審核。 如果您已將公開金鑰基礎結構 (PKI) ，您可以針對負責管理環境的 IT 人員發出和要求智慧卡。 使用 FIM Credential Management (FIM CM) ，您甚至可以為系統管理人員合併角色和認證的管理。

在其他情況下，組織最好考慮部署提供「現成可用」功能的協力廠商 RBAC 軟體。 適用于 Active Directory、Windows、非 Windows 目錄和作業系統的商業、現成 (COTS) 解決方案，由許多廠商提供。 在原生方案和協力廠商產品之間進行選擇時，您應該考慮下列因素：

1. 預算：藉由使用您可能已擁有的軟體和工具投資開發 RBAC，您可以減少部署解決方案所需的軟體成本。 不過，除非您的員工有權建立及部署原生 RBAC 解決方案，否則您可能需要參與諮詢資源以開發您的解決方案。 您應該仔細地衡量自訂開發解決方案的預期成本，以及部署「現成」解決方案的成本，特別是當您的預算有限時。
2. IT 環境的組成：如果您的環境主要是由 Windows 系統所組成，或者您已經利用 Active Directory 管理非 Windows 系統和帳戶，則自訂原生解決方案可能會為您的需求提供最佳解決方案。 如果您的基礎結構包含許多未執行 Windows 且未受 Active Directory 管理的系統，您可能需要考慮與 Active Directory 環境分開管理非 Windows 系統的選項。
3. 解決方案中的許可權模型：如果產品依賴將其服務帳戶放置在 Active Directory 中的高許可權群組中，而且未提供任何不需要將過多許可權授與 RBAC 軟體的選項，您就不會真的降低 Active Directory 攻擊面，只會變更目錄中最具特殊許可權的群組組合。 除非應用程式廠商可以提供服務帳戶的控制項，以便將遭盜用的帳戶機率降到最低且惡意使用，否則您可能會想要考慮其他選項。

### <a name="privileged-identity-management"></a>Privileged Identity Management

特殊許可權身分識別管理 (PIM) ，有時也稱為特殊許可權帳戶管理 (PAM) 或特殊許可權的認證管理 (PCM) 是在您的基礎結構中管理特殊許可權帳戶的設計、結構和實行方法。 一般來說，PIM 提供的機制可讓帳戶獲得執行組建或中斷修正功能所需的暫時許可權和許可權，而不是讓許可權永久附加到帳戶。 無論是手動建立 PIM 功能，還是透過部署協力廠商軟體來執行，都可以使用下列一或多個功能：

- 認證「保存庫」，其中特殊許可權帳戶的密碼會「簽出」並指派初始密碼，然後在活動完成時「簽入」，也就是在帳戶上重設密碼的時間。
- 使用特殊許可權認證的時間限制限制
- 單次使用認證
- 工作流程產生的許可權授與監視和報告執行的活動，以及在活動完成或配置的時間已到期時自動移除許可權
- 以應用程式設計介面取代腳本中的硬式編碼認證，例如使用者名稱和密碼 (Api) ，可讓您視需要從保存庫取出認證
- 自動管理服務帳戶認證

### <a name="creating-unprivileged-accounts-to-manage-privileged-accounts"></a>建立無特殊許可權帳戶來管理特殊許可權帳戶

管理特殊許可權帳戶的其中一項挑戰是，根據預設，可以管理具有特殊許可權的帳戶和受保護的帳戶和群組，都是具有特殊許可權的帳戶和受保護的帳戶。 如果您針對 Active Directory 安裝執行適當的 RBAC 和 PIM 解決方案，解決方案可能會包含可讓您有效 depopulate 目錄中最具特殊許可權之群組成員資格的方法，只會暫時以及需要時才填入群組。

但是，如果您執行的是原生 RBAC 和 PIM，您應該考慮建立沒有許可權的帳戶，並在需要時，使用在 Active Directory 填入和 depopulating 特殊許可權群組的唯一功能。 [附錄 I：在 Active Directory 中建立受保護帳戶和群組的管理帳戶](../../../ad-ds/manage/component-updates/../../../ad-ds/manage/component-updates/Appendix-I--Creating-Management-Accounts-for-Protected-Accounts-and-Groups-in-Active-Directory.md) 會提供逐步指示，可讓您用來建立帳戶以供此用途。

### <a name="implementing-robust-authentication-controls"></a>執行健全的驗證控制項

*定律6：真的有人試圖猜測您的密碼。* - [安全性管理的10個不可變法則](/previous-versions/cc722488(v=technet.10))

傳遞雜湊和其他認證竊取攻擊並非專門針對 Windows 作業系統，也不是新的。 第一次傳遞雜湊攻擊是在1997中建立。 不過，在過去，這些攻擊需要自訂的工具、在其成功時遇到或遺漏，而且需要的攻擊者必須有相當高的技能。 引進可自由使用、容易使用的工具，以原生方式解壓縮認證，讓認證遭竊攻擊的數量和成功在最近幾年獲得了指數的增加。 不過，認證竊取攻擊並不是指認證鎖定的唯一機制。

雖然您應該執行控制項來協助保護您免于認證遭竊的攻擊，但您也應該識別環境中最有可能成為攻擊者目標的帳戶，並針對這些帳戶執行健全的驗證控制。 如果您最具特殊許可權的帳戶使用單一要素驗證，例如使用者名稱和密碼 (這兩個都是「您知道的東西」，這是) 的一個驗證因素，這些帳戶會受到弱式保護。 攻擊者只需要知道使用者名稱以及與帳戶相關聯之密碼的知識，就不需要傳遞雜湊攻擊，攻擊者就能以使用者身分向任何接受單一要素認證的系統進行驗證。

雖然實行多重要素驗證並不會保護您免于傳遞雜湊攻擊，但是將多重要素驗證與受保護的系統結合在一起也可以。 有關實施受保護系統的詳細資訊，可在 [執行安全的系統管理主機](../../../ad-ds/plan/security-best-practices/Implementing-Secure-Administrative-Hosts.md)中取得，而驗證選項則會在下列各節中討論。

#### <a name="general-authentication-controls"></a>一般驗證控制項

如果您尚未執行多重要素驗證（例如智慧卡），請考慮這樣做。 智慧卡會在公開/私密金鑰組中執行硬體強制的私密金鑰保護，防止使用者的私密金鑰遭到存取或使用，除非使用者將適當的 PIN、密碼或生物識別識別碼提供給智慧卡。 即使遭入侵的電腦上的擊鍵記錄器攔截到使用者的 PIN 或密碼，攻擊者也必須在實際的情況下使用該 PIN 碼或密碼。

在很長的複雜密碼已證明因為使用者阻力而難以實行的情況下，智慧卡提供了一種機制，讓使用者可以執行相當簡單的 Pin 或密碼，而不會有認證受到暴力密碼破解或彩虹資料表攻擊的影響。 智慧卡的 Pin 不會儲存在 Active Directory 或本機 SAM 資料庫中，不過認證雜湊可能仍會儲存在已用來進行驗證之智慧卡的電腦上的 LSASS 保護記憶體中。

#### <a name="additional-controls-for-vip-accounts"></a>VIP 帳戶的其他控制項

執行智慧卡或其他以憑證為基礎的驗證機制還有另一個優點，就是能夠利用驗證機制保證來保護 VIP 使用者可存取的機密資料。 驗證機制保證適用于功能等級設定為 Windows Server 2012 或 Windows Server 2008 R2 的網域。 啟用時，當使用者的認證在使用以憑證為基礎的登入方法登入期間進行驗證時，驗證機制保證會將系統管理員指定的全域群組成員資格新增至使用者的 Kerberos 權杖。

如此一來，資源管理員就可以根據使用者是否使用憑證型登入方法登入，以及使用的憑證類型，來控制對資源的存取，例如檔案、資料夾和印表機。 例如，當使用者使用智慧卡登入時，使用者對網路上資源的存取權，可以指定為與使用者未使用智慧卡時的存取權不同， (也就是使用者在登入時輸入使用者名稱和密碼) 。 如需有關驗證機制保證的詳細資訊，請參閱《 [Windows Server 2008 R2 中的驗證機制 AD DS 保證》逐步指南](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/dd378897(v=ws.10))。

#### <a name="configuring-privileged-account-authentication"></a>設定特殊許可權帳戶驗證

在適用于所有系統管理帳戶的 Active Directory 中，啟用 [ **互動式登入的要求智慧卡** ] 屬性，並將 (的變更，以最小) 的方式進行審核，帳戶的 [ **帳戶** ] 索引標籤上的任何屬性 (例如 Cn、Name、SAMAccountName、userPrincipalName 和 userAccountControl) 系統管理使用者物件。

雖然將帳戶的密碼重設為「 **互動式登入的要求智慧卡** 」會將帳戶的密碼重設為120個字元的隨機值，並要求互動式登入需要智慧卡，但使用者仍然可以覆寫該屬性，其許可權是允許他們變更帳戶的密碼，而帳戶則可以用來建立僅具有使用者名稱和密碼的非互動式登入。

在其他情況下，根據 Active Directory 憑證服務 (AD CS) 或協力廠商 PKI 的 Active Directory 和憑證設定中的帳戶設定，系統管理或 VIP 帳戶的使用者主體名稱 (UPN) 屬性可針對特定類型的攻擊進行設定，如下所述。

##### <a name="upn-hijacking-for-certificate-spoofing"></a>用於憑證詐騙的 UPN 劫持

雖然對公開金鑰基礎結構的攻擊 (Pki) 不在本檔的討論範圍內，但對公開和私用 Pki 的攻擊在2008之後會以指數方式增加。 公開 Pki 的漏洞已廣泛地公開，但對組織內部 PKI 的攻擊可能更豐富。 其中一種攻擊會利用 Active Directory 和憑證，讓攻擊者以可能難以偵測的方式來偽造其他帳戶的認證。

出示憑證來向加入網域的系統進行驗證時，憑證中的主體或主體別名 (SAN) 屬性會用來將憑證對應至 Active Directory 中的使用者物件。 根據憑證的類型和其建立方式而定，憑證中的 Subject 屬性通常會包含使用者的一般名稱 (CN) ，如下列螢幕擷取畫面所示。

![顯示憑證中主旨屬性的螢幕擷取畫面，通常包含使用者的一般名稱。](media/Implementing-Least-Privilege-Administrative-Models/SAD_4.gif)

根據預設，Active Directory 會串連帳戶的名字 + "" + last name，以建立使用者的 CN。 不過，Active Directory 中的使用者物件的 CN 元件並非必要或不保證是唯一的，且將使用者帳戶移至目錄中的不同位置，會將帳戶的辨別)  (名稱變更為目錄中的不同位置，也就是目錄中物件的完整路徑，如先前的螢幕擷取畫面底部窗格所示。

由於憑證主體名稱不保證是靜態或唯一的，主體別名的內容通常會用來在 Active Directory 中尋找使用者物件。 從企業憑證授權單位單位發行給使用者之憑證的 SAN 屬性 (Active Directory 整合式 Ca) 通常包含使用者的 UPN 或電子郵件地址。 因為 upn 在 AD DS 樹系中保證是唯一的，所以透過 UPN 來尋找使用者物件通常會在驗證過程中執行，而不論是否有與驗證程式相關的憑證。

攻擊者可以利用驗證憑證中 SAN 屬性的 Upn 來取得詐騙憑證。 如果攻擊者入侵的帳戶能夠在使用者物件上讀取和寫入 Upn，則會以下列方式執行攻擊：

使用者物件上的 UPN 屬性 (例如 VIP 使用者) 會暫時變更為不同的值。 SAM 帳戶名稱屬性和 CN 現在也可以變更，但這通常不是必要的，因為這是稍早所述的原因。

當目標帳戶上的 UPN 屬性變更時，已過時、已啟用的使用者帳戶或最近建立的使用者帳戶的 UPN 屬性會變更為原先指派給目標帳戶的值。 過時的已啟用使用者帳戶是指長時間未登入，但尚未停用的帳戶。 這些攻擊者的目標是想要「隱藏在看不見」的攻擊者，原因如下：

1. 因為帳戶已啟用，但最近尚未使用過，所以使用帳戶不太可能會以啟用已停用使用者帳戶的方式觸發警示。
2. 使用現有的帳戶時，不需要建立系統管理人員可能注意到的新使用者帳戶。
3. 仍啟用的過時使用者帳戶通常是各種安全性群組的成員，而且會被授與存取網路上資源的許可權，以簡化存取並將其與現有的使用者人口「混合」。

現在已設定目標 UPN 的使用者帳戶，可用來向 Active Directory 憑證服務要求一或多個憑證。

針對攻擊者的帳戶取得憑證時，「新增」帳戶和目標帳戶上的 Upn 會傳回其原始值。

攻擊者現在有一或多個憑證，可向資源和應用程式進行驗證，就像使用者是帳戶暫時修改的 VIP 使用者一樣。 雖然攻擊者可以將憑證和 PKI 設為目標的所有方法的完整討論不在本檔的討論範圍內，但這種攻擊機制的目的在於說明您應該在 AD DS 中監視特殊許可權和 VIP 帳戶的變更，特別是在 (帳戶的 [ **帳戶** ] 索引標籤上的任何屬性變更（例如 cn、Name、SAMAccountName、UserPrincipalName 和 userAccountControl) ）。 除了監視帳戶之外，您也應該限制誰可以盡可能將帳戶修改為一組較小的系統管理使用者。 同樣地，應該保護和監視系統管理使用者的帳戶，以防止未經授權的變更。
