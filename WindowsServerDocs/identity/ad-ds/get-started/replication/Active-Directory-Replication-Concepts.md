---
ms.assetid: 4cc9c16c-1928-4dce-a3a8-6229be28eb65
title: Active Directory 複寫概念
author: iainfoulds
ms.author: daveba
manager: daveba
ms.date: 05/31/2017
ms.topic: article
ms.openlocfilehash: 6acd9d1974395cdd4c07df3b09d47ffb104a16ef
ms.sourcegitcommit: b115e5edc545571b6ff4f42082cc3ed965815ea4
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/30/2020
ms.locfileid: "93070990"
---
# <a name="active-directory-replication-concepts"></a>Active Directory 複寫概念

>適用於：Windows Server 2016、Windows Server 2012 R2、Windows Server 2012

在設計網站拓撲之前，請先熟悉某些 Active Directory 複寫概念。

-   [Connection 物件](#BKMK_1)

-   [KCC](#BKMK_2)

-   [容錯移轉功能](#BKMK_3)

-   [子網路](#BKMK_4)

-   [站台](#BKMK_5)

-   [站台連結](#BKMK_6)

-   [站台連結橋](#BKMK_7)

-   [站台連結傳遞](#BKMK_8)

-   [通用類別目錄伺服器](#BKMK_9)

-   [萬用群組成員資格快取](#BKMK_10)

## <a name="connection-object"></a><a name="BKMK_1"></a>Connection 物件
Connection 物件是 Active Directory 物件，代表從來源網域控制站到目的地網域控制站的複寫連接。 網域控制站是單一網站的成員，而且是由 Active Directory Domain Services (AD DS) 中的伺服器物件在網站中表示。 每個伺服器物件都有子 NTDS 設定物件，代表網站中的複寫網域控制站。

連線物件是目的地伺服器上 NTDS 設定物件的子系。 若要在兩個網域控制站之間進行複寫，其中一個網域控制站的伺服器物件必須有一個連線物件，代表來自另一個的輸入複寫。 網域控制站的所有複寫連接都會儲存為 NTDS 設定物件下的連線物件。 Connection 物件會識別複寫來源伺服器、包含複寫排程，並指定複寫傳輸。

知識一致性檢查程式 (KCC) 會自動建立連線物件，但也可以手動建立。 由 KCC 建立的連線物件會顯示在 Active Directory 的 [網站和服務] 嵌入式管理單元中 **<automatically generated>** ，並在正常操作的情況下視為適當的。 系統管理員建立的連線物件是手動建立的連線物件。 手動建立的連線物件是由系統管理員在建立時指派的名稱來識別。 當您修改 **<automatically generated>** 連線物件時，會將它轉換成系統管理員修改的連線物件，而物件會以 GUID 的形式出現。 KCC 不會變更手動或修改的連線物件。

## <a name="kcc"></a><a name="BKMK_2"></a>KCC
KCC 是在所有網域控制站上執行的內建程式，會為 Active Directory 樹系產生複寫拓撲。 KCC 會根據複寫是否發生在網站 (網站內部) 或 (站間) 的網站之間，建立個別的複寫拓撲。 KCC 也會動態調整拓撲，以納入新的網域控制站、移除現有的網域控制站、將網域控制站移入和移出網站、變更成本和排程，以及暫時無法使用或處於錯誤狀態的網域控制站。

在網站內，可寫入網域控制站之間的連線一律會以雙向環形排列，並提供額外的快捷方式連線來減少大型網站的延遲。 另一方面，站上拓撲是跨越樹系的分層，這表示每個目錄分割的兩個網站之間有一個站對站連線，而且通常不包含快捷方式連接。 如需跨越樹狀結構和 Active Directory 複寫拓撲的詳細資訊，請參閱 Active Directory 複寫拓撲技術參考 ([https://go.microsoft.com/fwlink/?LinkID=93578](https://go.microsoft.com/fwlink/?LinkID=93578)) 。

在每個網域控制站上，KCC 建立複寫路由的方式是建立單向輸入連線物件，以定義來自其他網域控制站的連線。 針對相同網站中的網域控制站，KCC 會自動建立連線物件，而不需要系統管理介入。 當您有一個以上的網站時，您可以設定網站之間的站台連結，而每個網站中的單一 KCC 也會自動在網站間建立連線。

### <a name="kcc-improvements-for-windows-server-2008-rodcs"></a>Windows Server 2008 Rodc 的 KCC 改進

有一些 KCC 改良功能，可在 Windows Server 2008 (RODC) 中容納新可用的唯讀網域控制站。 RODC 的典型部署案例是分公司。 此案例中最常部署的 Active Directory 複寫拓撲是以中樞和輪輻設計為基礎，其中多個網站中的分支網域控制站會以中樞網站中少數的橋頭伺服器進行複寫。

在此案例中部署 RODC 的其中一個優點是單向複寫。 不需要從 RODC 複寫橋頭伺服器，以減少系統管理和網路使用量。

不過，在舊版 Windows Server 作業系統上，中樞輪輻拓撲醒目提示的一個管理挑戰是，在中樞新增新的橋頭網域控制站之後，沒有自動機制可在分公司網域控制站與中樞網域控制站之間重新發佈複寫連線，以利用新的中樞網域控制站。

若為 Windows Server 2003 網域控制站，您可以使用 Windows Server 2003 分公司部署指南中的 Adlb.exe 工具， () 來重新平衡工作負載 [https://go.microsoft.com/fwlink/?LinkID=28523](https://go.microsoft.com/fwlink/?LinkID=28523) 。

針對 Windows Server 2008 Rodc，KCC 的正常運作會提供一些重新平衡，讓您不必使用其他工具（例如 Adlb.exe）。 預設會啟用新的功能。 您可以藉由在 RODC 上新增下列登錄機碼來停用它：

**HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\NTDS\Parameters**

「 **允許** 
 隨機 BH 負載平衡」 **1 = 已啟用 (預設) ，0 = 停用**

如需這些 KCC 改進功能的詳細資訊，請參閱規劃和部署分公司的 Active Directory Domain Services ([https://go.microsoft.com/fwlink/?LinkId=107114](https://go.microsoft.com/fwlink/?LinkId=107114)) 。

## <a name="failover-functionality"></a><a name="BKMK_3"></a>容錯移轉功能
網站可確保複寫會在網路失敗和離線網域控制站周圍路由傳送。 KCC 會依照指定的間隔執行，以針對 AD DS 中發生的變更調整複寫拓撲，例如新增新的網域控制站和建立新的網站時。 KCC 會審核現有連線的複寫狀態，以判斷是否有任何連接無法運作。 如果連接因為網域控制站失敗而無法運作，則 KCC 會自動建立與其他複寫協力電腦的暫時連線 (如果有的話) 可確保發生複寫。 如果網站中的所有網域控制站都無法使用，則 KCC 會自動從另一個網站的網域控制站之間建立複寫連接。

## <a name="subnet"></a><a name="BKMK_4"></a>子
子網是一種 TCP/IP 網路區段，其中會指派一組邏輯 IP 位址。 子網群組電腦的方式，會識別其在網路上的實體鄰近性。 AD DS 中的子網物件會識別用來將電腦對應至網站的網路位址。

## <a name="site"></a><a name="BKMK_5"></a>網站
網站是 Active Directory 物件，代表一或多個具有高度可靠且快速的網路連線的 TCP/IP 子網。 網站資訊可讓系統管理員設定 Active Directory 存取和複寫，以優化實體網路的使用。 網站物件與一組子網相關聯，且樹系中的每個網域控制站都會根據其 IP 位址與 Active Directory 網站相關聯。 網站可以裝載來自多個網域的網域控制站，而網域可以在一個以上的網站中表示。

## <a name="site-link"></a><a name="BKMK_6"></a>站台連結
站台連結是 Active Directory 的物件，代表 KCC 用來建立 Active Directory 複寫連接的邏輯路徑。 站台連結物件代表一組網站，可透過指定的站上傳輸以統一的成本進行通訊。

站台連結中包含的所有網站都會被視為透過相同的網路類型來連線。 網站必須以手動方式連結至其他網站，方法是使用站台連結，讓一個網站中的網域控制站可以從另一個網站中的網域控制站複寫目錄變更。 因為站台連結不會對應到在複寫期間于實體網路上的網路封包所採用的實際路徑，所以您不需要建立重複的站台連結來改善 Active Directory 複寫效率。

當有兩個網站透過站台連結連線時，複寫系統會自動在每個名為「橋頭伺服器」的網站中建立特定網域控制站之間的連接。 在 Windows Server 2008 中，裝載相同目錄分割的網站中的所有網域控制站都是選取為橋頭伺服器的候選項目。 由 KCC 建立的複寫連線會在網站中的所有候選橋頭伺服器之間隨機散發，以共用複寫工作負載。 依預設，只有在將連線物件第一次新增至網站時，隨機選取程式才會發生一次。

## <a name="site-link-bridge"></a><a name="BKMK_7"></a>站台連結橋
站台連結橋接器是一種 Active Directory 物件，代表一組站台連結，所有網站都可以使用一般傳輸進行通訊。 站台連結橋能讓未直接透過通訊連結連接的網域控制站進行複寫。 一般而言，站台連結橋接器會對應到路由器 (或 IP 網路上) 的一組路由器。

根據預設，KCC 可以透過任何具有共通網站的所有站台連結，形成可轉移的路由。 如果停用此行為，則每個站台連結都代表它自己的相異和隔離網路。 可視為單一路由的站台連結集是透過站台連結橋接器來表示。 每個橋接器都代表網路流量的隔離通訊環境。

站台連結橋接器是一種機制，用來以邏輯方式表示網站之間的可轉移實體連接。 站台連結橋能讓 KCC 使用包含的網站連結的任何組合，來判斷在這些網站中保存的目錄分割之最便宜的路由。 站台連結橋未提供與網域控制站的實際連線。 如果已移除站台連結橋接器，則透過合併的站台連結的複寫將會繼續進行，直到 KCC 移除連結為止。

只有在網站包含裝載目錄分割的網域控制站，而該目錄分割也不是裝載在相鄰網站的網域控制站上，但裝載該目錄分割的網域控制站位於樹系中的一或多個其他網站時，才需要網站連結橋接器。 連續的網站會定義為單一站台連結中包含的任何兩個或多個網站。

站台連結橋會建立兩個站台連結之間的邏輯連線，在兩個已中斷連線的網站之間，使用暫時網站提供可轉移的路徑。 針對 (ISTG) 的站上拓撲產生器用途，橋接器會使用暫時網站來表示實體連線能力。 橋接器不表示暫時網站中的網域控制站會提供複寫路徑。 但是，如果暫時網站包含的網域控制站裝載要複寫的目錄分割，就會發生這種情況，在這種情況下，不需要站台連結橋。

新增每個站台連結的成本，為產生的路徑建立總成本。 如果暫時網站不包含裝載目錄分割的網域控制站，且成本較低的連結不存在，就會使用站台連結橋。 如果過渡期網站包含裝載目錄分割的網域控制站，兩個已中斷連線的網站會設定過渡網域控制站的複寫連線，而不會使用橋接器。

## <a name="site-link-transitivity"></a><a name="BKMK_8"></a>站台連結傳遞
根據預設，所有站台連結都是可轉移的或「橋接」。 當站台連結已橋接且排程重迭時，KCC 會建立複寫連線，以決定網站之間的網域控制站複寫協力電腦，而網站連結不會直接連線到網站，而是透過一組通用網站來進行可傳遞。 這表示您可以透過站台連結的組合，將任何網站連接至任何其他網站。

一般情況下，如果您想要控制複寫變更的流程，則在完全路由的網路上，您不需要建立任何站台連結橋。 如果您的網路未完全路由，則應該建立站台連結橋，以避免不可能的複寫嘗試。 特定傳輸的所有站台連結都會隱含地屬於該傳輸的單一站台連結橋。 站台連結的預設橋接會自動發生，而且沒有 Active Directory 物件代表該橋接器。 [ **橋接器所有站台連結** ] 設定（位於 IP 和 Simple Mail 傳送通訊協定的內容中） (SMTP) 站間傳輸容器的屬性，可執行自動站台連結橋接。

> [!NOTE]
> 未來的 AD DS 版本將不再支援 SMTP 複寫;因此，不建議在 SMTP 容器中建立站台連結物件。

## <a name="global-catalog-server"></a><a name="BKMK_9"></a>通用類別目錄伺服器
通用類別目錄伺服器是一種網域控制站，可儲存樹系中所有物件的相關資訊，讓應用程式可以搜尋 AD DS，而不需要參考儲存所要求資料的特定網域控制站。 就像所有網域控制站一樣，通用類別目錄伺服器會儲存架構和設定目錄分割的完整、可寫入複本，以及其所裝載網域之網域目錄分割的完整、可寫入複本。 此外，通用類別目錄伺服器會儲存樹系中每個其他網域的部分、唯讀複本。 部分的唯讀網域複本包含網域中的每個物件，但只有一部分屬性 (最常用於搜尋物件) 的屬性。

## <a name="universal-group-membership-caching"></a><a name="BKMK_10"></a>萬用群組成員資格快取
萬用群組成員資格快取可讓網域控制站快取使用者的萬用群組成員資格資訊。 您可以使用 [Active Directory 網站及服務] 嵌入式管理單元，啟用執行 Windows Server 2008 的網域控制站來快取萬用群組成員資格。

啟用萬用群組成員資格快取，可讓網域中的每個網站都不需要通用類別目錄伺服器，因為網域控制站不需要複寫位於樹系中的所有物件，因此可將網路頻寬的使用量降到最低。 它也會減少登入時間，因為驗證網域控制站不一定需要存取通用類別目錄來取得萬用群組成員資格資訊。 如需有關何時使用萬用群組成員資格快取的詳細資訊，請參閱 [規劃通用類別目錄伺服器放置](../../../ad-ds/plan/Planning-Global-Catalog-Server-Placement.md)。



