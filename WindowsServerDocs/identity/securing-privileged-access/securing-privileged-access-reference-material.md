---
title: 保護特殊權限存取的參考資料
description: Windows Server Active Directory 網域的操作安全性控制
ms.topic: article
ms.assetid: 22ee9a77-4872-4c54-82d9-98fc73a378c0
ms.date: 02/14/2019
ms.author: joflore
author: MicrosoftGuyJFlo
manager: daveba
ms.reviewer: mas
ms.openlocfilehash: d2e7d7a064806646ccc075c96fff2ba20acfe005
ms.sourcegitcommit: 5344adcf9c0462561a4f9d47d80afc1d095a5b13
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/18/2020
ms.locfileid: "90766211"
---
# <a name="active-directory-administrative-tier-model"></a>Active Directory 系統管理層模型

>適用於：Windows Server

這個階層模型的用途是在完全控制環境 (第 0 層) 和攻擊者經常危害的高風險工作站資產之間，使用一組緩衝區域來保護身分識別系統。

![此圖顯示階層模型的三個層級](../media/securing-privileged-access-reference-material/PAW_RM_Fig1.JPG)

階層模型是由三個層級所組成，而且只包含系統管理帳戶，不包含標準使用者帳戶：

- **第 0 層** - 直接控制環境中的企業身分識別。 第 0 層包括可直接或間接對 Active Directory 樹系、網域或網域控制站進行系統管理控制的帳戶、群組和其他資產及其上的所有資產。 所有第 0 層資產的安全性敏感度相當於它們全都在彼此的有效控制之下。
- **第 1 層** - 控制企業伺服器與應用程式。 第 1 層資產包括伺服器作業系統、雲端服務和企業應用程式。 第 1 層系統管理員帳戶對於這些資產上裝載的大量商業價值具有系統管理控制權。 常見的範例角色是伺服器系統管理員，其可利用會影響所有企業服務的能力來維護這些作業系統。
- **第 2 層** - 控制使用者工作站和裝置。 第 2 層系統管理員帳戶對於使用者工作站和裝上裝載的大量商業價值具有系統管理控制權。 範例包括技術支援中心及電腦支援系統管理員，因為他們會影響到幾乎所有使用者資料的完整性。

> [!NOTE]
> 階層也可做為保護系統管理資產的基本優先順序機制，但請務必考慮能控制任何階層上所有資產的攻擊者可以存取大部分或所有的商業資產。 它適合用來做為基本優先順序機制的原因是，對攻擊者而言是有難度/成本考量的。 對於攻擊者來說，能夠完全控制所有身分識別 (第 0 層) 或伺服器及雲端服務 (第 1 層)，會比他們是否必須存取每個個別工作站或使用者裝置 (第 2 層) 以取得您組織的資料，來得容易許多。

## <a name="containment-and-security-zones"></a>內含項目和安全性區域

層級會相對於特定的安全性區域。 雖然它們已有許多名稱，但安全性區域是一種完善的方法，可在它們之間透過網路層隔離來提供安全性威脅的內含項目。 階層模型可藉由在網路隔離不再有效的安全性區域內，提供敵人的內含項目來補充隔離。 安全性區域可以橫跨內部部署和雲端基礎結構，例如，位於同一個網域的網域控制站和網域成員均會裝載於內部部署和 Azure 中。

![此圖顯示安全性區域如何橫跨內部部署和雲端基礎結構](../media/securing-privileged-access-reference-material/PAW_RM_Fig2.JPG)

階層模型會藉由限制系統管理員可以控制的項目以及可登入的位置，來防止提高權限 (因為登入電腦會授與這些認證及受這些認證所管理之所有資產的控制權)。

### <a name="control-restrictions"></a>控制限制

下圖顯示控制限制：

![控制限制圖](../media/securing-privileged-access-reference-material/PAW_RM_Fig3.JPG)

### <a name="primary-responsibilities-and-critical-restrictions"></a>主要責任和重要限制

**第 0 層系統管理員** - 管理身分識別存放區及可有效控制它的少量系統，而且：

- 可以視需要管理和控制任何層級上的資產
- 只能以互動方式登入或存取第 0 層所信任的資產

**第 1 層系統管理員** - 管理企業伺服器、服務和應用程式，而且：

- 只能管理和控制第 1 層或第 2 層上的資產
- 只能存取第 1 層或第 0 層所信任的資產 (透過網路登入類型)
- 只能以互動方式登入第 1 層所信任的資產

**第 2 層系統管理員** - 管理企業的桌上型電腦、膝上型電腦、印表機及其他使用者裝置，而且：

- 只能管理和控制第 2 層上的資產
- 可以視需要存取任何階層上的資產 (透過網路登入類型)
- 只能以互動方式登入第 2 層所信任的資產

### <a name="logon-restrictions"></a>登入限制

下圖顯示登入限制：

![登入限制圖](../media/securing-privileged-access-reference-material/PAW_RM_Fig4.JPG)

> [!NOTE]
> 請注意，某些資產對於環境的可用性會受到第 0 層影響，但不會直接影響資產的機密性或完整性。 這些資產包括 DNS 伺服器服務和重要的網路裝置 (例如網際網路 Proxy)。

## <a name="clean-source-principle"></a>乾淨來源準則

乾淨來源準則要求所有安全相依項目必須和要保護的物件一樣值得信任。

![此圖顯示控制物件的任何主體如何是該物件的安全相依性](../media/securing-privileged-access-reference-material/PAW_RM_Fig5.JPG)

控制物件的任何主體都是該物件的安全相依性。 如果敵人可以控制一切來有效控制目標物件，他們就能控制該目標物件。 基於此因素，您必須確保所有安全相依項目的保證都會等於或高過物件本身所需的安全性層級。

儘管原理很簡單，但要套用這個準則需要了解所關注資產 (物件) 的控制關係，以及執行它的相依性分析以探索所有安全相依性 (主體)。

由於控制是可轉移的，因此這個準則必須可以遞迴方式重複執行。 例如，如果 A 控制 B 且 B 控制 C，則 A 也會間接控制 C。

![此圖顯示如果 A 控制 B 且 B 控制 C，則 A 如何也會間接控制 C](../media/securing-privileged-access-reference-material/PAW_RM_Fig6.JPG)

危害 A 的攻擊者可以存取 A 所控制的一切 (包括 B) 以及 B 所控制的一切 (包括 C)。 在這同一個範例中使用安全相依性的語言，B 和 A 都是 C 的安全相依項目，而且必須在 C 所需的保證層級上受到保護，以便讓 C 擁有該保證層級。

針對 IT 基礎結構和身分識別系統，應該將這個準則套用到最常見的控制方法，包括已安裝系統的硬體、系統的安裝媒體、系統的架構和組態，以及每日作業。

## <a name="clean-source-for-installation-media"></a>安裝媒體的乾淨來源

![此圖顯示安裝媒體的乾淨來源](../media/securing-privileged-access-reference-material/PAW_RM_CSIM.JPG)

將乾淨來源準則套用到安裝媒體，需要您確保安裝媒體在製造商發行之後並未遭到竄改 (盡您最大的努力來判斷)。 此圖說明攻擊者使用這個路徑來危害電腦：

![此圖顯示攻擊者使用路徑來危害電腦](../media/securing-privileged-access-reference-material/PAW_RM_Fig8.JPG)

將乾淨來源準則套用到安裝媒體，必須先在您擁有它的整個週期內驗證軟體完整性，包括擷取、儲存及傳輸，然後再使用它。

### <a name="software-acquisition"></a>軟體擷取

軟體的來源應該透過下列其中一種方法來驗證：

- 從實體媒體取得軟體，也就是來自於製造商或聲譽良好的來源，通常是由廠商所出貨的媒體產品。
- 從網際網路取得軟體，並使用廠商提供的檔案雜湊來驗證。
- 從網際網路取得軟體，並藉由下載和比較兩個獨立複本來驗證：
   - 下載到沒有安全性關聯的兩部主機 (不在同一個網域中且未受相同工具所管理)，最好是來自不同的網際網路連線。
   - 使用像是 certutil 的公用程式來比較所下載的檔案：`certutil -hashfile <filename>`

如果可能，所有應用程式軟體 (例如應用程式的安裝程式和工具) 都應該使用 Windows Authenticode 搭配 [Windows Sysinternal](https://www.microsoft.com/sysinternals)s 工具 *sigcheck.exe*，利用撤銷檢查來進行數位簽署和驗證。 如果廠商可能不會提供這種類型的數位簽章，則可能需要某些軟體。

### <a name="software-storage-and-transfer"></a>軟體儲存和傳輸

取得軟體之後，應該將其儲存於受到保護以防遭到修改的位置中，特別是透過網際網路連線的主機，或是在比將安裝該軟體或作業系統的系統還低層級上受到信任的人員。 這個儲存空間可以是實體媒體或安全的電子位置。

### <a name="software-usage"></a>軟體使用方式

最理想的方式應該是在使用軟體時進行驗證，例如手動安裝、針對組態管理工具進行封裝，或匯入至組態管理工具時。

## <a name="clean-source-for-architecture-and-design"></a>架構和設計的乾淨來源

將乾淨來源準則套用到系統架構，需要您確保系統不會相依於較低層級的信任系統。 系統可以相依於較高層級的信任系統，但不能相依於安全性標準較低的較低層級信任系統。

舉例而言，可以接受 Active Directory 控制標準使用者桌面，但標準使用者桌面控制 Active Directory 的權限風險就會顯著提升。

![此圖顯示系統可以相依於較高層級的信任系統，但不能相依於安全性標準較低的較低層級信任系統](../media/securing-privileged-access-reference-material/PAW_RM_Fig09.JPG)

控制關聯性可透過許多方式來引進，包括像是檔案系統之物件上的安全性存取控制清單 (ACL)、電腦上本機系統管理員群組中的成員，或者在以系統身分執行的電腦上所安裝的代理程式 (能夠執行任意的程式碼與指令碼)。

經常遭到忽略的範例是透過登入公開，這會藉由將系統的系統管理認證公開至另一個系統來建立控制關聯性。 這就是為什麼認證竊取攻擊 (例如傳送雜湊) 的作用力如此強大的基本原因。 當系統管理員使用第 0 層認證來登入標準使用者桌面時，他們會將這些認證公開至該桌面、讓它能夠控制 AD，並建立連到 AD 的提高權限路徑。 如需這些攻擊的詳細資訊，請參閱[本頁](/previous-versions/dn785092(v=msdn.10))。

由於有大量資產相依於像是 Active Directory 的身分識別系統，您應該盡可能減少 Active Directory 和網域控制站相依的系統數量。

![此圖顯示您應該盡可能減少 Active Directory 和網域控制站相依的系統數量](../media/securing-privileged-access-reference-material/PAW_RM_Fig010.JPG)

如需強化 Active Directory 最高風險的詳細資訊，請參閱[本頁](../ad-ds/plan/security-best-practices/reducing-the-active-directory-attack-surface.md)。

## <a name="operational-standards-based-on-clean-source-principle"></a>以乾淨來源準則為基礎的操作標準

本節說明系統管理人員的操作標準與期望。 這些標準的設計目的是保護組織資訊技術系統的系統管理控制，以避免因操作實務和程序而產生的風險。

![此圖顯示這些標準的設計目的是保護組織資訊技術系統的系統管理控制，以避免因操作實務和程序而產生的風險](../media/securing-privileged-access-reference-material/PAW_RM_Fig11.JPG)

### <a name="integrating-the-standards"></a>整合標準

您可以將這些標準整合到組織的整體標準和實務。 您可以調整這些標準，使其符合組織的特定需求、可用工具及風險偏好，但我們建議您只進行最低限度的修改來降低風險。 我們建議您使用本指引中的預設值做為您理想結束狀態的基準點，並管理任何要當做例外狀況以便在優先順序中加以處理的差異。

此標準指引的章節組成如下：

- 假設
- 變更諮詢委員會
- 操作實務
   - 摘要
   - 標準的詳細資料

### <a name="assumptions"></a>假設

本節中的標準假設組織具有下列屬性：

- 範圍內大部分或所有的伺服器和工作站都已加入 Active Directory。
- 受管理的所有伺服器正在執行 Windows Server 2008 R2 或更新版本，並已啟用 RDP RestrictedAdmin 模式。
- 受管理的所有工作站正在執行 Windows 7 或更新版本，並已啟用 RDP RestrictedAdmin 模式。

   > [!NOTE]
   > 若要啟用 RDP RestrictedAdmin 模式，請參閱[本頁](https://aka.ms/RDPRA)。

- 智慧卡已可供使用且已發行至所有系統管理帳戶。
- 已將適用於每個網域的 *Builtin\Administrator* 指定為緊急存取帳戶。
- 已部署企業身分識別管理解決方案。
- 已將 [LAPS](https://aka.ms/laps) 部署到伺服器和工作站，以管理本機系統管理員帳戶密碼。
- 已有一個特殊權限存取管理解決方案 (例如 Microsoft Identity Manager)，或計劃要採用一個。
- 已指派人員來監視安全性警示，並加以回應。
- 快速套用 Microsoft 安全性更新的技術能力已可供使用。
- 將不會使用伺服器上的基礎板管理控制器，或者將遵守嚴格的安全性控制。
- 伺服器 (第 1 層系統管理員) 和工作站 (第 2 層系統管理員) 的系統管理員帳戶和群組，將受到網域系統管理員 (第 0 層) 所管理。
- 已有一個變更諮詢委員會 (CAB) 或另一個指定的授權單位，可核准 Active Directory 變更。

### <a name="change-advisory-board"></a>變更諮詢委員會

變更諮詢委員會 (CAB) 是針對變更的討論論壇及核准授權單位，而這類變更可能會影響組織的安全性設定檔。 這些標準的任何例外狀況都應該提交到 CAB，其中應包含風險評估與理由。

本文件中的每個標準都是按照符合指定階層層級之標準的重要性來產生。

![此圖顯示指定階層層級的標準](../media/securing-privileged-access-reference-material/PAW_RM_Fig12.JPG)

適用於強制項目的所有例外狀況 (在本文件中是以紅色八角形或橘色三角形來標記) 會被視為暫時性，而它們需要經由 CAB 核准。 指導方針包括：

- 最初的要求會要求提供人員直屬主管所簽署的風險接受理由，而其會在六個月之後過期。
- 更新則需要提供業務單位主管所簽署的接受風險理由，而它們會在六個月之後過期。

適用於建議項目的所有例外狀況 (在本文件中是以黃色圓形來標記) 會被視為暫時性，且需要經由 CAB 核准。 指導方針包括：

- 最初的要求會要求提供人員直屬主管所簽署的風險接受理由，而其會在 12 個月之後過期。
- 更新則需要提供業務單位主管所簽署的接受風險理由，而它們會在 12 個月之後過期。

### <a name="operational-practices-standards-summary"></a>操作實務標準摘要

此表格中的 [階層] 欄是指系統管理帳戶的 [階層] 層級，該層級的控制權通常會影響該層級上的所有資產。

![此表格顯示系統管理帳戶的階層層級](../media/securing-privileged-access-reference-material/PAW_RM_Fig13.JPG)

定期所做的操作性決策對於維護環境的安全性狀態而言非常重要。 這些適用於程序和實務的標準可協助確保操作性錯誤不會在環境中引發可能遭利用的操作性弱點。

#### <a name="administrator-enablement-and-accountability"></a>系統管理員的授權與權責

系統管理員必須要接獲通知、獲得授權、經過訓練，且有義務儘可能安全地操作環境。

##### <a name="administrative-personnel-standards"></a>系統管理人員的標準

指派的系統管理人員必須通過檢驗，以確保他們是值得信任的，且需要具備系統管理權限：

- 指派系統管理權限之前，請先對人員進行背景檢查。
- 每季檢閱系統管理權限，以判斷哪些人員仍有合理業務需求而需要有管理存取權限。

##### <a name="administrative-security-briefing-and-accountability"></a>系統管理安全性的概要說明與權責

對於組織的風險及其在管理該風險中所扮演的角色，系統管理員必須要接獲通知並負起責任。 系統管理員應每年接受下列相關訓練：

- 一般威脅環境
   - 決定性的敵人
   - 攻擊技術，包括傳遞雜湊及認證竊取
- 組織特定的威脅和事件
- 系統管理員在提供保護以免受到攻擊中所扮演的角色
   - 利用階層模型管理認證暴露
   - 使用系統管理工作站
   - 使用遠端桌面通訊協定 RestrictedAdmin 模式
- 組織特定的系統管理實務
   - 檢閱此標準中的所有操作指導方針
   - 實作下列重要規則：
      - 請勿在系統管理工作站以外的任何地方使用系統管理帳戶
      - 請勿停用或拆除帳戶或工作站上的安全性控制 (例如，智慧卡所需的登入限制或屬性)
      - 回報問題或異常活動

為了劃分權責，所有具備系統管理帳戶的人員都必須簽署「系統管理權限管理辦法」文件，表示他們將遵循組織特定的系統管理原則實務。

##### <a name="provisioning-and-deprovisioning-processes-for-administrative-accounts"></a>系統管理帳戶的佈建與取消佈建程序

您必須先符合下列標準，才能滿足週期需求。

- 所有系統管理帳戶都必須由下表所述的核准授權單位所核准。
   - 唯有當該人員有合理業務需求而需要有管理存取權限時，才能授與核准。
   - 對於系統管理權限的核准不應該超過六個月。
- 系統管理權限的存取必須在發生下列情況時立即取消佈建：
   - 人員職務變更。
   - 人員離開組織。
- 當人員離開組織之後必須立即停用帳戶。
- 停用的帳戶必須在六個月內刪除，且他們刪除的記錄必須輸入到變更核准委員會記錄。
- 每月檢閱所有特殊權限帳戶的成員資格，以確保不會授與未經授權的權限。 這可以使用能警示變更的自動化工具來取代。

|帳戶權限層級|核准授權單位|成員資格檢閱頻率|
|--------------|------------|----------------|
|第 0 層系統管理員|變更核准委員會|每月或自動化|
|第 1 層系統管理員|第 0 層系統管理員或安全性|每月或自動化|
|第 2 層系統管理員|第 0 層系統管理員或安全性|每月或自動化|

#### <a name="operationalize-least-privilege"></a>讓最低權限能夠運作

這些標準有助於藉由降低角色中的系統管理員數目以及其擁有權限的時間量來達到最低權限。

> [!NOTE]
> 若要達到組織中的最低權限，將需要了解組織角色、其需求及其設計機制，以確保他們能夠使用最低權限來完成工作。 若要在系統管理模型中達到最低權限的狀態，經常需要使用多種方法：
>
> - 限制特殊權限群組的系統管理員或成員數目
> - 委派給帳戶較少的權限
> - 依需求提供有時限的權限
> - 讓執行工作的其他人員能夠運作 (一種指引方法)
> - 提供適用於緊急存取與很少使用案例的程序

##### <a name="limit-count-of-administrators"></a>限制系統管理員數目

至少應該為每個系統管理角色指派兩位有資格的人員，以確保業務持續性。

如果指派給任何角色的人數超過兩位，變更核准委員會就必須核准將權限指派給每位個別成員 (包括原本的這兩位) 的特殊原因。 核准的理由必須包括：

- 有哪些技術性工作是由需要系統管理權限的系統管理員所執行
- 工作的執行頻率為何
- 為什麼其他系統管理員無法代表他們來執行工作的特殊原因
- 記載授與權限的所有其他已知替代方法，以及每一個無法接受的原因

##### <a name="dynamically-assign-privileges"></a>動態指派權限

需要是系統管理員，才能在執行工作時取得 "just-in-time" 權限來使用它們。 沒有任何權限可永久指派給系統管理帳戶。

> [!NOTE]
> 永久指派的系統管理權限當然會建立「最高權限」策略，因為系統管理人員需要在發生問題時快速存取權限來維護操作的可用性。 Just-in-time 權限可讓您：
>
> - 以更細微的方式指派權限，以便更接近最低權限。
> - 減少權限的暴露時間
> - 追蹤權限使用方式，以偵測不當使用或攻擊。

#### <a name="manage-risk-of-credential-exposure"></a>管理認證暴露的風險

使用下列做法，正確管理認證暴露的風險。

##### <a name="separate-administrative-accounts"></a>將系統管理帳戶分隔開來

已獲授權來擁有系統管理權限的所有人員，都必須擁有與使用者帳戶完全不同的個別帳戶來執行系統管理功能。

- **標準使用者帳戶** - 已授與標準使用者權限來執行標準使用者工作，例如，電子郵件、Web 瀏覽，以及使用企業營運系統應用程式。 不應為這些帳戶授與系統管理權限。
- **系統管理帳戶** - 將已指派適當系統管理權限的人員所建立的帳戶分隔開來。 需要管理每一層中資產的系統管理員應該針對每一層擁有個別的帳戶。 這些帳戶不應該具備電子郵件或公用網際網路的存取權。

##### <a name="administrator-logon-practices"></a>系統管理員登入做法

在系統管理員可以互動方式登入主機 (使用 RunAs 或使用虛擬化主控台，透過標準 RDP 在本機執行) 之前，該主機必須符合或超過系統管理帳戶層 (或更高階層) 的標準。

系統管理員只能利用他們的系統管理帳戶來登入系統管理工作站。 系統管理員只能使用下一節中所述的核准支援技術，來登入受管理的資源。

> [!NOTE]
> 這是必要的，因為以互動方式登入主機會為該主機授與認證的控制權。
>
> 如需登入類型、常見管理工具及認證暴露的詳細資訊，請參閱[系統管理工具和登入類型]()。

##### <a name="use-of-approved-support-technology-and-methods"></a>使用核准的支援技術和方法

支援遠端系統和使用者的系統管理員必須遵循這些指導方針，以防止可控制遠端電腦的敵人竊取其系統管理認證。

- 如果有主要支援選項，就應該加以使用。
- 唯有當無法使用主要支援選項時，才應使用次要支援選項。
- 禁止的支援方法可能永遠不會用到。
- 所有的系統管理帳戶在任何時候都無法執行網際網路瀏覽或電子郵件存取。

###### <a name="tier-0-forest-domain-and-dc-administration"></a>第 0 層樹系、網域及 DC 系統管理

確定會在這種情況下套用下列做法：

- **遠端伺服器支援** - 從遠端存取伺服器時，第 0 層系統管理員必須遵循這些指導方針：
  - **主要 (工具)** - 使用網路登入的遠端工具 (類型 3)。 如需詳細資訊，請參閱[系統管理工具和登入類型]()。
  - **主要 (互動式)** - 搭配網域帳戶來使用系統管理工作站的 RDP RestrictedAdmin 或標準的 RDP 工作階段。

    > [!NOTE]
    > 如果您有第 0 層特殊權限管理解決方案，請加入「使用從特殊權限存取管理解決方案及時取得的權限」。

- **實體伺服器支援** - 實際出現在伺服器主控台或虛擬機器主控台 (Hyper-V 或 VMWare 工具) 時，這些帳戶不會有任何特定的系統管理工具使用限制，只會有來自標準使用者工作的一般限制，例如電子郵件和瀏覽開放式網際網路。

   > [!NOTE]
   > 第 0 層系統管理不同於其他層的系統管理，因為所有的第 0 層資產已經能夠直接或間接控制所有資產。 舉例來說，控制 DC 的攻擊者不需要竊取已登入系統管理員的認證，因為他們已經能夠存取資料庫中所有的網域認證。

###### <a name="tier-1-server-and-enterprise-application-support"></a>第 1 層伺服器和企業應用程式支援

確定會在這種情況下套用下列做法：

- **遠端伺服器支援** - 從遠端存取伺服器時，第 1 層系統管理員必須遵循這些指導方針：
   - **主要 (工具)** - 使用網路登入的遠端工具 (類型 3)。 如需詳細資訊，請參閱[減輕傳遞雜湊和其他認證竊取](https://www.microsoft.com/pth) v1 (第 42-47 頁)。
   - **主要 (互動式)** - 搭配網域帳戶使用系統管理工作站的 RDP RestrictedAdmin，使用從特殊權限存取管理解決方案及時取得的權限。
   - **次要** - 使用本機帳戶密碼登入伺服器，該密碼是從系統管理工作站透過 LAPS 所設定。
   - **禁止** - 標準 RDP 可能無法與網域帳戶搭配使用。
   - **禁止** - 在工作階段中使用網域帳戶認證 (例如，使用 *RunAs* 或驗證共用)。 這樣會使登入認證暴露於遭竊的風險之中。
- **實體伺服器支援** - 實際出現在伺服器主控台或在虛擬機器主控台 (Hyper-V 或 VMWare 工具) 時，第 1 層系統管理員必須先從 LAPS 抓取本機帳戶密碼，然後才能存取伺服器。
   - **主要** - 先從系統管理工作站抓取 LAPS 所設定的本機帳戶密碼，然後才能登入伺服器。
   - **禁止** - 此案例中不允許使用網域帳戶登入。
   - **禁止** - 在工作階段中使用網域帳戶認證 (例如，RunAs 或驗證共用)。 這樣會使登入認證暴露於遭竊的風險之中。

###### <a name="tier-2-help-desk-and-user-support"></a>第 2 層技術支援人員和使用者支援

技術支援人員和使用者支援組織會執行對使用者的支援 (不需要系統管理權限)，以及對使用者工作站的支援 (需要系統管理權限)。

**使用者支援** - 工作包括協助使用者執行不需對工作站進行任何修改的工作，經常向他們說明如何使用應用程式功能或作業系統功能。

- **桌面端使用者支援** - 第 2 層支援人員實際位於使用者的工作區。
   - **主要** -不需任何工具，即可提供 "Over The Shoulder" 的支援。
   - **禁止** - 此案例中不允許使用網域帳戶的系統管理認證來登入。 需要系統管理權限時，請切換到桌面端工作站支援。
- **遠端使用者支援** - 第 2 層支援人員實際上是在使用者的遠端。
   - **主要** - 可能會使用遠端協助、商務用 Skype 或類似的使用者螢幕共用。 如需詳細資訊，請參閱[什麼是 Windows 遠端協助？](https://windows.microsoft.com/windows/what-is-windows-remote-assistance)
   - **禁止** - 此案例中不允許使用網域帳戶的系統管理認證來登入。 需要系統管理權限時，請切換到工作站支援。
- **工作站支援** - 工作包括執行工作站維護或疑難排解，需要有系統的存取權，以便檢視記錄檔、安裝軟體、更新驅動程式等。
   - **桌面端工作站支援** - 第 2 層支援人員實際位於使用者的工作站。
      - **主要** - 先從系統管理工作站抓取 LAPS 所設定的本機帳戶密碼，然後才能連接到使用者工作站。
      - **禁止** - 此案例中不允許使用網域帳戶的系統管理認證來登入。
   - **遠端工作站支援** - 第 2 層支援人員實際上是在工作站的遠端。
      - **主要** - 搭配網域帳戶使用系統管理工作站的 RDP RestrictedAdmin，使用從特殊權限存取管理解決方案及時取得的權限。
      - **次要** - 先從系統管理工作站抓取 LAPS 所設定的本機帳戶密碼，然後才能連接到使用者工作站。
      - **禁止** - 搭配網域帳戶使用標準 RDP。

###### <a name="no-browsing-the-public-internet-with-admin-accounts-or-from-admin-workstations"></a>無法使用系統管理員帳戶或從系統管理工作站瀏覽公用網際網路

系統管理人員無法在使用系統管理員帳戶登入或登入至系統管理工作站時，瀏覽開放式網際網路。 唯一的授權例外狀況是使用網頁瀏覽器來管理雲端式服務。

###### <a name="no-accessing-email-with-admin-accounts-or-from-admin-workstations"></a>無法使用系統管理帳戶或從系統管理工作站存取電子郵件

系統管理人員無法在使用系統管理員帳戶登入或登入至系統管理工作站時，存取電子郵件。

###### <a name="store-service-and-application-account-passwords-in-a-secure-location"></a>將服務和應用程式帳戶密碼儲存於安全的位置

您應該針對可控制密碼存取的實體安全性程序，使用下列指導方針：

- 將服務帳戶密碼鎖在實際安全的地方。
- 確定只有在帳戶的 [階層] 分類或以上分類受到信任的人員可以存取帳戶密碼。
- 基於責任歸屬因素，將可存取密碼的人數限制為最低數目。
- 確定密碼的所有存取都已記錄、追蹤，且受到公正的第三方所監視，例如未訓練來執行 IT 管理的管理員。

##### <a name="strong-authentication"></a>增強式驗證

使用下列做法，正確設定增強式驗證。

###### <a name="enforce-smartcard-multi-factor-authentication-mfa-for-all-admin-accounts"></a>針對所有系統管理帳戶強制執行智慧卡的多重要素驗證 (MFA)

所有系統管理帳戶都無法使用密碼進行驗證。 唯一的授權例外狀況就是緊急存取帳戶，其受到適當的程序所保護。

將所有系統管理帳戶連結到智慧卡，並啟用屬性「互動式登入需要智慧卡」  。

您應該實作一個指令碼來自動並定期重設隨機密碼雜湊值，方法是停用並立即重新啟用屬性「互動式登入需要智慧卡」  。

除了緊急存取帳戶之外，不允許人員所使用的帳戶有任何例外狀況。

###### <a name="enforce-multi-factor-authentication-for-all-cloud-admin-accounts"></a>針對所有雲端系統管理帳戶強制執行多重要素驗證

雲端服務 (例如 Microsoft Azure 和 Office 365) 中所有具備系統管理權限的帳戶都必須使用多重要素驗證。

##### <a name="rare-use-emergency-procedures"></a>很少使用的緊急程序

操作實務必須支援下列標準：

- 確定可快速解決中斷情況。
- 確定可視需要完成罕見的高權限工作。
- 確定會使用安全的程序來保護認證和權限。
- 確定會遵循適當的追蹤和核准程序。

###### <a name="correctly-follow-appropriate-processes-for-all-emergency-access-accounts"></a>正確遵循適用於所有緊急存取帳戶的適當程序

確定每個緊急存取帳戶都會將追蹤表置於安全之處。

每個帳戶都應遵循密碼追蹤表上記載的程序，包括每次使用之後變更密碼，以及完成之後登出任何所使用的工作站或伺服器。

所有緊急存取帳戶的使用都應該由變更核准委員會進一步核准，或事後核准為已核准的緊急使用方式。

###### <a name="restrict-and-monitor-usage-of-emergency-access-accounts"></a>限制並監視緊急存取帳戶的使用方式

針對緊急存取帳戶的所有使用：

- 只有授權的網域系統管理員可以使用網域系統管理員權限來存取緊急存取帳戶。
- 只能在網域控制站和其他第 0 層主機上使用緊急存取帳戶。
- 此帳戶只能用於下列情況：
  - 執行技術問題的疑難排解和修正，這類問題將導致正確的系統管理帳戶無法使用。
  - 執行罕見的工作，例如：
    - 結構描述系統管理
    - 需要企業系統管理權限的全樹系工作

      > [!NOTE]
      > 已委派包括 Active Directory 網站和子網站管理的拓撲管理來限制這些權限的使用。

- 這其中一個帳戶的所有使用方式都應該有安全性群組負責人的書面授權
- 每個緊急存取帳戶的追蹤表上的程序會要求在每次使用時變更密碼。 安全性小組成員應該確認這會正確發生。

###### <a name="temporarily-assign-enterprise-admin-and-schema-admin-membership"></a>暫時指派企業系統管理員和結構描述管理員的成員資格

您應該視需要新增權限並在使用之後移除。 應該只能針對完成工作的持續期間且最多 10 小時，來為緊急帳戶指派這些權限。 這些權限的所有使用方式與持續期間都應該在工作完成之後，留存於變更核准委員會記錄中。

## <a name="esae-administrative-forest-design-approach"></a>ESAE 系統管理的樹系設計方法

本節包含適用於系統管理樹系的方法，其基礎是由 Microsoft 的網路安全性專業服務小組部署的增強式安全性系統管理環境 (ESAE) 參考架構，可保護客戶免於網路安全性攻擊。

專用的系統管理樹系可讓組織在比生產環境擁有更強安全性控制的環境中，裝載系統管理帳戶、工作站和群組。

此架構能夠在單一樹系架構中進行多項不可能或無法輕易設定的安全性控制，甚至是利用特殊權限存取工作站 (PAW) 來管理。 此方法可讓您在系統管理樹系中，以非特殊權限的標準使用者身分 (其在生產環境中具有高度權限) 佈建帳戶，進而強制更高的技術性治理。 此架構也可使用信任的選擇性驗證功能，將登入 (和認證暴露) 限制為只有獲得授權的主機。 在生產樹系需要更高保證層級但不造成完全重建的成本與複雜度的情況下，系統管理樹系可以提供一個能提升生產環境保證層級的環境。

雖然這種方法確實可將樹系加入到 Active Directory 環境，但成本與複雜度仍會受限於固定的設計、小型硬體/軟體擺設區域及少數的使用者。

> [!NOTE]
> 這種方法適合用來進行 Active Directory 的系統管理，但有許多應用程式不適合使用標準信任透過外部樹系的帳戶來管理。

此圖說明第 0 層資產的系統管理所使用的 ESAE 樹系，以及設定來與搭配使用 Microsoft Identity Manager 的 Privileged Access Management 功能的 PRIV 樹系。 如需部署 MIM PAM 執行個體的詳細資訊，請參閱 [Active Directory 網域服務 (AD DS) 的特殊權限身分識別管理](/microsoft-identity-manager/pam/privileged-identity-management-for-active-directory-domain-services)。

![此圖顯示第 0 層資產的系統管理所使用的 ESAE 樹系，以及設定來與 Microsoft Identity Manager 的特殊權限存取管理功能搭配使用的 PRIV 樹系](../media/securing-privileged-access-reference-material/PAW_RM_Fig14.JPG)

專用系統管理樹系是專用於 Active Directory 管理功能的標準單一網域 Active Directory 樹系。 系統管理樹系和網域可能因為有限的使用案例，而比生產樹系更加嚴格。

系統管理樹系設計應該包含下列考量：

- **有限範圍** - 系統管理樹系的主要價值在於提供高階安全性保證和減少受攻擊面，以致殘餘風險較低。 此樹系可用來存放其他管理功能和應用程式，但每次加大範圍就會增加樹系與其資源的受攻擊面。 其目標在於限制樹系和內部系統管理使用者的功能，將受攻擊面降至最小，所以每次增加範圍時都應謹慎考量。
- **信任設定** - 設定從受管理的樹系或網域到系統管理樹系的信任
   - 需要從生產環境到系統管理樹系的單向信任。 這可以是網域信任或樹系信任。 系統管理樹系/網域不需要信任受管理的網域/樹系，即可管理 Active Directory，但是其他應用程式可能需要雙向信任關係、安全性驗證和測試。
   - 選擇性驗證應用來限制系統管理樹系中的帳戶只能登入適當的生產主機。 若要在 Active Directory 中維護網域控制站和委派權限，這通常需要將網域控制站的「允許登入」權限授與系統管理樹系中指定的第 0 層系統管理帳戶。 如需詳細資訊，請參閱＜進行選擇性驗證設定＞。
- **強化權限和網域** - 應根據 Active Directory 系統管理的需求，將系統管理樹系設定為最低權限。
   - 授與權限來管理網域控制站以及委派權限，需要將系統管理樹系帳戶加入 BUILTIN\Administrators 網域本機群組。 這是因為 Domain Admins 全域群組不能有來自外部網域的成員。
   - 使用此群組來授與權限時必須注意的是，依預設它們將不會有可存取新群組原則物件的系統管理權限。 這可以遵循[此知識庫文章](https://support.microsoft.com/kb/321476) 中的程序來變更，以變更結構描述的預設權限。
   - 系統管理樹系中用來管理生產環境的帳戶，不應獲得系統管理樹系、其中的網域或其中的工作站的系統管理權限。
   - 應藉由離線程序嚴格控制對於系統管理樹系的系統管理權限，以減少攻擊者或惡意內部人士清除稽核記錄檔的機會。 這也有助於確保具有生產系統管理帳戶的人員無法放鬆對於其帳戶的限制以及提高組織的風險。
   - 系統管理樹系應遵循網域的 Microsoft Security Compliance Baseline (SCB) 設定，包括驗證通訊協定的強式設定。
   - 應利用安全性更新，自動更新所有的系統管理樹系主機。 雖然這可能會產生中斷網域控制站維護作業的風險，但可大幅降低未修補弱點的安全性風險。

      > [!NOTE]
      > 專用的 Windows Server Update Services 執行個體可設定為自動核准更新。 如需詳細資訊，請參閱＜核准更新＞的「自動核准更新以供安裝」一節。

- **強化工作站** - 使用 [特殊權限存取工作站](../securing-privileged-access/privileged-access-workstations.md) (透過第 3 階段) 來建置系統管理工作站，但將網域成員資格變更為系統管理樹系，而不是生產環境。
- **強化伺服器與 DC** - 針對系統管理樹系中的所有網域控制站和伺服器：
   - 確定使用[安裝媒體的乾淨來源]()中的指引來驗證所有媒體
   - 確定系統管理樹系伺服器應該已安裝最新作業系統，即使這在生產環境中並不可行。
   - 應利用安全性更新來自動更新系統管理樹系主機。

      > [!NOTE]
      > Windows Server Update Services 可以設定為自動核准更新。 如需詳細資訊，請參閱＜核准更新＞的「自動核准更新以供安裝」一節。

   - 應該使用安全性基準做為啟動組態。

      > [!NOTE]
      > 客戶可以使用 Microsoft Security Compliance Toolkit (SCT) 在系統管理主機上設定基準。

   - 安全開機可抵禦嘗試將未簽署的程式碼載入開機程序的攻擊者或惡意程式碼。

      > [!NOTE]
      > Windows 8 中引進了這項功能，以便運用整合可延伸韌體介面 (UEFI)。

   - 完整磁碟區加密可減輕實體電腦遺失，例如在遠端使用的系統管理膝上型電腦。

      > [!NOTE]
      > 如需詳細資訊，請參閱 [BitLocker](/previous-versions/windows/it-pro/windows-8.1-and-8/dn641993(v=ws.11))。

   - USB 限制可用來防禦實體感染媒介。

      > [!NOTE]
      > 如需詳細資訊，請參閱[控制抽取式裝置或媒體的讀取或寫入權限](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc730808(v=ws.10))。

   - 網路隔離可防禦網路攻擊和不當的系統管理動作。 主機防火牆應封鎖所有的連入連線 (明確要求的連入連線除外)，以及封鎖所有連出的網際網路存取。

   - 反惡意程式碼可用來防禦已知的威脅和惡意程式碼。

   - 攻擊面分析可防止在安裝新軟體期間，將新的攻擊媒介引進 Windows。

      > [!NOTE]
      > 使用 [Attack Surface Analyzer (ASA)](https://www.microsoft.com/download/details.aspx?id=24487) 等工具有助於評估主機上的組態設定，並找出軟體或組態變更所引進的攻擊媒介。

- 強化帳戶
   - 應該針對系統管理樹系中的所有帳戶設定多重要素驗證，但有一個帳戶除外。 至少應該有一個系統管理帳戶是密碼型帳戶，以確保在多重要素驗證程序中斷時還能進行存取。 此帳戶應該受到嚴格的實際控制程序所保護。
   - 針對多重要素驗證所設定的帳戶應該設為定期在帳戶上設定新的 NTLM 雜湊。 這可以透過停用，然後啟用「互動式登入必須使用智慧卡」的帳戶屬性來完成。

      > [!NOTE]
      > 這會中斷正在使用此帳戶進行的操作，因此，只有在系統管理員無法使用帳戶時 (例如，夜晚或週末假日)，才應起始此程序。

- 偵測控制項
   - 應設計系統管理樹系的偵探控制項，以警示系統管理樹系中的異常狀況。 有限的授權案例和活動數目，有助於比生產環境更精確地調整這些控制項。

如需使用 Microsoft 服務來為您的環境設計和部署 ESAE 的詳細資訊，請參閱 [本頁](https://www.microsoft.com/services)。

## <a name="tier-0-equivalency"></a>第 0 層對應項

大部分的組織都會控制功能強大的第 0 層 Active Directory 群組的成員資格，例如 Administrators、Domain Admins 和 Enterprise Admins。  許多組織都忽略了其他群組的風險，其實際上相當於一般 Active Directory 環境中的權限。 比起使用各種不同攻擊方法來攻擊同樣明確的第 0 層權限，這些群組可以為攻擊者提供相對簡單的權限提高路徑。

例如，伺服器操作員可以授與權限來存取網域控制站的備份媒體，並從該媒體的檔案中擷取所有認證，然後使用它們來提高權限。

組織應該控制和監視所有第 0 層中的成員資格 (包含巢狀成員資格)，包括：

- Enterprise Admins
- Domain Admins
- Schema Admin
- BUILTIN\Administrators
- Account Operators
- Backup Operators
- Print Operators
- Server Operators
- 網域控制站
- Read-only Domain Controllers
- Group Policy Creator Owners
- Cryptographic Operators
- Distributed COM Users
- 其他委派的群組 - 貴組織可能建立來管理目錄操作的群組，這些操作可能也可有效存取第 0 層。

## <a name="administrative-tools-and-logon-types"></a>系統管理工具和登入類型

此為參考資訊，可協助識別與使用不同系統管理工具進行遠端管理相關聯的認證暴露風險。

在遠端系統管理案例中，認證一律會公開於來源電腦上，因此，一律建議針對機密或高度影響的帳戶使用值得信任的特殊權限存取工作站 (PAW)。 是否會向目標 (遠端) 電腦上潛在的竊取動作公開認證，主要取決於連線方法所使用的 Windows 登入類型。

下表包含最常見系統管理工具和連線方法的指引：

|連線方式|登入類型|目的地上可重複使用的認證|評價|
|-----------|-------|--------------------|------|
|在主控台登入|Interactive (互動式)|v|包含硬體遠端存取 / 熄燈介面卡和網路 KVM。|
|RUNAS|Interactive (互動式)|v||
|RUNAS /NETWORK|NewCredentials|v|複製目前的 LSA 工作階段以進行本機存取，但連線到網路資源時，請使用新的認證。|
|遠端桌面 (成功)|RemoteInteractive|v|如果已將遠端桌面用戶端設為共用本機裝置和資源，則這些也可能會遭到破解。|
|遠端桌面 (失敗 - 登入類型已遭拒)|RemoteInteractive|-|根據預設，如果 RDP 登入失敗，則只會非常短暫地儲存認證。 若電腦已遭破解，可能就不是這樣了。|
|Net use * \\\SERVER|網路|-||
|Net use * \\\SERVER /u:user|網路|-||
|MMC 嵌入式管理單元到遠端電腦|網路|-|範例：電腦管理、事件檢視器、裝置管理員、服務|
|PowerShell WinRM|網路|-|範例：Enter-PSSession 伺服器|
|PowerShell WinRM with CredSSP|NetworkClearText|v|New-PSSession 伺服器<br />-Authentication Credssp<br />-Credential cred|
|PsExec，而不需明確的認證|網路|-|範例：PsExec \\\server cmd|
|PsExec，以及明確的認證|網路 + 互動式|v|PsExec \\\server -u user -p pwd cmd<br />建立多個登入工作階段。|
|遠端登錄|網路|-||
|遠端桌面閘道|網路|-|向遠端桌面閘道進行驗證。|
|排定的工作|Batch|v|密碼也會當成 LSA 密碼儲存於磁碟上。|
|以服務形式執行工具|Service|v|密碼也會當成 LSA 密碼儲存於磁碟上。|
|弱點掃描器|網路|-|大部分的掃描器預設都會使用網路登入，但有些廠商可能會實作非網路登入，因而引進了更多認證遭竊的風險。|

針對 Web 驗證，使用下表中的參考：

|連線方式|登入類型|目的地上可重複使用的認證|評價|
|-----------|-------|--------------------|------|
|IIS「基本驗證」|NetworkCleartext<br />(IIS 6.0+)<p>Interactive (互動式)<br />(IIS 6.0 之前)|v||
|IIS「整合式 Windows 驗證」|網路|-|NTLM 和 Kerberos 提供者。|

欄位定義：

- **登入類型**可識別連線所起始的登入類型。
- **目的地上可重複使用的認證**指出下列認證類型將儲存於本機登入指定帳戶之目的地電腦上的 LSASS 程序中：
   - LM 與 NT 雜湊
   - Kerberos TGT
   - 純文字密碼 (如果適用)。

此表格中的符號定義如下：

- (-) 表示不會公開認證時。
- (+) 表示會公開認證時。

對於不在此表格中的管理應用程式，您可以從稽核登入事件的登入類型欄位判斷登入類型。 如需詳細資訊，請參閱[稽核登入事件](/previous-versions/windows/it-pro/windows-server-2003/cc787567(v=ws.10))。

在 Windows 架構的電腦中，所有的驗證都會當成數個登入類型之一來處理，而不論所使用的驗證通訊協定或驗證器為何。 此表格包含最常見的登入類型及其相對於認證竊取的屬性：

|登入類型|#|接受的驗證器|LSA 工作階段中可重複使用的認證|範例|
|-------|---|--------------|--------------------|------|
|互動式 (也稱為本機登入)|2|密碼、智慧卡、<br />其他|是|主控台登入；<br />RUNAS；<br />硬體遠端控制解決方案 (例如，網路 KVM 或遠端存取 / 伺服器中的熄燈介面卡)<br />IIS 基本驗證 (IIS 6.0 之前)|
|網路|3|密碼、<br />NT 雜湊、<br />Kerberos 票證|否 (但如果已啟用委派，則會有 Kerberos 票證存在)|NET USE；<br />RPC 呼叫；<br />遠端登錄；<br />IIS 整合式 Windows 驗證；<br />SQL Windows 驗證；|
|Batch|4|密碼 (通常儲存為 LSA 密碼)|是|排定的工作|
|Service|5|密碼 (通常儲存為 LSA 密碼)|是|Windows 服務|
|NetworkCleartext|8|密碼|是|IIS 基本驗證 (IIS 6.0 及更新版本)；<br />含 CredSSP 的 Windows PowerShell|
|NewCredentials|9|密碼|是|RUNAS /NETWORK|
|RemoteInteractive|10|密碼、智慧卡、<br />其他|是|遠端桌面 (先前稱為「終端機服務」)|

欄位定義：

- **登入類型**是所要求的登入類型。
- **#** 是登入類型的數值識別碼，其報告於安全性事件記錄檔的稽核事件中。
- **接受的驗證器**表示哪些類型的驗證器能夠起始此類型的登入。
- LSA 工作階段中**可重複使用的認證**指出登入類型是否會產生 LSA 工作階段來保存認證，例如，純文字密碼、NT 雜湊或 Kerberos 票證，其可用來向其他網站資源進行驗證。
- **範例**會列出使用該登入類型的常見案例。

> [!NOTE]
> 如需登入類型的詳細資訊，請參閱 [SECURITY_LOGON_TYPE 列舉](/windows/win32/api/ntsecapi/ne-ntsecapi-security_logon_type)。