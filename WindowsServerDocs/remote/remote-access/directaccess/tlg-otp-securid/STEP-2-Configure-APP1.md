---
title: 步驟2設定 APP1
description: 本主題是測試實驗室指南的一部分-示範使用 OTP 驗證的 DirectAccess 和適用于 Windows Server 2016 的 RSA SecurID
manager: brianlic
ms.topic: article
ms.assetid: 19a7a4a6-9a04-42ea-a5d0-ecb28a34dbaa
ms.author: lizross
author: eross-msft
ms.date: 08/07/2020
ms.openlocfilehash: ecfc88c74a4e9ddb0cec02c9156ce88f52916740
ms.sourcegitcommit: 40905b1f9d68f1b7d821e05cab2d35e9b425e38d
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/06/2021
ms.locfileid: "97949274"
---
# <a name="step-2-configure-app1"></a>步驟2設定 APP1

>適用於：Windows Server (半年度管道)、Windows Server 2016

使用下列步驟來準備 APP1 以進行 OTP 支援：

1. 建立及部署用來簽署 OTP 憑證要求的憑證範本。 設定用來簽署 OTP 憑證要求的憑證範本。

2. 若要建立及部署由公司 CA 所發行之 OTP 憑證的憑證範本。 為公司 CA 所發行的 OTP 憑證設定憑證範本。

> [!WARNING]
> 此測試實驗室指南的設計包括基礎結構伺服器，例如網域控制站，以及執行 Windows Server 2012 R2 或 Windows Server 2012 (CA) 的憑證授權單位單位。 使用此測試實驗室指南來設定執行其他作業系統的基礎結構伺服器尚未經過測試，本指南不包含設定其他作業系統的指示。

## <a name="to-create-and-deploy-a-certificate-template-used-to-sign-otp-certificate-requests"></a><a name="DAOTPRA"></a>建立及部署用來簽署 OTP 憑證要求的憑證範本

1.  執行 **certtmpl**，然後按 enter。

2.  在 [憑證範本] 主控台的詳細資料窗格中，以滑鼠右鍵按一下 [ **電腦** ] 範本，然後按一下 [ **複製範本**]。

3.  在 [ **新範本** 的內容] 對話方塊的 [ **相容性** ] 索引標籤上，于 [ **憑證授權單位** 單位] 清單中選取您要的作業系統，然後在 [ **產生的變更** ] 對話方塊中按一下 **[確定**]。 在 [ **憑證收件** 者] 清單中，選取您要的作業系統，然後在 [ **產生的變更** ] 對話方塊中按一下 **[確定**]。

4.  在 [ **新範本** 的內容] 對話方塊中，按一下 [ **一般** ] 索引標籤。

5.  在 [ **一般** ] 索引標籤的 [ **範本顯示名稱**] 中，輸入 **DAOTPRA**。 將 **有效期間** 設定為2天，並將 **更新期限** 設定為1天。 如果顯示 [ **憑證範本** ] 警告，請按一下 **[確定]**。

6.  按一下 [安全性] 索引標籤，然後按一下 [新增]。

7.  在 [ **選取使用者、電腦、服務帳戶或群組** ] 對話方塊中，按一下 [ **物件類型**]。 在 [ **物件類型** ] 對話方塊中，選取 [ **電腦**]，然後按一下 **[確定]**。 在 [ **輸入物件名稱來選取** ] 方塊中，輸入 **EDGE1**，按一下 **[確定]**，然後在 [ **允許** ] 欄中，選取 [ **讀取**]、[ **註冊**] 和 [ **自動註冊** ] 核取方塊。 按一下 [**已驗證的使用者**]，選取 [**允許**] 資料行底下的 [**讀取**] 核取方塊，並清除所有其他核取方塊。 按一下 [**網域電腦**]，然後取消核取 [**允許**] 欄下的 [**註冊**]。 按一下 [ **Domain admins** ] 和 [ **Enterprise admins** ]，然後按一下 [**允許**] 資料行底下的 [**完全控制**]。 按一下 [套用]。

8.  按一下 [ **主體名稱** ] 索引標籤，然後從此 **Active Directory 資訊中** 按一下 [建立]。 在 [ **主體名稱格式：** ] 清單中選取 [ **dns 名稱**]，確認已核取 [ **dns 名稱** ] 方塊， **然後按一下 [** 套用]。

9. 按一下 [ **延伸** ] 索引標籤，選取 [ **應用程式原則** ]，然後按一下 [ **編輯**]。 移除所有現有的應用程式原則。 按一下 [新增]，然後在 [新增 **應用程式原則**] 對話方塊 **中按一下 [****新增**]，在 [**名稱：** ] 欄位中輸入 **DA OTP RA** ，並在 [**物件識別碼：** ] 欄位中輸入 **1.3.6.1.4.1.311.81.1.1** ，然後按一下 **[確定]**。 按一下 [ **新增應用程式原則** ] 對話方塊中的 **[確定]**。 在 [ **編輯應用程式原則] 延伸** 中，按一下 **[確定]**。 在 [ **新範本的** 內容] 對話方塊中，按一下 **[確定]**。

## <a name="to-create-and-deploy-a-certificate-template-for-otp-certificates-issued-by-the-corporate-ca"></a><a name="DAOTPLogon"></a>若要建立及部署由公司 CA 所發行之 OTP 憑證的憑證範本

1.  在 [憑證範本] 主控台的詳細資料窗格中，以滑鼠右鍵按一下 [ **智慧卡登** 入] 範本，然後按一下 [ **複製範本**]。

2.  在 [**新範本** 的內容] 對話方塊的 [**憑證授權單位** 單位] 清單的 [**相容性**] 索引標籤上，按一下您要使用的作業系統，然後在 [**產生的變更**] 對話方塊中按一下 **[確定]**。 在 [ **憑證收件** 者] 清單中，選取您要使用的作業系統，然後在 [ **產生的變更** ] 對話方塊中按一下 **[確定**]。

3.  在 [ **新範本** 的內容] 對話方塊中，按一下 [ **一般** ] 索引標籤。

4.  在 [ **一般** ] 索引標籤的 [ **範本顯示名稱**] 中，輸入 **DAOTPLogon**。 在 [ **有效期間**] 的下拉式清單中，按一下 [ **小時**]，在 [ **憑證範本** ] 對話方塊中，按一下 **[確定]**，並確定 [時數] 設定為1。 在 [ **續約期間**] 中，輸入 **0**。

    > [!IMPORTANT]
    > **Windows Server 2003 CA**。 如果憑證授權單位單位 (CA) 是在執行 Windows Server 2003 的電腦上，則必須在不同的電腦上設定憑證範本。 這是必要的，因為在執行 Windows Server 2008 和 Windows Vista 之前的 Windows 版本時，不可能以小時為單位來設定 **有效期間** 。 如果您用來設定範本的電腦未安裝 Active Directory 憑證服務伺服器角色，或者它是用戶端電腦，則您可能需要安裝憑證範本嵌入式管理單元。 如需詳細資訊，請參閱 [安裝憑證範本嵌入式管理單元](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc732445(v=ws.11))。
    >
    > **Windows Server 2008 R2 CA**。 如果您已部署執行 Windows Server 2008 R2 (CA) 的憑證授權單位單位，您必須將憑證範本 **更新期限** 設定為1或2小時，而且 **有效期間** 必須比 **更新期限** 還要長，但不超過4小時。 如果您使用執行 Windows Server 2008 R2 的 CA 來設定憑證範本的 **有效期間** 超過4個小時，directaccess 安裝精靈將無法偵測到憑證範本，而且 directaccess 安裝會失敗。

5.  按一下 [**安全性**] 索引標籤，選取 [**允許**] 欄中的 [**已驗證的使用者**]，然後選取 [**讀取**] 和 [**註冊**] 核取方塊 按一下 [確定]。 按一下 **[網域系統管理員** 和企業系統 **管理員**]，然後按一下 [**允許**] 資料行底下的 [**完全控制**]。 按一下 [套用]。

6.  按一下 [ **主體名稱** ] 索引標籤，然後從此 **Active Directory 資訊中** 按一下 [建立]。 在 [ **主體名稱格式：** ] 清單中選取 [ **完全分辨名稱**]，確定已核取 [ **使用者主體名稱 (UPN])** 方塊， **然後按一下 [** 套用]。

7.  按一下 [**伺服器**] 索引標籤，選取 [**不在 CA 資料庫中儲存憑證和要求**] 核取方塊，清除 [**未在發行的憑證中包含撤銷資訊**] 核取方塊，然後在 [**新範本的** 內容] 對話方塊中按一下 [套用 **]。**

8.  按一下 [ **發行需求** ] 索引標籤，選取 [已授權的簽章 **數目：** ] 核取方塊，將值設定為1。 在 [簽章：清單選取 **應用程式原則**] 的 [**需要的原則類型**] 中，于 [**應用程式原則**] 清單中選取 [ **DA OTP RA**]。 在 [ **新範本的** 內容] 對話方塊中，按一下 **[確定]**。

9. 按一下 [ **擴充** 功能] 索引標籤，然後在 [ **應用程式原則** ] 按一下 [ **編輯**] 刪除 **用戶端驗證**、保留 **SmartCardLogon**，然後按一下 **[確定]** 兩次。

10. 關閉 [憑證範本主控台]。

11. 在 [ **開始** ] 畫面上，輸入 **certsrv**，然後按 enter。

12. 在 [憑證授權單位單位] 主控台樹中，展開 [ **corp-APP1-1**]，按一下 [ **憑證範本**]，以滑鼠右鍵按一下 [ **憑證範本**]，指向 [ **新增**]，然後按一下 [ **要發出的憑證範本**]。

13. 在憑證範本清單中，按一下 [ **DAOTPRA** 和 **DAOTPLogon**]，然後按一下 **[確定]**。

14. 在主控台的詳細資料窗格中，您應該會看到 **DAOTPRA** 憑證範本的 **預期用途** 為 **DA OTP RA** ，而 **DAOTPLogon** 憑證範本的用途是 **智慧卡登****入的用途。**

15. 重新啟動服務。

16. 關閉 [憑證授權單位] 主控台。

17. 開啟提升權限的命令提示字元。 輸入 **CertUtil.exe-SetReg DBFlags + DBFLAGS_ENABLEVOLATILEREQUESTS**，然後按 enter。

18. 在下一個步驟中，讓命令提示字元視窗保持開啟。

